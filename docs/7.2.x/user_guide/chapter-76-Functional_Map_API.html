<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="generator" content="Asciidoctor 0.1.4"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Functional Map API</title> <style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }
audio, canvas, video { display: inline-block; }
audio:not([controls]) { display: none; height: 0; }
[hidden] { display: none; }
html { background: #fff; color: #000; font-family: sans-serif; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; }
body { margin: 0; }
a:focus { outline: thin dotted; }
a:active, a:hover { outline: 0; }
h1 { font-size: 2em; margin: 0.67em 0; }
abbr[title] { border-bottom: 1px dotted; }
b, strong { font-weight: bold; }
dfn { font-style: italic; }
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }
mark { background: #ff0; color: #000; }
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }
pre { white-space: pre-wrap; }
q { quotes: "\201C" "\201D" "\2018" "\2019"; }
small { font-size: 80%; }
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }
img { border: 0; }
svg:not(:root) { overflow: hidden; }
figure { margin: 0; }
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }
legend { border: 0; padding: 0; }
button, input, select, textarea { font-family: inherit; font-size: 100%; margin: 0; }
button, input { line-height: normal; }
button, select { text-transform: none; }
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; cursor: pointer; }
button[disabled], html input[disabled] { cursor: default; }
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; padding: 0; }
input[type="search"] { -webkit-appearance: textfield; -moz-box-sizing: content-box; -webkit-box-sizing: content-box; box-sizing: content-box; }
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }
textarea { overflow: auto; vertical-align: top; }
table { border-collapse: collapse; border-spacing: 0; }
*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
html, body { font-size: 100%; }
body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }
a:hover { cursor: pointer; }
a:focus { outline: none; }
img, object, embed { max-width: 100%; height: auto; }
object, embed { height: 100%; }
img { -ms-interpolation-mode: bicubic; }
#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }
.left { float: left !important; }
.right { float: right !important; }
.text-left { text-align: left !important; }
.text-right { text-align: right !important; }
.text-center { text-align: center !important; }
.text-justify { text-align: justify !important; }
.hide { display: none; }
.antialiased, body { -webkit-font-smoothing: antialiased; }
img { display: inline-block; vertical-align: middle; }
textarea { height: auto; min-height: 50px; }
select { width: 100%; }
p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }
.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #7a2518; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }
a { color: #005498; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #00467f; }
a img { border: none; }
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Georgia, "URW Bookman L", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }
h1 { font-size: 2.125em; }
h2 { font-size: 1.6875em; }
h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }
h4 { font-size: 1.125em; }
h5 { font-size: 1.125em; }
h6 { font-size: 1em; }
hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }
em, i { font-style: italic; line-height: inherit; }
strong, b { font-weight: bold; line-height: inherit; }
small { font-size: 60%; line-height: inherit; }
code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; color: #6d180b; }
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }
ul, ol { margin-left: 1.5em; }
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }
abbr { text-transform: none; }
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: inherit; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }
blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }
.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }
@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
.print-only { display: none !important; }
@media print { * { background: transparent !important; color: #000 !important; box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }
.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }
*:not(pre) > code { font-size: 0.9375em; padding: 1px 3px 0; white-space: nowrap; background-color: #f2f2f2; border: 1px solid #cccccc; -webkit-border-radius: 4px; border-radius: 4px; text-shadow: none; }
pre, pre > code { line-height: 1.4; color: inherit; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }
kbd.keyseq { color: #555555; }
kbd:not(.keyseq) { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }
kbd kbd:first-child { margin-left: 0; }
kbd kbd:last-child { margin-right: 0; }
.menuseq, .menu { color: #090909; }
p a > code:hover { color: #561309; }
#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }
#header { margin-bottom: 2.5em; }
#header > h1 { color: black; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #6f6f6f; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }
#toc { border-bottom: 3px double #ebebeb; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }
#toctitle { color: #7a2518; }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; }
  #toc.toc2 { position: fixed; width: 20em; left: 0; top: 0; border-right: 1px solid #ebebeb; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; }
  #toc.toc2 > ul { font-size: .95em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1.25em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #ebebeb; left: auto; right: 0; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; border-width: 0; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }
#content #toctitle { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-size: 1em; padding-left: 0.125em; }
#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }
#footer-text { color: #dddddd; line-height: 1.44; }
.sect1 { padding-bottom: 1.25em; }
.sect1 + .sect1 { border-top: 3px double #ebebeb; }
#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }
.imageblock, .literalblock, .listingblock, .verseblock, .videoblock { margin-bottom: 1.25em; }
.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }
.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }
table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }
.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #6f6f6f; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }
.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }
.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }
.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; line-height: 1.6; }
.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }
.literalblock > .content pre, .listingblock > .content pre { background: none; border-width: 1px 0; border-style: dotted; border-color: #bfbfbf; -webkit-border-radius: 4px; border-radius: 4px; padding: 0.75em 0.75em 0.5em 0.75em; word-wrap: break-word; }
.literalblock > .content pre.nowrap, .listingblock > .content pre.nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock > .content pre > code, .listingblock > .content pre > code { display: block; }
@media only screen { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.8em; } }
@media only screen and (min-width: 768px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.9em; } }
@media only screen and (min-width: 1280px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 1em; } }
.listingblock > .content { position: relative; }
.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }
.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }
.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }
.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }
table.pyhltable { border: 0; margin-bottom: 0; }
table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }
table.pyhltable td.code { padding-left: .75em; padding-right: 0; }
.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }
.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }
table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }
.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: inherit; color: #555555; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }
table thead th, table tfoot th { font-weight: bold; }
table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 4px; border-radius: 4px; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }
table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }
table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }
table.tableblock td .paragraph:last-child p, table.tableblock td > p:last-child { margin-bottom: 0; }
th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }
th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }
th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }
th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }
th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }
th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }
p.tableblock.header { color: #222222; font-weight: bold; }
td > div.verse { white-space: pre; }
ol { margin-left: 1.75em; }
ul li ol { margin-left: 1.5em; }
dl dd { margin-left: 1.125em; }
dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }
ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }
ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }
ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }
ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }
ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }
ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }
.unstyled dl dt { font-weight: normal; font-style: normal; }
ol.arabic { list-style-type: decimal; }
ol.decimal { list-style-type: decimal-leading-zero; }
ol.loweralpha { list-style-type: lower-alpha; }
ol.upperalpha { list-style-type: upper-alpha; }
ol.lowerroman { list-style-type: lower-roman; }
ol.upperroman { list-style-type: upper-roman; }
ol.lowergreek { list-style-type: lower-greek; }
.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }
td.hdlist1 { padding-right: .8em; font-weight: bold; }
td.hdlist1, td.hdlist2 { vertical-align: top; }
.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }
.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }
.qanda > ol > li > p > em:only-child { color: #00467f; }
.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }
.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }
.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }
a.image { text-decoration: none; }
span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }
.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }
div.unbreakable { page-break-inside: avoid; }
.big { font-size: larger; }
.small { font-size: smaller; }
.underline { text-decoration: underline; }
.overline { text-decoration: overline; }
.line-through { text-decoration: line-through; }
.aqua { color: #00bfbf; }
.aqua-background { background-color: #00fafa; }
.black { color: black; }
.black-background { background-color: black; }
.blue { color: #0000bf; }
.blue-background { background-color: #0000fa; }
.fuchsia { color: #bf00bf; }
.fuchsia-background { background-color: #fa00fa; }
.gray { color: #606060; }
.gray-background { background-color: #7d7d7d; }
.green { color: #006000; }
.green-background { background-color: #007d00; }
.lime { color: #00bf00; }
.lime-background { background-color: #00fa00; }
.maroon { color: #600000; }
.maroon-background { background-color: #7d0000; }
.navy { color: #000060; }
.navy-background { background-color: #00007d; }
.olive { color: #606000; }
.olive-background { background-color: #7d7d00; }
.purple { color: #600060; }
.purple-background { background-color: #7d007d; }
.red { color: #bf0000; }
.red-background { background-color: #fa0000; }
.silver { color: #909090; }
.silver-background { background-color: #bcbcbc; }
.teal { color: #006060; }
.teal-background { background-color: #007d7d; }
.white { color: #bfbfbf; }
.white-background { background-color: #fafafa; }
.yellow { color: #bfbf00; }
.yellow-background { background-color: #fafa00; }
span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }
.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #005498; color: #003f72; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }
.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }
.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 0; border-radius: 0; }

</style> <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css"> <style>
/* Foundation stylesheet for CodeRay (to match GitHub theme) | MIT License | http://foundation.zurb.com */
table.CodeRay { border-collapse: collapse; padding: 2px; margin-bottom: 0; border: 0; background: transparent; }
table.CodeRay td { padding: 0 .5em; vertical-align: top; }
table.CodeRay td.line-numbers { text-align: right; color: #999; border-right: 1px solid #e5e5e5; padding-left: 0; }
span.line-numbers { border-right: 1px solid #E5E5E5; color: #999; display: inline-block; margin-right: 0.5em; padding-right: 0.5em; }
.CodeRay td.line-numbers strong, .CodeRay span.line-numbers strong { font-weight: normal; }
.CodeRay .debug { color: white !important; background: blue !important; }
.CodeRay .annotation { color: #007; }
.CodeRay .attribute-name { color: #f08; }
.CodeRay .attribute-value { color: #700; }
.CodeRay .binary { color: #509; }
.CodeRay .comment  { color: #999; font-style: italic; }
.CodeRay .char { color: #04D; }
.CodeRay .char .content { color: #04D; }
.CodeRay .char .delimiter { color: #039; }
.CodeRay .class { color: #458; }
.CodeRay .complex { color: #A08; }
.CodeRay .constant { color: teal; }
.CodeRay .color { color: #0A0; }
.CodeRay .class-variable { color: #369; }
.CodeRay .decorator { color: #B0B; }
.CodeRay .definition { color: #099; }
.CodeRay .directive { color: #088; }
.CodeRay .delimiter { color: black; }
.CodeRay .doc { color: #970; }
.CodeRay .doctype { color: #34b; }
.CodeRay .doc-string { color: #D42; }
.CodeRay .escape  { color: #666; }
.CodeRay .entity { color: #800; }
.CodeRay .error { color: #808; }
.CodeRay .exception { color: #C00; }
.CodeRay .filename { color: #099; }
.CodeRay .function { color: #900; }
.CodeRay .global-variable { color: teal; }
.CodeRay .hex { color: #058; }
.CodeRay .integer  { color: #099; }
.CodeRay .include { color: #B44; }
.CodeRay .inline { color: black; }
.CodeRay .inline .inline { background: #ccc; }
.CodeRay .inline .inline .inline { background: #bbb; }
.CodeRay .inline .inline-delimiter { color: #D14; }
.CodeRay .inline-delimiter { color: #D14; }
.CodeRay .important { color: #f00; }
.CodeRay .interpreted { color: #B2B; }
.CodeRay .instance-variable { color: teal; }
.CodeRay .label { color: #970; }
.CodeRay .local-variable { color: #963; }
.CodeRay .octal { color: #40E; }
.CodeRay .predefined { color: #369; }
.CodeRay .preprocessor { color: #579; }
.CodeRay .pseudo-class { color: #00C; }
.CodeRay .predefined-type { color: #074; }
.CodeRay .reserved, .keyword  { color: #000; }
.CodeRay .key { color: #808; }
.CodeRay .key .delimiter { color: #606; }
.CodeRay .key .char { color: #80f; }
.CodeRay .value { color: #088; }
.CodeRay .regexp { background-color: #fff0ff; }
.CodeRay .regexp .content { color: #808; }
.CodeRay .regexp .delimiter { color: #404; }
.CodeRay .regexp .modifier { color: #C2C; }
.CodeRay .regexp .function  { color: #404; font-weight: bold; }
.CodeRay .string { color: #D20; }
.CodeRay .string .string { }
.CodeRay .string .string .string { background-color: #ffd0d0; }
.CodeRay .string .content { color: #D14; }
.CodeRay .string .char { color: #D14; }
.CodeRay .string .delimiter { color: #D14; }
.CodeRay .shell { color: #D14; }
.CodeRay .shell .content { }
.CodeRay .shell .delimiter { color: #D14; }
.CodeRay .symbol { color: #990073; }
.CodeRay .symbol .content { color: #A60; }
.CodeRay .symbol .delimiter { color: #630; }
.CodeRay .tag, .CodeRay .attribute-name { color: #070; }
.CodeRay .tag-special { color: #D70; }
.CodeRay .type { color: #339; }
.CodeRay .variable  { color: #036; }
.CodeRay .insert { background: #afa; }
.CodeRay .delete { background: #faa; }
.CodeRay .change { color: #aaf; background: #007; }
.CodeRay .head { color: #f8f; background: #505; }
.CodeRay .insert .insert { color: #080; }
.CodeRay .delete .delete { color: #800; }
.CodeRay .change .change { color: #66f; }
.CodeRay .head .head { color: #f4f; }

</style> </head> <body class="book"> <div id="header"> </div> <div id="content"> <div class="sect1"> <h2 id="_functional_map_api"><a class="anchor" href="#_functional_map_api"></a>1. Functional Map API</h2> <div class="sectionbody"> <div class="paragraph"> <p>Infinispan 8 introduces a new experimental API for interacting with your data which takes advantage of the functional programming additions and improved asynchronous programming capabilities available in Java 8.</p> </div> <div class="paragraph"> <p>Infinispan&#8217;s <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.html">Functional Map API</a> is a distilled map-like asynchronous API which uses functions to interact with data.</p> </div> <div class="sect2"> <h3 id="_asynchronous_and_lazy"><a class="anchor" href="#_asynchronous_and_lazy"></a>1.1. Asynchronous and Lazy</h3> <div class="paragraph"> <p>Being an asynchronous API, all methods that return a single result, return a CompletableFuture which wraps the result, so you can use the resources of your system more efficiently by having the possibility to receive callbacks when the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html"><code>CompletableFuture</code></a> has completed, or you can chain or compose them with other CompletableFuture.</p> </div> <div class="paragraph"> <p>For those operations that return multiple results, the API returns instances of a <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Traversable.html"><code>​Traversable</code></a> interface which offers a lazy pull-style API for working with multiple results. <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Traversable.html"><code>​Traversable</code></a> ,​ being a lazy pull-style API, can still be asynchronous underneath since the user can decide to work on the traversable at a later stage, and the <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Traversable.html"><code>​Traversable</code></a> implementation itself can decide when to compute those results.</p> </div> </div> <div class="sect2"> <h3 id="_function_transparency"><a class="anchor" href="#_function_transparency"></a>1.2. Function transparency</h3> <div class="paragraph"> <p>Since the content of the functions is transparent to Infinispan, the API has been split into 3 interfaces for read­-only ( <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadOnlyMap.html"><code>R​eadOnlyMap</code></a> )​, read­-write ( <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadWriteMap.html"><code>R​eadWriteMap</code></a> )​ and write­-only ( <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html"><code>W​riteOnlyMap</code></a> )​ operations respectively, in order to provide hints to the Infinispan internals on the type of work needed to support functions.</p> </div> </div> <div class="sect2"> <h3 id="_constructing_functional_maps"><a class="anchor" href="#_constructing_functional_maps"></a>1.3. Constructing Functional Maps</h3> <div class="paragraph"> <p>To construct any of the read-only, write-only or read-write map instances, an Infinispan <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/AdvancedCache.html"><code>AdvancedCache</code></a> is required, which is retrieved from the Cache Manager, and using the <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/AdvancedCache.html"><code>AdvancedCache</code></a> , static method factory methods are used to create <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadOnlyMap.html"><code>R​eadOnlyMap</code></a> , <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadWriteMap.html"><code>R​eadWriteMap</code></a> or <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html"><code>W​riteOnlyMap</code></a> :</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.FunctionalMap</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.functional.impl</span>.*;

AdvancedCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = ...

FunctionalMapImpl&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; functionalMap = FunctionalMapImpl.create(cache);
ReadOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; readOnlyMap = ReadOnlyMapImpl.create(functionalMap);
WriteOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; writeOnlyMap = WriteOnlyMapImpl.create(functionalMap);
ReadWriteMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; readWriteMap = ReadWriteMapImpl.create(functionalMap);</code></pre> </div> </div> <div class="admonitionblock warning"> <table> <tr> <td class="icon"> <i class="icon-warning" title="Warning"></i> </td> <td class="content"> At this stage, the Functional Map API is experimental and hence the way FunctionalMap, ReadOnlyMap, WriteOnlyMap and ReadWriteMap are constructed is temporary. </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="_read_only_map_api"><a class="anchor" href="#_read_only_map_api"></a>1.4. Read-Only Map API</h3> <div class="paragraph"> <p>Read-only operations have the advantage that no locks are acquired for the duration of the operation. Here&#8217;s an example on how to the equivalent operation for <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html#get-java.lang.Object-">Map.get(K)</a> :</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.EntryView</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.FunctionalMap</span>.*;

ReadOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; readOnlyMap = ...
CompletableFuture&lt;Optional&lt;<span class="predefined-type">String</span>&gt;&gt; readFuture = readOnlyMap.eval(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, ReadEntryView::find);
readFuture.thenAccept(<span class="predefined-type">System</span>.out::println);</code></pre> </div> </div> <div class="paragraph"> <p>Read-only map also exposes operations to retrieve multiple keys in one go:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.EntryView</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.FunctionalMap</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.Traversable</span>;

ReadOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; readOnlyMap = ...

Set&lt;<span class="predefined-type">String</span>&gt; keys = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;&gt;(<span class="predefined-type">Arrays</span>.asList(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">key2</span><span class="delimiter">&quot;</span></span>));
Traversable&lt;<span class="predefined-type">String</span>&gt; values = readOnlyMap.evalMany(keys, ReadEntryView::get);
values.forEach(<span class="predefined-type">System</span>.out::println);</code></pre> </div> </div> <div class="paragraph"> <p>Finally, read-only map also exposes methods to read all existing keys as well as entries, which include both key and value information.</p> </div> <div class="sect3"> <h4 id="_read_only_entry_view"><a class="anchor" href="#_read_only_entry_view"></a>1.4.1. Read-Only Entry View</h4> <div class="paragraph"> <p>The function parameters for read-only maps provide the user with a <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.ReadEntryView.html">read-only entry view</a> to interact with the data in the cache, which include these operations:</p> </div> <div class="ulist"> <ul> <li> <p><a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.ReadEntryView.html#key--"><code>key()</code></a> method returns the key for which this function is being executed.</p> </li> <li> <p><a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.ReadEntryView.html#find--"><code>find()</code></a> returns a Java 8 <code>Optional</code> wrapping the value if present, otherwise it returns an empty optional. Unless the value is guaranteed to be associated with the key, it&#8217;s recommended to use <code>find()</code> to verify whether there&#8217;s a value associated with the key.</p> </li> <li> <p><a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.ReadEntryView.html#get--"><code>get()</code></a> returns the value associated with the key. If the key has no value associated with it, calling <code>get()</code> throws a <code>NoSuchElementException</code>. <code>get()</code> can be considered as a shortcut of <code>ReadEntryView.find().get()</code> which should be used only when the caller has guarantees that there&#8217;s definitely a value associated with the key.</p> </li> <li> <p><a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/MetaParam.Lookup.html#findMetaParam-java.lang.Class-"><code>findMetaParam(Class&lt;T&gt; type)</code></a> allows metadata parameter information associated with the cache entry to be looked up, for example: entry lifespan, last accessed time&#8230;etc. See <a href="#_meta_parameter">Metadata Parameter Handling section</a> to find out more.</p> </li> </ul> </div> </div> </div> <div class="sect2"> <h3 id="_write_only_map_api"><a class="anchor" href="#_write_only_map_api"></a>1.5. Write-Only Map API</h3> <div class="paragraph"> <p>Write-only operations include operations that insert or update data in the cache and also removals. Crucially, a write-only operation does not attempt to read any previous value associated with the key. This is an important optimization since that means neither the cluster nor any persistence stores will be looked up to retrieve previous values. In the main Infinispan Cache, this kind of optimization was achieved using a local-only per-invocation flag, but the use case is so common that in this new functional API, this optimization is provided as a first-class citizen.</p> </div> <div class="paragraph"> <p>Using <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html">write-only map API</a> , an operation equivalent to <a href="https://github.com/jsr107/jsr107spec/blob/v1.0.0/src/main/java/javax/cache/Cache.java"><code>javax.cache.Cache</code> (<code>JCache</code>)</a> 's void returning <a href="https://github.com/jsr107/jsr107spec/blob/v1.0.0/src/main/java/javax/cache/Cache.java#L194"><code>put</code></a> can be achieved this way, followed by an attempt to read the stored value using the read-only map API:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.EntryView</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.FunctionalMap</span>.*;

WriteOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; writeOnlyMap = ...
ReadOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; readOnlyMap = ...

CompletableFuture&lt;<span class="predefined-type">Void</span>&gt; writeFuture = writeOnlyMap.eval(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>,
   (v, view) -&gt; view.set(v));
CompletableFuture&lt;<span class="predefined-type">String</span>&gt; readFuture = writeFuture.thenCompose(r -&gt;
   readOnlyMap.eval(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, ReadEntryView::get));
readFuture.thenAccept(<span class="predefined-type">System</span>.out::println);</code></pre> </div> </div> <div class="paragraph"> <p>Multiple key/value pairs can be stored in one go using <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html#evalMany-java.util.Map-java.util.function.BiConsumer-"><code>evalMany</code></a> API:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java">WriteOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; writeOnlyMap = ...

Map&lt;K, <span class="predefined-type">String</span>&gt; data = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
data.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>);
data.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">key2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value2</span><span class="delimiter">&quot;</span></span>);
CompletableFuture&lt;<span class="predefined-type">Void</span>&gt; writerAllFuture = writeOnlyMap.evalMany(data, (v, view) -&gt; view.set(v));
writerAllFuture.thenAccept(x -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Write completed</span><span class="delimiter">&quot;</span></span>);</code></pre> </div> </div> <div class="paragraph"> <p>To remove all contents of the cache, there are two possibilities with different semantics. If using <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html#evalAll-java.util.function.Consumer-"><code>evalAll</code></a> each cached entry is iterated over and the function is called with that entry&#8217;s information. Using this method also results in listeners (see <a href="#_functional_listeners">functional listeners section</a> for more information) being invoked:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java">WriteOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; writeOnlyMap = ...

CompletableFuture&lt;<span class="predefined-type">Void</span>&gt; removeAllFuture = writeOnlyMap.evalAll(WriteEntryView::remove);
removeAllFuture.thenAccept(x -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">All entries removed</span><span class="delimiter">&quot;</span></span>);</code></pre> </div> </div> <div class="paragraph"> <p>The alternative way to remove all entries is to call <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html#truncate--"><code>truncate</code></a> operation which clears the entire cache contents in one go without invoking any listeners and is best-effort:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java">WriteOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; writeOnlyMap = ...

CompletableFuture&lt;<span class="predefined-type">Void</span>&gt; truncateFuture = writeOnlyMap.truncate();
truncateFuture.thenAccept(x -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Cache contents cleared</span><span class="delimiter">&quot;</span></span>);</code></pre> </div> </div> <div class="sect3"> <h4 id="_write_only_entry_view"><a class="anchor" href="#_write_only_entry_view"></a>1.5.1. Write-Only Entry View</h4> <div class="paragraph"> <p>The function parameters for write-only maps provide the user with a <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.WriteEntryView.html">write-only entry view</a> to modify the data in the cache, which include these operations:</p> </div> <div class="ulist"> <ul> <li> <p><a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.WriteEntryView.html#set-V-org.infinispan.commons.api.functional.MetaParam.Writable&#8230;-"><code>set(V, MetaParam.Writable...)</code></a> method allows for a new value to be associated with the cache entry for which this function is executed, and it optionally takes zero or more metadata parameters to be stored along with the value (see <a href="#_meta_parameter">Metadata Parameter Handling section</a> to find out more).</p> </li> <li> <p><a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.WriteEntryView.html#remove--"><code>remove()</code></a> method removes the cache entry, including both value and metadata parameters associated with this key.</p> </li> </ul> </div> </div> </div> <div class="sect2"> <h3 id="_read_write_map_api"><a class="anchor" href="#_read_write_map_api"></a>1.6. Read-Write Map API</h3> <div class="paragraph"> <p>The final type of operations we have are read­write operations, and within this category CAS-like (Compare­And­Swap) operations can be found. This type of operations require previous value associated with the key to be read and for locks to be acquired before executing the function. The vast majority of operations within <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentMap.html"><code>ConcurrentMap</code></a> and <a href="https://github.com/jsr107/jsr107spec/blob/v1.0.0/src/main/java/javax/cache/Cache.java"><code>JCache</code></a> APIs fall within this category, and they can easily be implemented using the <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadWriteMap.html">read-write map API</a> . Moreover, with <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadWriteMap.html">read-write map API</a> , you can make CAS­like comparisons not only based on value equality but based on metadata parameter equality such as version information, and you can send back previous value or boolean instances to signal whether the CAS­like comparison succeeded.</p> </div> <div class="paragraph"> <p>Implementing a write operation that returns the previous value associated with the cache entry is easy to achieve with the read-write map API:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.EntryView</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.FunctionalMap</span>.*;

ReadWriteMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; readWriteMap = ...

CompletableFuture&lt;Optional&lt;<span class="predefined-type">String</span>&gt;&gt; readWriteFuture = readWriteMap.eval(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>,
   (v, view) -&gt; {
      Optional&lt;V&gt; prev = rw.find();
      view.set(v);
      <span class="keyword">return</span> prev;
   });
readWriteFuture.thenAccept(<span class="predefined-type">System</span>.out::println);</code></pre> </div> </div> <div class="paragraph"> <p><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentMap.html#replace-K-V-V-"><code>ConcurrentMap.replace(K, V, V)</code></a> is a replace function that compares the value present in the map and if it&#8217;s equals to the value passed in as first parameter, the second value is stored, returning a boolean indicating whether the replace was successfully completed. This operation can easily be implemented using the read-write map API:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java">ReadWriteMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; readWriteMap = ...

String oldValue = <span class="string"><span class="delimiter">&quot;</span><span class="content">old-value</span><span class="delimiter">&quot;</span></span>;
CompletableFuture&lt;<span class="predefined-type">Boolean</span>&gt; replaceFuture = readWriteMap.eval(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>, (v, view) -&gt; {
   <span class="keyword">return</span> view.find().map(prev -&gt; {
      <span class="keyword">if</span> (prev.equals(oldValue)) {
         rw.set(v);
         <span class="keyword">return</span> <span class="predefined-constant">true</span>; <span class="comment">// previous value present and equals to the expected one</span>
      }
      <span class="keyword">return</span> <span class="predefined-constant">false</span>; <span class="comment">// previous value associated with key does not match</span>
   }).orElse(<span class="predefined-constant">false</span>); <span class="comment">// no value associated with this key</span>
});
replaceFuture.thenAccept(replaced -&gt; <span class="predefined-type">System</span>.out.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Value was replaced? %s%n</span><span class="delimiter">&quot;</span></span>, replaced));</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="icon-note" title="Note"></i> </td> <td class="content"> The function in the example above captures <code>oldValue</code> which is an external value to the function which is valid use case. </td> </tr> </table> </div> <div class="paragraph"> <p>Read-write map API contains <code>evalMany</code> and <code>evalAll</code> operations which behave similar to the write-only map offerings, except that they enable previous value and metadata parameters to be read.</p> </div> <div class="sect3"> <h4 id="_read_write_entry_view"><a class="anchor" href="#_read_write_entry_view"></a>1.6.1. Read-Write Entry View</h4> <div class="paragraph"> <p>The function parameters for read-write maps provide the user with the possibility to query the information associated with the key, including value and metadata parameters, and the user can also use this <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.ReadWriteEntryView.html">read-write entry view</a> to modify the data in the cache.</p> </div> <div class="paragraph"> <p>The operations are exposed by read-write entry views are a union of the operations exposed by <a href="#_read-only_entry_view">read-only entry views</a> and <a href="#_write_only_entry_view">write-only entry views</a></p> </div> </div> </div> <div class="sect2"> <h3 id="_meta_parameter"><a class="anchor" href="#_meta_parameter"></a>1.7. Metadata Parameter Handling</h3> <div class="paragraph"> <p><a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/MetaParam.html">Metadata parameters</a> provide extra information about the cache entry, such as version information, lifespan, last accessed/used time&#8230;etc. Some of these can be provided by the user, e.g. version, lifespan&#8230;etc, but some others are computed internally and can only be queried, e.g. last accessed/used time.</p> </div> <div class="paragraph"> <p>The functional map API provides a flexible way to store metadata parameters along with an cache entry. To be able to store a metadata parameter, it must extend <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/MetaParam.Lookup.html"><code>MetaParam.Writable</code></a> interface, and implement the methods to allow the internal logic to extra the data. Storing is done via the <code>set(V, MetaParam.Writable...)</code> method in <a href="#_write_only_entry_view">write-only entry view</a> or <a href="#_read_write_entry_view">read-write entry view</a> function parameters.</p> </div> <div class="paragraph"> <p>Querying metadata parameters is available via the <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/MetaParam.Lookup.html#findMetaParam-java.lang.Class-"><code>findMetaParam(Class)</code></a> method available via <a href="#_read_write_entry_view">read-write entry view</a> or <a href="#_read_only_entry_view">read-only entry view</a> or function parameters.</p> </div> <div class="paragraph"> <p>Here is an example showing how to store metadata parameters and how to query them:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">java.time.Duration</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.EntryView</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.FunctionalMap</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.MetaParam</span>.*;

WriteOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; writeOnlyMap = ...
ReadOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; readOnlyMap = ...

CompletableFuture&lt;<span class="predefined-type">Void</span>&gt; writeFuture = writeOnlyMap.eval(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>,
   (v, view) -&gt; view.set(v, <span class="keyword">new</span> MetaLifespan(<span class="predefined-type">Duration</span>.ofHours(<span class="integer">1</span>).toMillis())));
CompletableFuture&lt;MetaLifespan&gt; readFuture = writeFuture.thenCompose(r -&gt;
   readOnlyMap.eval(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, view -&gt; view.findMetaParam(MetaLifespan.class).get()));
readFuture.thenAccept(<span class="predefined-type">System</span>.out::println);</code></pre> </div> </div> <div class="paragraph"> <p>If the metadata parameter is generic, for example <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/MetaParam.MetaEntryVersion.html"><code>MetaEntryVersion&lt;T&gt;</code></a> , retrieving the metadata parameter along with a specific type can be tricky if using <code>.class</code> static helper in a class because it does not return a <code>Class&lt;T&gt;</code> but only <code>Class</code>, and hence any generic information in the class is lost:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java">ReadOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; readOnlyMap = ...

CompletableFuture&lt;<span class="predefined-type">String</span>&gt; readFuture = readOnlyMap.eval(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, view -&gt; {
   <span class="comment">// If caller depends on the typed information, this is not an ideal way to retrieve it</span>
   <span class="comment">// If the caller does not depend on the specific type, this works just fine.</span>
   Optional&lt;MetaEntryVersion&gt; version = view.findMetaParam(MetaLifespan.class);
   <span class="keyword">return</span> view.get();
});</code></pre> </div> </div> <div class="paragraph"> <p>When generic information is important the user can define a static helper method that coerces the static class retrieval to the type requested, and then use that helper method in the call to <code>findMetaParam</code>:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="type">class</span> <span class="class">MetaEntryVersion</span>&lt;T&gt; <span class="directive">implements</span> MetaParam.Writable&lt;EntryVersion&lt;T&gt;&gt; {
   ...
   public <span class="directive">static</span> &lt;T&gt; T type() { <span class="keyword">return</span> (T) MetaEntryVersion.class; }
   ...
}

ReadOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; readOnlyMap = ...

CompletableFuture&lt;<span class="predefined-type">String</span>&gt; readFuture = readOnlyMap.eval(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, view -&gt; {
   <span class="comment">// The caller wants guarantees that the metadata parameter for version is numeric</span>
   <span class="comment">// e.g. to query the actual version information</span>
   Optional&lt;MetaEntryVersion&lt;<span class="predefined-type">Long</span>&gt;&gt; version = view.findMetaParam(MetaLifespan.type());
   <span class="keyword">return</span> view.get();
});</code></pre> </div> </div> <div class="paragraph"> <p>Finally, users are free to create new instances of metadata parameters to suit their needs. They are stored and retrieved in the very same way as done for the metadata parameters already provided by the functional map API.</p> </div> </div> <div class="sect2"> <h3 id="_invocation_parameter"><a class="anchor" href="#_invocation_parameter"></a>1.8. Invocation Parameter</h3> <div class="paragraph"> <p><a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Param.html">Per-invocation parameters</a> are applied to regular functional map API calls to alter the behaviour of certain aspects. Adding per invocation parameters is done using the <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.html#withParams-org.infinispan.commons.api.functional.Param&#8230;-"><code>withParams(Param&lt;?&gt;...)</code></a> method.</p> </div> <div class="paragraph"> <p><a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Param.FutureMode.html"><code>Param.FutureMode</code></a> tweaks whether a method returning a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html"><code>CompletableFuture</code></a> will span a thread to invoke the method, or instead will use the caller thread. By default, whenever a call is made to a method returning a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html"><code>CompletableFuture</code></a> , a separate thread will be span to execute the method asynchronously. However, if the caller will immediately block waiting for the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html"><code>CompletableFuture</code></a> to complete, spanning a different thread is wasteful, and hence <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Param.FutureMode.html#COMPLETED"><code>Param.FutureMode.COMPLETED</code></a> can be passed as per-invocation parameter to avoid creating that extra thread. Example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.EntryView</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.FunctionalMap</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.Param</span>.*;

ReadOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; readOnlyMap = ...
ReadOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; readOnlyMapCompleted = readOnlyMap.withParams(FutureMode.COMPLETED);
Optional&lt;<span class="predefined-type">String</span>&gt; readFuture = readOnlyMapCompleted.eval(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, ReadEntryView::find).get();</code></pre> </div> </div> <div class="paragraph"> <p>Param.PersistenceMode controls whether a write operation will be propagated to a persistence store. The default behaviour is for all write-operations to be propagated to the persistence store if the cache is configured with a persistence store. By passing PersistenceMode.SKIP as parameter, the write operation skips the persistence store and its effects are only seen in the in-memory contents of the cache. PersistenceMode.SKIP can be used to implement an <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/Cache.html#evict-K-"><code>Cache.evict()</code></a> method which removes data from memory but leaves the persistence store untouched:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.EntryView</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.FunctionalMap</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.Param</span>.*;

WriteOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; writeOnlyMap = ...
WriteOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; skiPersistMap = writeOnlyMap.withParams(PersistenceMode.SKIP);
CompletableFuture&lt;<span class="predefined-type">Void</span>&gt; removeFuture = skiPersistMap.eval(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, WriteEntryView::remove);</code></pre> </div> </div> <div class="paragraph"> <p>Note that there&#8217;s no need for another PersistenceMode option to skip reading from the persistence store, because a write operation can skip reading previous value from the store by calling a write-only operation via the WriteOnlyMap.</p> </div> <div class="paragraph"> <p>Finally, new Param implementations are normally provided by the functional map API since they tweak how the internal logic works. So, for the most part of users, they should limit themselves to using the Param instances exposed by the API. The exception to this rule would be advanced users who decide to add new interceptors to the internal stack. These users have the ability to query these parameters within the interceptors.</p> </div> </div> <div class="sect2"> <h3 id="_functional_listeners"><a class="anchor" href="#_functional_listeners"></a>1.9. Functional Listeners</h3> <div class="paragraph"> <p>The functional map offers a listener API, where clients can register for and get notified when events take place. These notifications are post-event, so that means the events are received after the event has happened.</p> </div> <div class="paragraph"> <p>The listeners that can be registered are split into two categories: <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.WriteListeners.html">write listeners</a> and <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.html">read-write listeners</a>.</p> </div> <div class="sect3"> <h4 id="_write_listeners"><a class="anchor" href="#_write_listeners"></a>1.9.1. Write Listeners</h4> <div class="paragraph"> <p><a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.WriteListeners.html">Write listeners</a> enable user to register listeners for any cache entry write events that happen in either a read-write or write-only functional map.</p> </div> <div class="paragraph"> <p>Listeners for write events cannot distinguish between cache entry created and cache entry modify/update events because they don&#8217;t have access to the previous value. All they know is that a new non-null entry has been written.</p> </div> <div class="paragraph"> <p>However, write event listeners can distinguish between entry removals and cache entry create/modify-update events because they can query what the new entry&#8217;s value via <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/EntryView.ReadEntryView.html#find--"><code>ReadEntryView.find()</code></a> method.</p> </div> <div class="paragraph"> <p>Adding a write listener is done via the WriteListeners interface which is accessible via both <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadWriteMap.html#listeners--"><code>ReadWriteMap.listeners()</code></a> and <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.WriteOnlyMap.html#listeners--"><code>WriteOnlyMap.listeners()</code></a> method.</p> </div> <div class="paragraph"> <p>A write listener implementation can be defined either passing a function to <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.WriteListeners.html#onWrite-java.util.function.Consumer-"><code>onWrite(Consumer&lt;ReadEntryView&lt;K, V&gt;&gt;)</code></a> method, or passing a WriteListener implementation to <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.WriteListeners.html#add-org.infinispan.commons.api.functional.Listeners.WriteListeners.WriteListener-"><code>add(WriteListener&lt;K, V&gt;)</code></a> method. Either way, all these methods return an <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/AutoCloseable.html">AutoCloseable</a> instance that can be used to de-register the function listener:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.EntryView</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.FunctionalMap</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.Listeners.WriteListeners.WriteListener</span>;

WriteOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; woMap = ...

AutoCloseable writeFunctionCloseHandler = woMap.listeners().onWrite(written -&gt; {
   <span class="comment">// `written` is a ReadEntryView of the written entry</span>
   <span class="predefined-type">System</span>.out.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Written: %s%n</span><span class="delimiter">&quot;</span></span>, written.get());
});
AutoCloseable writeCloseHanlder = woMap.listeners.add(<span class="keyword">new</span> WriteListener&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;() {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> onWrite(ReadEntryView&lt;K, V&gt; written) {
      <span class="predefined-type">System</span>.out.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Written: %s%n</span><span class="delimiter">&quot;</span></span>, written.get());
   }
});

<span class="comment">// Either wrap handler in a try section to have it auto close...</span>
<span class="keyword">try</span>(writeFunctionCloseHandler) {
   <span class="comment">// Write entries using read-write or write-only functional map API</span>
   ...
}
<span class="comment">// Or close manually</span>
writeCloseHanlder.close();</code></pre> </div> </div> </div> <div class="sect3"> <h4 id="_read_write_listeners"><a class="anchor" href="#_read_write_listeners"></a>1.9.2. Read-Write Listeners</h4> <div class="paragraph"> <p><a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.html">Read-write listeners</a> enable users to register listeners for cache entry created, modified and removed events, and also register listeners for any cache entry write events.</p> </div> <div class="paragraph"> <p>Entry created, modified and removed events can only be fired when these originate on a read-write functional map, since this is the only one that guarantees that the previous value has been read, and hence the differentiation between create, modified and removed can be fully guaranteed.</p> </div> <div class="paragraph"> <p>Adding a read-write listener is done via the <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.html"><code>ReadWriteListeners</code></a> interface which is accessible via <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/FunctionalMap.ReadWriteMap.html#listeners--"><code>ReadWriteMap.listeners()</code></a> method.</p> </div> <div class="paragraph"> <p>If interested in only one of the event types, the simplest way to add a listener is to pass a function to either <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.ReadWriteListener.html#onCreate-org.infinispan.commons.api.functional.EntryView.ReadEntryView-"><code>onCreate</code></a> , <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.ReadWriteListener.html#onModify-org.infinispan.commons.api.functional.EntryView.ReadEntryView-org.infinispan.commons.api.functional.EntryView.ReadEntryView-"><code>onModify</code></a> or <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.ReadWriteListener.html#onRemove-org.infinispan.commons.api.functional.EntryView.ReadEntryView-"><code>onRemove</code></a> methods. All these methods return an AutoCloseable instance that can be used to de-register the function listener:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.EntryView</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.FunctionalMap</span>.*;

ReadWriteMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; rwMap = ...
AutoCloseable createClose = rwMap.listeners().onCreate(created -&gt; {
   <span class="comment">// `created` is a ReadEntryView of the created entry</span>
   <span class="predefined-type">System</span>.out.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Created: %s%n</span><span class="delimiter">&quot;</span></span>, created.get());
});
AutoCloseable modifyClose = rwMap.listeners().onModify((before, after) -&gt; {
   <span class="comment">// `before` is a ReadEntryView of the entry before update</span>
   <span class="comment">// `after` is a ReadEntryView of the entry after update</span>
   <span class="predefined-type">System</span>.out.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Before: %s%n</span><span class="delimiter">&quot;</span></span>, before.get());
   <span class="predefined-type">System</span>.out.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">After: %s%n</span><span class="delimiter">&quot;</span></span>, after.get());
});
AutoCloseable removeClose = rwMap.listeners().onRemove(removed -&gt; {
   <span class="comment">// `removed` is a ReadEntryView of the removed entry</span>
   <span class="predefined-type">System</span>.out.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Removed: %s%n</span><span class="delimiter">&quot;</span></span>, removed.get());
});
AutoCloseable writeClose = woMap.listeners().onWrite(written -&gt; {
   <span class="comment">// `written` is a ReadEntryView of the written entry</span>
   <span class="predefined-type">System</span>.out.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Written: %s%n</span><span class="delimiter">&quot;</span></span>, written.get());
});
...
<span class="comment">// Either wrap handler in a try section to have it auto close...</span>
try(createClose) {
   <span class="comment">// Create entries using read-write functional map API</span>
   ...
}
<span class="comment">// Or close manually</span>
modifyClose.close();</code></pre> </div> </div> <div class="paragraph"> <p>If listening for two or more event types, it&#8217;s better to pass in an implementation of <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.WriteListeners.WriteListener.html"><code>ReadWriteListener</code></a> interface via the <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/api/functional/Listeners.ReadWriteListeners.html#add-org.infinispan.commons.api.functional.Listeners.ReadWriteListeners.ReadWriteListener-"><code>ReadWriteListeners.add()</code></a> method. <code>ReadWriteListener</code> offers the same <code>onCreate</code>/<code>onModify</code>/<code>onRemove</code> callbacks with default method implementations that are empty:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.EntryView</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.FunctionalMap</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.Listeners.ReadWriteListeners.ReadWriteListener</span>;

ReadWriteMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; rwMap = ...
AutoCloseable readWriteClose = rwMap.listeners.add(<span class="keyword">new</span> ReadWriteListener&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;() {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> onCreate(ReadEntryView&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; created) {
      <span class="predefined-type">System</span>.out.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Created: %s%n</span><span class="delimiter">&quot;</span></span>, created.get());
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> onModify(ReadEntryView&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; before, ReadEntryView&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; after) {
      <span class="predefined-type">System</span>.out.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Before: %s%n</span><span class="delimiter">&quot;</span></span>, before.get());
      <span class="predefined-type">System</span>.out.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">After: %s%n</span><span class="delimiter">&quot;</span></span>, after.get());
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> onRemove(ReadEntryView&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; removed) {
      <span class="predefined-type">System</span>.out.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Removed: %s%n</span><span class="delimiter">&quot;</span></span>, removed.get());
   }
);
AutoCloseable writeClose = rwMap.listeners.add(<span class="keyword">new</span> WriteListener&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;() {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> onWrite(ReadEntryView&lt;K, V&gt; written) {
      <span class="predefined-type">System</span>.out.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">Written: %s%n</span><span class="delimiter">&quot;</span></span>, written.get());
   }
);

<span class="comment">// Either wrap handler in a try section to have it auto close...</span>
<span class="keyword">try</span>(readWriteClose) {
   <span class="comment">// Create/update/remove entries using read-write functional map API</span>
   ...
}
<span class="comment">// Or close manually</span>
writeClose.close();</code></pre> </div> </div> </div> </div> <div class="sect2"> <h3 id="_marshalling_of_functions"><a class="anchor" href="#_marshalling_of_functions"></a>1.10. Marshalling of Functions</h3> <div class="paragraph"> <p>Running functional map in a cluster of nodes involves marshalling and replication of the operation parameters under certain circumstances.</p> </div> <div class="paragraph"> <p>To be more precise, when write operations are executed in a cluster, regardless of read-write or write-only operations, all the parameters to the method and the functions are replicated to other nodes.</p> </div> <div class="paragraph"> <p>There are multiple ways in which a function can be marshalled. The simplest way, which is also the most costly option in terms of payload size, is to mark the function as <a href="http://docs.oracle.com/javase/8/docs/api/java/io/Serializable.html"><code>Serializable</code></a> :</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.EntryView</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.FunctionalMap</span>.*;

WriteOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; writeOnlyMap = ...

<span class="comment">// Force a function to be Serializable</span>
Consumer&lt;WriteEntryView&lt;<span class="predefined-type">String</span>&gt;&gt; function =
   (Consumer&lt;WriteEntryView&lt;<span class="predefined-type">String</span>&gt;&gt; &amp; <span class="predefined-type">Serializable</span>) wv -&gt; wv.set(<span class="string"><span class="delimiter">&quot;</span><span class="content">one</span><span class="delimiter">&quot;</span></span>);

CompletableFuture&lt;<span class="predefined-type">Void</span>&gt; writeFuture = writeOnlyMap.eval(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, function);</code></pre> </div> </div> <div class="paragraph"> <p>A more economical way to marshall a function is to provide an Infinispan <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/marshall/Externalizer.html"><code>Externalizer</code></a> for it:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.EntryView</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.FunctionalMap</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.marshall.Externalizer</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.marshall.SerializeFunctionWith</span>;

WriteOnlyMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; writeOnlyMap = ...

<span class="comment">// Force a function to be Serializable</span>
Consumer&lt;WriteEntryView&lt;<span class="predefined-type">String</span>&gt;&gt; function = <span class="keyword">new</span> SetStringConstant&lt;&gt;();
CompletableFuture&lt;<span class="predefined-type">Void</span>&gt; writeFuture = writeOnlyMap.eval(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, function);

<span class="annotation">@SerializeFunctionWith</span>(value = SetStringConstant.Externalizer0.class)
<span class="type">class</span> <span class="class">SetStringConstant</span> <span class="directive">implements</span> Consumer&lt;WriteEntryView&lt;<span class="predefined-type">String</span>&gt;&gt; {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> accept(WriteEntryView&lt;<span class="predefined-type">String</span>&gt; view) {
      view.set(<span class="string"><span class="delimiter">&quot;</span><span class="content">value1</span><span class="delimiter">&quot;</span></span>);
   }

   <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">Externalizer0</span> <span class="directive">implements</span> Externalizer&lt;<span class="predefined-type">Object</span>&gt; {
      <span class="directive">public</span> <span class="type">void</span> writeObject(<span class="predefined-type">ObjectOutput</span> oo, <span class="predefined-type">Object</span> o) {
         <span class="comment">// No-op</span>
      }
      <span class="directive">public</span> <span class="predefined-type">Object</span> readObject(<span class="predefined-type">ObjectInput</span> input) {
         <span class="keyword">return</span> <span class="keyword">new</span> SetStringConstant&lt;&gt;();
      }
   }
}</code></pre> </div> </div> <div class="paragraph"> <p>To help users take advantage of the tiny payloads generated by <code>Externalizer</code>-based functions, the functional API comes with a helper class called <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/marshall/MarshallableFunctions.html"><code>org.infinispan.commons.marshall.MarshallableFunctions</code></a> which provides marshallable functions for some of the most commonly user functions.</p> </div> <div class="paragraph"> <p>In fact, all the functions required to implement <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentMap.html"><code>ConcurrentMap</code></a> and <a href="https://github.com/jsr107/jsr107spec/blob/v1.0.0/src/main/java/javax/cache/Cache.java"><code>JCache</code></a> using the functional map API have been defined in <a href="https://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/commons/marshall/MarshallableFunctions.html"><code>MarshallableFunctions</code></a>. For example, here is an implementation of JCache&#8217;s <a href="https://github.com/jsr107/jsr107spec/blob/v1.0.0/src/main/java/javax/cache/Cache.java#L283"><code>boolean putIfAbsent(K, V)</code></a> using functional map API which can be run in a cluster:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.EntryView</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.api.functional.FunctionalMap</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.commons.marshall.MarshallableFunctions</span>;

ReadWriteMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; readWriteMap = ...

CompletableFuture&lt;<span class="predefined-type">Boolean</span>&gt; future = readWriteMap.eval(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1,
   MarshallableFunctions.setValueIfAbsentReturnBoolean());
future.thenAccept(stored -&gt; System.out.printf(</span><span class="delimiter">&quot;</span></span>Value was put? %s%n<span class="string"><span class="delimiter">&quot;</span><span class="content">, stored));</span></span></code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_use_cases_for_functional_api"><a class="anchor" href="#_use_cases_for_functional_api"></a>1.11. Use cases for Functional API</h3> <div class="paragraph"> <p>This new API is meant to complement existing Key/Value Infinispan API offerings, so you&#8217;ll still be able to use <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentMap.html"><code>ConcurrentMap</code></a> or <a href="https://github.com/jsr107/jsr107spec/blob/v1.0.0/src/main/java/javax/cache/Cache.java"><code>JCache</code></a> standard APIs if that&#8217;s what suits your use case best.</p> </div> <div class="paragraph"> <p>The target audience for this new API is either:</p> </div> <div class="ulist"> <ul> <li> <p>Distributed or persistent caching/in­memory­data­grid users that want to benefit from CompletableFuture and/or Traversable for async/lazy data grid or caching data manipulation. The clear advantage here is that threads do not need to be idle waiting for remote operations to complete, but instead these can be notified when remote operations complete and then chain them with other subsequent operations.</p> </li> <li> <p>Users wanting to go beyond the standard operations exposed by <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ConcurrentMap.html"><code>ConcurrentMap</code></a> and <a href="https://github.com/jsr107/jsr107spec/blob/v1.0.0/src/main/java/javax/cache/Cache.java"><code>JCache</code></a> , for example, if you want to do a replace operation using metadata parameter equality instead of value equality, or if you want to retrieve metadata information from values&#8230;etc.</p> </li> </ul> </div> </div> </div> </div> </div> <div id="footer"> <div id="footer-text"> Last updated 2015-10-19 11:29:02 EDT </div> </div> </body> </html>