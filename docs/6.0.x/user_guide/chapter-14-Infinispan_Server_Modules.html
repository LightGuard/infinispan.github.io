<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="generator" content="Asciidoctor 0.1.4"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Server Modules</title> <style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }
audio, canvas, video { display: inline-block; }
audio:not([controls]) { display: none; height: 0; }
[hidden] { display: none; }
html { background: #fff; color: #000; font-family: sans-serif; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; }
body { margin: 0; }
a:focus { outline: thin dotted; }
a:active, a:hover { outline: 0; }
h1 { font-size: 2em; margin: 0.67em 0; }
abbr[title] { border-bottom: 1px dotted; }
b, strong { font-weight: bold; }
dfn { font-style: italic; }
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }
mark { background: #ff0; color: #000; }
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }
pre { white-space: pre-wrap; }
q { quotes: "\201C" "\201D" "\2018" "\2019"; }
small { font-size: 80%; }
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }
img { border: 0; }
svg:not(:root) { overflow: hidden; }
figure { margin: 0; }
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }
legend { border: 0; padding: 0; }
button, input, select, textarea { font-family: inherit; font-size: 100%; margin: 0; }
button, input { line-height: normal; }
button, select { text-transform: none; }
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; cursor: pointer; }
button[disabled], html input[disabled] { cursor: default; }
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; padding: 0; }
input[type="search"] { -webkit-appearance: textfield; -moz-box-sizing: content-box; -webkit-box-sizing: content-box; box-sizing: content-box; }
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }
textarea { overflow: auto; vertical-align: top; }
table { border-collapse: collapse; border-spacing: 0; }
*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
html, body { font-size: 100%; }
body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }
a:hover { cursor: pointer; }
a:focus { outline: none; }
img, object, embed { max-width: 100%; height: auto; }
object, embed { height: 100%; }
img { -ms-interpolation-mode: bicubic; }
#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }
.left { float: left !important; }
.right { float: right !important; }
.text-left { text-align: left !important; }
.text-right { text-align: right !important; }
.text-center { text-align: center !important; }
.text-justify { text-align: justify !important; }
.hide { display: none; }
.antialiased, body { -webkit-font-smoothing: antialiased; }
img { display: inline-block; vertical-align: middle; }
textarea { height: auto; min-height: 50px; }
select { width: 100%; }
p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }
.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #7a2518; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }
a { color: #005498; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #00467f; }
a img { border: none; }
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Georgia, "URW Bookman L", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }
h1 { font-size: 2.125em; }
h2 { font-size: 1.6875em; }
h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }
h4 { font-size: 1.125em; }
h5 { font-size: 1.125em; }
h6 { font-size: 1em; }
hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }
em, i { font-style: italic; line-height: inherit; }
strong, b { font-weight: bold; line-height: inherit; }
small { font-size: 60%; line-height: inherit; }
code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; color: #6d180b; }
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }
ul, ol { margin-left: 1.5em; }
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }
abbr { text-transform: none; }
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: inherit; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }
blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }
.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }
@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
.print-only { display: none !important; }
@media print { * { background: transparent !important; color: #000 !important; box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }
.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }
*:not(pre) > code { font-size: 0.9375em; padding: 1px 3px 0; white-space: nowrap; background-color: #f2f2f2; border: 1px solid #cccccc; -webkit-border-radius: 4px; border-radius: 4px; text-shadow: none; }
pre, pre > code { line-height: 1.4; color: inherit; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }
kbd.keyseq { color: #555555; }
kbd:not(.keyseq) { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }
kbd kbd:first-child { margin-left: 0; }
kbd kbd:last-child { margin-right: 0; }
.menuseq, .menu { color: #090909; }
p a > code:hover { color: #561309; }
#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }
#header { margin-bottom: 2.5em; }
#header > h1 { color: black; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #6f6f6f; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }
#toc { border-bottom: 3px double #ebebeb; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }
#toctitle { color: #7a2518; }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; }
  #toc.toc2 { position: fixed; width: 20em; left: 0; top: 0; border-right: 1px solid #ebebeb; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; }
  #toc.toc2 > ul { font-size: .95em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1.25em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #ebebeb; left: auto; right: 0; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; border-width: 0; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }
#content #toctitle { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-size: 1em; padding-left: 0.125em; }
#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }
#footer-text { color: #dddddd; line-height: 1.44; }
.sect1 { padding-bottom: 1.25em; }
.sect1 + .sect1 { border-top: 3px double #ebebeb; }
#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }
.imageblock, .literalblock, .listingblock, .verseblock, .videoblock { margin-bottom: 1.25em; }
.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }
.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }
table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }
.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #6f6f6f; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }
.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }
.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }
.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; line-height: 1.6; }
.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }
.literalblock > .content pre, .listingblock > .content pre { background: none; border-width: 1px 0; border-style: dotted; border-color: #bfbfbf; -webkit-border-radius: 4px; border-radius: 4px; padding: 0.75em 0.75em 0.5em 0.75em; word-wrap: break-word; }
.literalblock > .content pre.nowrap, .listingblock > .content pre.nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock > .content pre > code, .listingblock > .content pre > code { display: block; }
@media only screen { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.8em; } }
@media only screen and (min-width: 768px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.9em; } }
@media only screen and (min-width: 1280px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 1em; } }
.listingblock > .content { position: relative; }
.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }
.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }
.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }
.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }
table.pyhltable { border: 0; margin-bottom: 0; }
table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }
table.pyhltable td.code { padding-left: .75em; padding-right: 0; }
.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }
.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }
table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }
.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: inherit; color: #555555; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }
table thead th, table tfoot th { font-weight: bold; }
table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 4px; border-radius: 4px; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }
table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }
table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }
table.tableblock td .paragraph:last-child p, table.tableblock td > p:last-child { margin-bottom: 0; }
th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }
th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }
th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }
th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }
th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }
th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }
p.tableblock.header { color: #222222; font-weight: bold; }
td > div.verse { white-space: pre; }
ol { margin-left: 1.75em; }
ul li ol { margin-left: 1.5em; }
dl dd { margin-left: 1.125em; }
dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }
ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }
ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }
ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }
ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }
ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }
ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }
.unstyled dl dt { font-weight: normal; font-style: normal; }
ol.arabic { list-style-type: decimal; }
ol.decimal { list-style-type: decimal-leading-zero; }
ol.loweralpha { list-style-type: lower-alpha; }
ol.upperalpha { list-style-type: upper-alpha; }
ol.lowerroman { list-style-type: lower-roman; }
ol.upperroman { list-style-type: upper-roman; }
ol.lowergreek { list-style-type: lower-greek; }
.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }
td.hdlist1 { padding-right: .8em; font-weight: bold; }
td.hdlist1, td.hdlist2 { vertical-align: top; }
.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }
.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }
.qanda > ol > li > p > em:only-child { color: #00467f; }
.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }
.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }
.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }
a.image { text-decoration: none; }
span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }
.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }
div.unbreakable { page-break-inside: avoid; }
.big { font-size: larger; }
.small { font-size: smaller; }
.underline { text-decoration: underline; }
.overline { text-decoration: overline; }
.line-through { text-decoration: line-through; }
.aqua { color: #00bfbf; }
.aqua-background { background-color: #00fafa; }
.black { color: black; }
.black-background { background-color: black; }
.blue { color: #0000bf; }
.blue-background { background-color: #0000fa; }
.fuchsia { color: #bf00bf; }
.fuchsia-background { background-color: #fa00fa; }
.gray { color: #606060; }
.gray-background { background-color: #7d7d7d; }
.green { color: #006000; }
.green-background { background-color: #007d00; }
.lime { color: #00bf00; }
.lime-background { background-color: #00fa00; }
.maroon { color: #600000; }
.maroon-background { background-color: #7d0000; }
.navy { color: #000060; }
.navy-background { background-color: #00007d; }
.olive { color: #606000; }
.olive-background { background-color: #7d7d00; }
.purple { color: #600060; }
.purple-background { background-color: #7d007d; }
.red { color: #bf0000; }
.red-background { background-color: #fa0000; }
.silver { color: #909090; }
.silver-background { background-color: #bcbcbc; }
.teal { color: #006060; }
.teal-background { background-color: #007d7d; }
.white { color: #bfbfbf; }
.white-background { background-color: #fafafa; }
.yellow { color: #bfbf00; }
.yellow-background { background-color: #fafa00; }
span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }
.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #005498; color: #003f72; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }
.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }
.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 0; border-radius: 0; }

</style> <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css"> <style>
/* Foundation stylesheet for CodeRay (to match GitHub theme) | MIT License | http://foundation.zurb.com */
table.CodeRay { border-collapse: collapse; padding: 2px; margin-bottom: 0; border: 0; background: transparent; }
table.CodeRay td { padding: 0 .5em; vertical-align: top; }
table.CodeRay td.line-numbers { text-align: right; color: #999; border-right: 1px solid #e5e5e5; padding-left: 0; }
span.line-numbers { border-right: 1px solid #E5E5E5; color: #999; display: inline-block; margin-right: 0.5em; padding-right: 0.5em; }
.CodeRay td.line-numbers strong, .CodeRay span.line-numbers strong { font-weight: normal; }
.CodeRay .debug { color: white !important; background: blue !important; }
.CodeRay .annotation { color: #007; }
.CodeRay .attribute-name { color: #f08; }
.CodeRay .attribute-value { color: #700; }
.CodeRay .binary { color: #509; }
.CodeRay .comment  { color: #999; font-style: italic; }
.CodeRay .char { color: #04D; }
.CodeRay .char .content { color: #04D; }
.CodeRay .char .delimiter { color: #039; }
.CodeRay .class { color: #458; }
.CodeRay .complex { color: #A08; }
.CodeRay .constant { color: teal; }
.CodeRay .color { color: #0A0; }
.CodeRay .class-variable { color: #369; }
.CodeRay .decorator { color: #B0B; }
.CodeRay .definition { color: #099; }
.CodeRay .directive { color: #088; }
.CodeRay .delimiter { color: black; }
.CodeRay .doc { color: #970; }
.CodeRay .doctype { color: #34b; }
.CodeRay .doc-string { color: #D42; }
.CodeRay .escape  { color: #666; }
.CodeRay .entity { color: #800; }
.CodeRay .error { color: #808; }
.CodeRay .exception { color: #C00; }
.CodeRay .filename { color: #099; }
.CodeRay .function { color: #900; }
.CodeRay .global-variable { color: teal; }
.CodeRay .hex { color: #058; }
.CodeRay .integer  { color: #099; }
.CodeRay .include { color: #B44; }
.CodeRay .inline { color: black; }
.CodeRay .inline .inline { background: #ccc; }
.CodeRay .inline .inline .inline { background: #bbb; }
.CodeRay .inline .inline-delimiter { color: #D14; }
.CodeRay .inline-delimiter { color: #D14; }
.CodeRay .important { color: #f00; }
.CodeRay .interpreted { color: #B2B; }
.CodeRay .instance-variable { color: teal; }
.CodeRay .label { color: #970; }
.CodeRay .local-variable { color: #963; }
.CodeRay .octal { color: #40E; }
.CodeRay .predefined { color: #369; }
.CodeRay .preprocessor { color: #579; }
.CodeRay .pseudo-class { color: #00C; }
.CodeRay .predefined-type { color: #074; }
.CodeRay .reserved, .keyword  { color: #000; }
.CodeRay .key { color: #808; }
.CodeRay .key .delimiter { color: #606; }
.CodeRay .key .char { color: #80f; }
.CodeRay .value { color: #088; }
.CodeRay .regexp { background-color: #fff0ff; }
.CodeRay .regexp .content { color: #808; }
.CodeRay .regexp .delimiter { color: #404; }
.CodeRay .regexp .modifier { color: #C2C; }
.CodeRay .regexp .function  { color: #404; font-weight: bold; }
.CodeRay .string { color: #D20; }
.CodeRay .string .string { }
.CodeRay .string .string .string { background-color: #ffd0d0; }
.CodeRay .string .content { color: #D14; }
.CodeRay .string .char { color: #D14; }
.CodeRay .string .delimiter { color: #D14; }
.CodeRay .shell { color: #D14; }
.CodeRay .shell .content { }
.CodeRay .shell .delimiter { color: #D14; }
.CodeRay .symbol { color: #990073; }
.CodeRay .symbol .content { color: #A60; }
.CodeRay .symbol .delimiter { color: #630; }
.CodeRay .tag, .CodeRay .attribute-name { color: #070; }
.CodeRay .tag-special { color: #D70; }
.CodeRay .type { color: #339; }
.CodeRay .variable  { color: #036; }
.CodeRay .insert { background: #afa; }
.CodeRay .delete { background: #faa; }
.CodeRay .change { color: #aaf; background: #007; }
.CodeRay .head { color: #f8f; background: #505; }
.CodeRay .insert .insert { color: #080; }
.CodeRay .delete .delete { color: #800; }
.CodeRay .change .change { color: #66f; }
.CodeRay .head .head { color: #f4f; }

</style> </head> <body class="book"> <div id="header"> </div> <div id="content"> <div class="sect1"> <h2 id="_server_modules"><a class="anchor" href="#_server_modules"></a>1. Server Modules</h2> <div class="sectionbody"> <div class="paragraph"> <p>Applications primarily interacted with Infinispan in a peer-to-peer (p2p), embedded fashion where Infinispan and the client code that accessed it lived within the same JVM.</p> </div> <div class="paragraph"> <p>When Infinispan is accessed in this way, it is considered to be accessed in an embedded fashion, as shown in the screenshot below</p> </div> <div class="imageblock"> <div class="content"> <img src="images/server_modules_1.png" alt="server modules 1"> </div> </div> <div class="sect2"> <h3 id="_why_client_server"><a class="anchor" href="#_why_client_server"></a>1.1. Why Client-Server?</h3> <div class="paragraph"> <p>However, there are situations when accessing Infinispan in a client-server mode might make more sense than accessing it via p2p. For example, when trying to access Infinispan from a non-JVM environment. Since Infinispan is written in Java, if someone had a C++ application that wanted to access it, it couldn&#8217;t just do it in a p2p way. On the other hand, client-server would be perfectly suited here assuming that a language neutral protocol was used and the corresponding client and server implementations were available.</p> </div> <div class="imageblock"> <div class="content"> <img src="images/server_modules_2.png" alt="server modules 2"> </div> </div> <div class="paragraph"> <p>In other situations, Infinispan users want to have an elastic application tier where you start/stop business processing servers very regularly. Now, if users deployed Infinispan configured with distribution or state transfer, startup time could be greatly influenced by the shuffling around of data that happens in these situations. So in the following diagram, assuming Infinispan was deployed in p2p mode, the app in the second server could not access Infinispan until state transfer had completed.</p> </div> <div class="imageblock"> <div class="content"> <img src="images/server_modules_3.png" alt="server modules 3"> </div> </div> <div class="paragraph"> <p>This effectively means that bringing up new application-tier servers is impacted by things like state transfer because applications cannot access Infinispan until these processes have finished and if the state being shifted around is large, this could take some time. This is undesirable in an elastic environment where you want quick application-tier server turnaround and predictable startup times. Problems like this can be solved by accessing Infinispan in a client-server mode because starting a new application-tier server is just a matter of starting a lightweight client that can connect to the backing data grid server. No need for rehashing or state transfer to occur and as a result server startup times can be more predictable which is very important for modern cloud-based deployments where elasticity in your application tier is important.</p> </div> <div class="imageblock"> <div class="content"> <img src="images/AchievingElasticity.png" alt="AchievingElasticity"> </div> </div> <div class="paragraph"> <p>Other times, it&#8217;s common to find multiple applications needing access to data storage. In this cases, you could in theory deploy an Infinispan instance per each of those applications but this could be wasteful and difficult to maintain. Thing about databases here, you don&#8217;t deploy a database alongside each of your applications, do you? So, alternatively you could deploy Infinispan in client-server mode keeping a pool of Infinispan data grid nodes acting as a shared storage tier for your applications.</p> </div> <div class="imageblock"> <div class="content"> <img src="images/server_modules_4.png" alt="server modules 4"> </div> </div> <div class="paragraph"> <p>Deploying Infinispan in this way also allows you to manage each tier independently, for example, you can upgrade you application or app server without bringing down your Infinispan data grid nodes.</p> </div> </div> <div class="sect2"> <h3 id="_why_use_embedded_mode"><a class="anchor" href="#_why_use_embedded_mode"></a>1.2. Why use embedded mode?</h3> <div class="paragraph"> <p>Before talking about individual Infinispan server modules, it&#8217;s worth mentioning that in spite of all the benefits, client-server Infinispan still has disadvantages over p2p. Firstly, p2p deployments are simpler than client-server ones because in p2p, all peers are equals to each other and hence this simplifies deployment. So, if this is the first time you&#8217;re using Infinispan, p2p is likely to be easier for you to get going compared to client-server.</p> </div> <div class="paragraph"> <p>Client-server Infinispan requests are likely to take longer compared to p2p requests, due to the serialization and network cost in remote calls. So, this is an important factor to take in account when designing your application. For example, with replicated Infinispan caches, it might be more performant to have lightweight HTTP clients connecting to a server side application that accesses Infinispan in p2p mode, rather than having more heavyweight client side apps talking to Infinispan in client-server mode, particularly if data size handled is rather large. With distributed caches, the difference might not be so big because even in p2p deployments, you&#8217;re not guaranteed to have all data available locally.</p> </div> <div class="paragraph"> <p>Environments where application tier elasticity is not so important, or where server side applications access state-transfer-disabled, replicated Infinispan cache instances are amongst scenarios where Infinispan p2p deployments can be more suited than client-server ones.</p> </div> </div> <div class="sect2"> <h3 id="_server_modules_2"><a class="anchor" href="#_server_modules_2"></a>1.3. Server Modules</h3> <div class="paragraph"> <p>So, now that it&#8217;s clear when it makes sense to deploy Infinispan in client-server mode, what are available solutions? All Infinispan server modules are based on the same pattern where the server backend creates an embedded Infinispan instance and if you start multiple backends, they can form a cluster and share/distribute state if configured to do so. The server types below primarily differ in the type of listener endpoint used to handle incoming connections.</p> </div> <div class="paragraph"> <p>Here&#8217;s a brief summary of the available server endpoints.</p> </div> <div class="ulist"> <ul> <li> <p><strong>Hot Rod Server Module</strong> - This module is an implementation of the <a href="#_hot_rod_protocol">Hot Rod binary protocol</a> backed by Infinispan which allows clients to do dynamic load balancing and failover and smart routing.</p> <div class="ulist"> <ul> <li> <p>A <a href="http://www.infinispan.org/hotrod-clients">variety of clients</a> exist for this protocol.</p> </li> <li> <p>If you&#8217;re clients are running Java, this should be your defacto server module choice because it allows for dynamic load balancing and failover. This means that Hot Rod clients can dynamically detect changes in the topology of Hot Rod servers as long as these are clustered, so when new nodes join or leave, clients update their Hot Rod server topology view. On top of that, when Hot Rod servers are configured with distribution, clients can detect where a particular key resides and so they can route requests smartly.</p> </li> <li> <p>Load balancing and failover is dynamically provided by Hot Rod client implementations using information provided by the server.</p> </li> </ul> </div> </li> <li> <p><strong>REST Server Module</strong> - The REST server, which is distributed as a WAR file, can be deployed in any servlet container to allow Infinispan to be accessed via a RESTful HTTP interface.</p> <div class="ulist"> <ul> <li> <p>To connect to it, you can use any HTTP client out there and there&#8217;re tons of different client implementations available out there for pretty much any language or system.</p> </li> <li> <p>This module is particularly recommended for those environments where HTTP port is the only access method allowed between clients and servers.</p> </li> <li> <p>Clients wanting to load balance or failover between different Infinispan REST servers can do so using any standard HTTP load balancer such as <a href="http://www.jboss.org/mod_cluster">mod_cluster</a> . It&#8217;s worth noting though these load balancers maintain a static view of the servers in the backend and if a new one was to be added, it would require manual update of the load balancer.</p> </li> </ul> </div> </li> <li> <p><strong>Memcached Server Module</strong> - This module is an implementation of the <a href="http://github.com/memcached/memcached/blob/master/doc/protocol.txt">Memcached text protocol</a> backed by Infinispan.</p> <div class="ulist"> <ul> <li> <p>To connect to it, you can use any of the <a href="http://code.google.com/p/memcached/wiki/Clients">existing Memcached clients</a> which are pretty diverse.</p> </li> <li> <p>As opposed to Memcached servers, Infinispan based Memcached servers can actually be clustered and hence they can replicate or distribute data using consistent hash algorithms around the cluster. So, this module is particularly of interest to those users that want to provide failover capabilities to the data stored in Memcached servers.</p> </li> <li> <p>In terms of load balancing and failover, there&#8217;re a few clients that can load balance or failover given a static list of server addresses (perl&#8217;s Cache::Memcached for example) but any server addition or removal would require manual intervention.</p> </li> </ul> </div> </li> <li> <p><strong>Websocket Server Module</strong> - This module enables Infinispan to be accessed over a <a href="http://en.wikipedia.org/wiki/WebSockets">Websocket</a> interface via a Javascript API.</p> <div class="ulist"> <ul> <li> <p>This module is very specifically designed for Javascript clients and so that is the only client implementation available.</p> </li> <li> <p>This module is particularly suited for developers wanting to enable access to Infinispan instances from their Javascript codebase.</p> </li> <li> <p>Since websockets work on the same HTTP port, any HTTP load balancer would do to load balance and failover.</p> </li> <li> <p>This module is <strong class="red">EXPERIMENTAL</strong>! Beware!</p> </li> </ul> </div> </li> </ul> </div> </div> <div class="sect2"> <h3 id="_using_hot_rod_server"><a class="anchor" href="#_using_hot_rod_server"></a>1.4. Using Hot Rod Server</h3> <div class="paragraph"> <p>The Infinispan distribution contains a server module that implements Infinispan&#8217;s custom binary protocol called Hot Rod. The protocol was designed to enable faster client/server interactions compared to other existing text based protocols and to allow clients to make more intelligent decisions with regards to load balancing, failover and even data location operations.</p> </div> <div class="sect3"> <h4 id="_starting_an_infinispan_hot_rod_server"><a class="anchor" href="#_starting_an_infinispan_hot_rod_server"></a>1.4.1. Starting an Infinispan Hot Rod server</h4> <div class="paragraph"> <p>The simplest way to start up  Hot Rod  server is to simply unzip the all distribution and either run the startServer.bat or startServer.sh script passing <em>hotrod</em> as the protocol to run. For example:</p> </div> <div class="literalblock"> <div class="content"> <pre>$ ./bin/startServer.sh -r hotrod</pre> </div> </div> <div class="paragraph"> <p>When the script is called without any further parameters, the started Hot Rod server bounds to port 11222 (Infinispan 4.2.0.BETA1 or earlier listened on port 11311 by default) on localhost (127.0.0.1). If no further parameters is given at startup, this means that any cache instance queried will be based on the default cache instance which will be a local (unclustered) Infinispan cache instance configured with default values. Please visit the <a href="http://docs.jboss.org/infinispan/5.0/apidocs/config.html">Configuration Reference Guide</a> for more information on these values. If you want to use non-default values, please check the next section on command line options.</p> </div> <div class="sect4"> <h5 id="_command_line_options"><a class="anchor" href="#_command_line_options"></a>Command Line Options</h5> <div class="paragraph"> <p>You can optionally pass a set of parameters to the Hot Rod server that allow you to configure different parts of the server.</p> </div> <div class="paragraph"> <p>So, following the discussion earlier on configuring a Hot Rod server with a custom Infinispan configuration, you&#8217;d use -c parameter to pass the corresponding file. Hot Rod clients could then send requests to specific cache instances whose name match one of the names in the custom configuration file.</p> </div> </div> <div class="sect4"> <h5 id="_predefining_hot_rod_caches"><a class="anchor" href="#_predefining_hot_rod_caches"></a>Predefining Hot Rod Caches</h5> <div class="paragraph"> <p>In order to provide a more consistent experience when interacting with Hot Rod servers and avoid issues related to lazily started cache instances, on startup, Hot Rod server starts all defined caches in the Infinispan configuration file including the default cache. If no configuration file was provided, only the default cache will be started. Any request to an undefined cache will be rejected by the server.</p> </div> <div class="paragraph"> <p>So, as user, this means that any caches you interact with must be defined in the Infinispan configuration file by providing a namedCache XML element entry for each of them. Besides, as explained the <em>Cache Name</em> section of the Hot Rod protocol, you can also interact with the default cache by passing an empty cache name.</p> </div> </div> </div> <div class="sect3"> <h4 id="_hot_rod_protocol"><a class="anchor" href="#_hot_rod_protocol"></a>1.4.2. Hot Rod Protocol</h4> <div class="paragraph"> <p>The following articles provides detailed information about each version of the custom TCP client/server Hot Rod protocol.</p> </div> <div class="ulist"> <ul> <li> <p><a href="#_hot_rod_protocol_1_0">Hot Rod Protocol 1.0</a></p> </li> <li> <p><a href="#_hot_rod_protocol_1_1">Hot Rod Protocol 1.1</a></p> </li> <li> <p><a href="#_hot_rod_protocol_1_2">Hot Rod Protocol 1.2</a></p> </li> <li> <p><a href="#_hot_rod_protocol_1_3">Hot Rod Protocol 1.3</a></p> </li> </ul> </div> <div class="sect4"> <h5 id="_hot_rod_protocol_1_0"><a class="anchor" href="#_hot_rod_protocol_1_0"></a>Hot Rod Protocol 1.0</h5> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="icon-tip" title="Tip"></i> </td> <td class="content"> <div class="title">Infinispan versions</div> This version of the protocol is implemented since Infinispan 4.1.0.Final </td> </tr> </table> </div> <div class="admonitionblock important"> <table> <tr> <td class="icon"> <i class="icon-important" title="Important"></i> </td> <td class="content"> All key and values are sent and stored as byte arrays. Hot Rod makes no assumptions about their types. </td> </tr> </table> </div> <div class="paragraph"> <p>Some clarifications about the other types:</p> </div> <div class="ulist"> <ul> <li> <p>vInt : Variable-length integers are defined defined as compressed, positive integers where the high-order bit of each byte indicates whether more bytes need to be read. The low-order seven bits are appended as increasingly more significant bits in the resulting integer value making it efficient to decode. Hence, values from zero to 127 are stored in a single byte, values from 128 to 16,383 are stored in two bytes, and so on:</p> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:25%;"> <col style="width:25%;"> <col style="width:25%;"> <col style="width:25%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top"><code>Value</code></th> <th class="tableblock halign-left valign-top"><code>First byte</code></th> <th class="tableblock halign-left valign-top"><code>Second byte</code></th> <th class="tableblock halign-left valign-top"><code>Third byte</code></th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>00000000</code></p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>00000001</code></p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>00000010</code></p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>...</code></p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>127</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>01111111</code></p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>128</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000000</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>00000001</code></p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>129</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000001</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>00000001</code></p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>130</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000010</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>00000001</code></p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>...</code></p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>16,383</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>11111111</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>01111111</code></p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>16,384</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000000</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000000</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>00000001</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>16,385</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000001</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>10000000</code></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>00000001</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>...</code></p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> </li> <li> <p>vLong : Refers to unsigned variable length long values similar to vInt but applied to longer values. They&#8217;re between 1 and 9 bytes long.</p> </li> <li> <p>String : Strings are always represented using UTF-8 encoding.</p> </li> </ul> </div> <div class="sect5"> <h6 id="_request_header"><a class="anchor" href="#_request_header"></a>Request Header</h6> <div class="paragraph"> <p>The header for a request is composed of:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <caption class="title">Table 1. Request header</caption> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Magic</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xA0</code> = request</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Message ID</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vLong</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">ID of the message that will be copied back in the response. This allows for hot rod clients to implement the protocol in an asynchronous way.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Version</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Infinispan hot rod server version. In this particular case, this is <code>10</code></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Opcode</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request operation code:<br> <code>0x01</code> = put request<br> <code>0x03</code> = get<br> <code>0x05</code> = putIfAbsent<br> <code>0x07</code> = replace<br> <code>0x09</code> = replaceIfUnmodified<br> <code>0x0B</code> = remove<br> <code>0x0D</code> = removeIfUnmodified<br> <code>0x0F</code> = containsKey<br> <code>0x11</code> = getWithVersion<br> <code>0x13</code> = clear<br> <code>0x15</code> = stats<br> <code>0x17</code> = ping<br> <code>0x19</code> = bulkGet<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Cache Name Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of cache name. If the passed length is <code>0</code> (followed by no cache name), the operation will interact with the default cache.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Cache Name</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Name of cache on which to operate. This name must match the name of predefined cache in the Infinispan configuration file.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Flags</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">A variable length number representing flags passed to the system. Each flags is represented by a bit. Note that since this field is sent as variable length, the most significant bit in a byte is used to determine whether more bytes need to be read, hence this bit does not represent any flag. Using this model allows for flags to be combined in a short space. Here are the current values for each flag:<br> <code>0x0001</code> = force return previous value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Client Intelligence</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">This byte hints the server on the client capabilities:<br> <code>0x01</code> = basic client, interested in neither cluster nor hash information<br> <code>0x02</code> = topology-aware client, interested in cluster information<br> <code>0x03</code> = hash-distribution-aware client, that is interested in both cluster and hash information<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology Id</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">This field represents the last known view in the client. Basic clients will only send 0 in this field. When topology-aware or hash-distribution-aware clients will send 0 until they have received a reply from the server with the current view id. Afterwards, they should send that view id until they receive a new view id in a response.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Transaction Type</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">This is a 1 byte field, containing one of the following well-known supported transaction types (For this version of the protocol, the only supported transaction type is 0):<br> <code>0</code> = Non-transactional call, or client does not support transactions. The subsequent TX_ID field will be omitted.<br> <code>1</code> = X/Open XA transaction ID (XID). This is a well-known, fixed-size format.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Transaction Id</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">The byte array uniquely identifying the transaction associated to this call. It’s length is determined by the transaction type. If transaction type is 0, no transaction id will be present.</p></td> </tr> </tbody> </table> </div> <div class="sect5"> <h6 id="_response_header"><a class="anchor" href="#_response_header"></a>Response Header</h6> <div class="paragraph"> <p>The header for a response is composed of:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <caption class="title">Table 2. Response header</caption> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Magic</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xA1</code> = response</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Message ID</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vLong</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">ID of the message, matching the request for which the response is sent.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Opcode</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response operation code:<br> <code>0x02</code> = put<br> <code>0x04</code> = get<br> <code>0x06</code> = putIfAbsent<br> <code>0x08</code> = replace<br> <code>0x0A</code> = replaceIfUnmodified<br> <code>0x0C</code> = remove<br> <code>0x0E</code> = removeIfUnmodified<br> <code>0x10</code> = containsKey<br> <code>0x12</code> = getWithVersion<br> <code>0x14</code> = clear<br> <code>0x16</code> = stats<br> <code>0x18</code> = ping<br> <code>0x1A</code> = bulkGet<br> <code>0x50</code> = error<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Status of the response, possible values:<br> <code>0x00</code> = No error<br> <code>0x01</code> = Not put/removed/replaced<br> <code>0x02</code> = Key does not exist<br> <code>0x81</code> = Invalid magic or message id<br> <code>0x82</code> = Unknown command<br> <code>0x83</code> = Unknown version<br> <code>0x84</code> = Request parsing error<br> <code>0x85</code> = Server Error<br> <code>0x86</code> = Command timed out<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology Change Marker</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">This is a marker byte that indicates whether the response is prepended with topology change information. When no topology change follows, the content of this byte is <code>0</code>. If a topology change follows, its contents are <code>1</code>.</p></td> </tr> </tbody> </table> <div class="admonitionblock caution"> <table> <tr> <td class="icon"> <i class="icon-caution" title="Caution"></i> </td> <td class="content"> Exceptional error status responses, those that start with 0x8 &#8230;, are followed by the length of the error message (as a vInt ) and error message itself as String. </td> </tr> </table> </div> </div> <div class="sect5"> <h6 id="_topology_change_headers"><a class="anchor" href="#_topology_change_headers"></a>Topology Change Headers</h6> <div class="paragraph"> <p>The following section discusses how the response headers look for topology-aware or hash-distribution-aware clients when there&#8217;s been a cluster or view formation change. Note that it&#8217;s the server that makes the decision on whether it sends back the new topology based on the current topology id and the one the client sent. If they&#8217;re different, it will send back the new topology.</p> </div> </div> <div class="sect5"> <h6 id="_topology_aware_client_topology_change_header"><a class="anchor" href="#_topology_aware_client_topology_change_header"></a>Topology-Aware Client Topology Change Header</h6> <div class="paragraph"> <p>This is what topology-aware clients receive as response header when a topology change is sent back:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header with topology change marker</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">See previous section.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology Id</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology ID</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Num servers in topology</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of Infinispan Hot Rod servers running within the cluster. This could be a subset of the entire cluster if only a fraction of those nodes are running Hot Rod servers.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Host/IP length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of hostname or IP address of individual cluster member that Hot Rod client can use to access it. Using variable length here allows for covering for hostnames, IPv4 and IPv6 addresses.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Host/IP address</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String containing hostname or IP address of individual cluster member that Hot Rod client can use to access it.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Port</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">2 bytes (Unsigned Short)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Port that Hot Rod clients can use to communicate with this cluster member.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Host/IP length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Host/IP address</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Port</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">2 bytes (Unsigned Short)</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;etc</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> </div> <div class="sect5"> <h6 id="_distribution_aware_client_topology_change_header"><a class="anchor" href="#_distribution_aware_client_topology_change_header"></a>Distribution-Aware Client Topology Change Header</h6> <div class="paragraph"> <p>This is what hash-distribution-aware clients receive as response header when a topology change is sent back:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header with topology change marker</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">See previous section.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology Id</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology ID</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Num Key Owners</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">2 bytes (Unsigned Short)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Globally configured number of copies for each Infinispan distributed key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Hash Function Version</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Hash function version, pointing to a specific hash function in use. See <a href="#_hot_rod_hash_functions">Hot Rod hash functions</a> for details.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Hash space size</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Modulus used by Infinispan for for all module arithmetic related to hash code generation. Clients will likely require this information in order to apply the correct hash calculation to the keys.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Num servers in topology</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of Infinispan Hot Rod servers running within the cluster. This could be a subset of the entire cluster if only a fraction of those nodes are running Hot Rod servers.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Host/IP length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of hostname or IP address of individual cluster member that Hot Rod client can use to access it. Using variable length here allows for covering for hostnames, IPv4 and IPv6 addresses.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Host/IP address</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String containing hostname or IP address of individual cluster member that Hot Rod client can use to access it.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Port</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">2 bytes (Unsigned Short)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Port that Hot Rod clients can use to communicat with this cluster member.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Hashcode</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">4 bytes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">32 bit integer representing the hashcode of a cluster member that a Hot Rod client can use indentify in which cluster member a key is located having applied the CSA to it.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Host/IP length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Host/IP address</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Port</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">2 bytes (Unsigned Short)</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Hashcode</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">4 bytes</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;etc</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> <div class="paragraph"> <p>It&#8217;s important to note that since hash headers rely on the consistent hash algorithm used by the server and this is a factor of the cache interacted with, hash-distribution-aware headers can only be returned to operations that target a particular cache. Currently ping command does not target any cache (this is to change as per <a href="https://jira.jboss.org/jira/browse/ISPN-424">ISPN-424</a>) , hence calls to ping command with hash-topology-aware client settings will return a hash-distribution-aware header with "Num Key Owners", "Hash Function Version", "Hash space size" and each individual host&#8217;s hash code all set to 0. This type of header will also be returned as response to operations with hash-topology-aware client settings that are targeting caches that are not configured with distribution.</p> </div> </div> <div class="sect5"> <h6 id="_operations"><a class="anchor" href="#_operations"></a>Operations</h6> <div class="paragraph"> <div class="title">Get/Remove/ContainsKey/GetWithVersion</div> <p>Common request format:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of key. Note that the size of a vint can be up to 5 bytes which in theory can produce bigger numbers than Integer.MAX_VALUE. However, Java cannot create a single array that’s bigger than Integer.MAX_VALUE, hence the protocol is limiting vint array lengths to Integer.MAX_VALUE.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Byte array containing the key whose value is being requested.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Get response:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00</code> = success, if key retrieved<br> <code>0x02</code> = if key does not exist<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If success, length of value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If success, the requested value</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Remove response:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00</code> = success, if key removed<br> <code>0x02</code> = if key does not exist<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request and the key was removed, the length of the previous value will be returned. If the key does not exist, value length would be 0. If no flag was sent, no value length would be present.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request and the key was removed, previous value.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>ContainsKey response:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00</code> = success, if key exists<br> <code>0x02</code> = if key does not exist<br></p></td> </tr> </tbody> </table> <div class="paragraph"> <p>GetWithVersion response:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00</code> = success, if key retrieved<br> <code>0x02</code> = if key does not exist<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Entry Version</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">8 bytes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Unique value of an existing entry&#8217;s modification. The protocol does not mandate that entry_version values are sequential. They just need to be unique per update at the key level.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If success, length of value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If success, the requested value</p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">BulkGet</div> <p>Request format:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Entry count</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of Infinispan entries to be returned by the server (entry == key + associated value). Needed to support CacheLoader.load(int). If 0 then all entries are returned (needed for CacheLoader.loadAll()).</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00</code> = success, data follows<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">More</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">One byte representing whether more entries need to be read from the stream. So, when it&#8217;s set to 1, it means that an entry follows, whereas when it&#8217;s set to 0, it&#8217;s the end of stream and no more entries are left to read. For more information on BulkGet look <a href="http://community.jboss.org/docs/DOC-15592">here</a></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 1 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Retrieved key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 1 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Retrieved value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">More</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 2 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 2 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230; etc</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">Put/PutIfAbsent/Replace</div> <p>Common request format:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of key. Note that the size of a vint can be up to 5 bytes which in theory can produce bigger numbers than Integer.MAX_VALUE. However, Java cannot create a single array that’s bigger than Integer.MAX_VALUE, hence the protocol is limiting vint array lengths to Integer.MAX_VALUE.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Byte array containing the key whose value is being requested.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Lifespan</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds that a entry during which the entry is allowed to life. If number of seconds is bigger than 30 days, this number of seconds is treated as UNIX time and so, represents the number of seconds since 1/1/1970. If set to 0, lifespan is unlimited.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Max Idle</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds that a entry can be idle before it&#8217;s evicted from the cache. If 0, no max idle time.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte-array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Value to be stored</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Put response:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00</code> = success, if stored<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request and the key was put, the length of the previous value will be returned. If the key does not exist, value length would be 0. If no flag was sent, no value length would be present.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request and the key was put, previous value.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Replace response:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00</code> = success, if stored<br> <code>0x01</code> = if store did not happen because key does not exist<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request and the key was replaced, the length of the previous value will be returned. If the key does not exist, value length would be 0. If no flag was sent, no value length would be present.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request and the key was replaced, previous value.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>PutIfAbsent response:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00</code> = success, if stored<br> <code>0x01</code> = if store did not happen because key was present<br></p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">ReplaceIfUnmodified</div> <p>Request format:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of key. Note that the size of a vint can be up to 5 bytes which in theory can produce bigger numbers than Integer.MAX_VALUE. However, Java cannot create a single array that’s bigger than Integer.MAX_VALUE, hence the protocol is limiting vint array lengths to Integer.MAX_VALUE.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Byte array containing the key whose value is being requested.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Lifespan</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds that a entry during which the entry is allowed to life. If number of seconds is bigger than 30 days, this number of seconds is treated as UNIX time and so, represents the number of seconds since 1/1/1970. If set to 0, lifespan is unlimited.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Max Idle</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds that a entry can be idle before it&#8217;s evicted from the cache. If 0, no max idle time.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Entry Version</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">8 bytes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Use the value returned by GetWithVersion operation.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte-array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Value to be stored</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00</code> = success, if replaced<br> <code>0x01</code> = if replace did not happen because key had been modified<br> <code>0x02</code> = if not replaced because if key does not exist</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request and the key was replaced, the length of the previous value will be returned. If the key does not exist, value length would be 0. If no flag was sent, no value length would be present.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request and the key was replaced, previous value.</p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">RemoveIfUnmodified</div> <p>Request format:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of key. Note that the size of a vint can be up to 5 bytes which in theory can produce bigger numbers than Integer.MAX_VALUE. However, Java cannot create a single array that’s bigger than Integer.MAX_VALUE, hence the protocol is limiting vint array lengths to Integer.MAX_VALUE.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Byte array containing the key whose value is being requested.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Entry Version</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">8 bytes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Use the value returned by GetWithVersion operation.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00</code> = success, if removed<br> <code>0x01</code> = if remove did not happen because key had been modified<br> <code>0x02</code> = if not removed because key does not exist<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request and the key was removed, the length of the previous value will be returned. If the key does not exist, value length would be 0. If no flag was sent, no value length would be present.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Previous value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If force return previous value flag was sent in the request and the key was removed, previous value.</p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">Clear</div> <p>Request:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00</code> = success, if cleared<br></p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">Stats</div> <p>Returns a summary of all available statistics. For each statistic returned, a name and a value is returned both in String UTF-8 format. The supported stats are the following:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:50%;"> <col style="width:50%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Name</th> <th class="tableblock halign-left valign-top">Explanation</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">timeSinceStart</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds since Hot Rod started.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">currentNumberOfEntries</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of entries currently in the Hot Rod server.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">totalNumberOfEntries</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of entries stored in Hot Rod server.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">stores</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of put operations.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">retrievals</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of get operations.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">hits</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of get hits.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">misses</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of get misses.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">removeHits</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of removal hits.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">removeMisses</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of removal misses.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Request:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00</code> = success, if stats retrieved<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of stats</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of individual stats returned.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Name 1 length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of named statistic.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Name 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String containing statistic name.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 1 length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of value field.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String containing statistic value.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Name 2 length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Name 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 2 length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">String</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;etc</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">Ping</div> <p>Application level request to see if the server is available.</p> </div> <div class="paragraph"> <p>Request:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00</code> = success, if no errors<br></p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">Error Handling</div> <p>Error response</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8x</code> = error response code<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Error Message Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of error message</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Error Message</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Error message. In the case of 0x84 , this error field contains the latest version supported by the hot rod server. Length is defined by total body length.</p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">Multi-Get Operations</div> <p>A multi-get operation is a form of get operation that instead of requesting a single key, requests a set of keys. The Hot Rod protocol does not include such operation but remote Hot Rod clients could easily implement this type of operations by either parallelizing/pipelining individual get requests. Another possibility would be for remote clients to use async or non-blocking get requests. For example, if a client wants N keys, it could send send N async get requests and then wait for all the replies. Finally, multi-get is not to be confused with bulk-get operations. In bulk-gets, either all or a number of keys are retrieved, but the client does not know which keys to retrieve, whereas in multi-get, the client defines which keys to retrieve.</p> </div> </div> <div class="sect5"> <h6 id="_example_put_request"><a class="anchor" href="#_example_put_request"></a>Example - Put request</h6> <div class="ulist"> <ul> <li> <p>Coded request</p> </li> </ul> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:11%;"> <col style="width:11%;"> <col style="width:11%;"> <col style="width:11%;"> <col style="width:11%;"> <col style="width:11%;"> <col style="width:11%;"> <col style="width:11%;"> <col style="width:11%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Byte</th> <th class="tableblock halign-left valign-top">0</th> <th class="tableblock halign-left valign-top">1</th> <th class="tableblock halign-left valign-top">2</th> <th class="tableblock halign-left valign-top">3</th> <th class="tableblock halign-left valign-top">4</th> <th class="tableblock halign-left valign-top">5</th> <th class="tableblock halign-left valign-top">6</th> <th class="tableblock halign-left valign-top">7</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0xA0</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x09</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x41</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x07</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x4D (<em>M</em>)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x79 (<em>y</em>)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x43 (<em>C</em>)</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x61 (<em>a</em>)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x63 (<em>c</em>)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x68 (<em>h</em>)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x65 (<em>e</em>)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x03</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x05</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x48 (<em>H</em>)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x65 (<em>e</em>)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x6C (<em>l</em>)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x6C (<em>l</em>)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x6F (<em>o</em>)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x05</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x57 (<em>W</em>)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x6F (<em>o</em>)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x72 (<em>r</em>)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x6C (<em>l</em>)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x64 (<em>d</em>)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td> </tr> </tbody> </table> <div class="ulist"> <ul> <li> <p>Field explanation</p> </li> </ul> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:25%;"> <col style="width:25%;"> <col style="width:25%;"> <col style="width:25%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-left valign-top">Value</th> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Magic (0)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0xA0</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Message Id (1)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x09</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Version (2)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x41</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Opcode (3)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Cache name length (4)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x07</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Cache name(5-11)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><em>MyCache</em></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Flag (12)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Client Intelligence (13)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x03</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology Id (14)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Transaction Type (15)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Transaction Id (16)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Key field length (17)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x05</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key (18 - 22)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><em>Hello</em></p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Lifespan (23)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Max idle (24)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Value field length (25)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x05</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value (26-30)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><em>World</em></p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> <div class="ulist"> <ul> <li> <p>Coded response</p> </li> </ul> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:11%;"> <col style="width:11%;"> <col style="width:11%;"> <col style="width:11%;"> <col style="width:11%;"> <col style="width:11%;"> <col style="width:11%;"> <col style="width:11%;"> <col style="width:11%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Byte</th> <th class="tableblock halign-left valign-top">0</th> <th class="tableblock halign-left valign-top">1</th> <th class="tableblock halign-left valign-top">2</th> <th class="tableblock halign-left valign-top">3</th> <th class="tableblock halign-left valign-top">4</th> <th class="tableblock halign-left valign-top">5</th> <th class="tableblock halign-left valign-top">6</th> <th class="tableblock halign-left valign-top">7</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0xA1</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x09</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock"> </p></td> </tr> </tbody> </table> <div class="ulist"> <ul> <li> <p>Field Explanation</p> </li> </ul> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:25%;"> <col style="width:25%;"> <col style="width:25%;"> <col style="width:25%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-left valign-top">Value</th> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Magic (0)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0xA1</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Message Id (1)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x09</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Opcode (2)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Status (3)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology change marker (4)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">0x00</p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> </div> </div> <div class="sect4"> <h5 id="_hot_rod_protocol_1_1"><a class="anchor" href="#_hot_rod_protocol_1_1"></a>Hot Rod Protocol 1.1</h5> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="icon-tip" title="Tip"></i> </td> <td class="content"> <div class="title">Infinispan versions</div> This version of the protocol is implemented since Infinispan 5.1.0.FINAL </td> </tr> </table> </div> <div class="sect5"> <h6 id="_request_header_2"><a class="anchor" href="#_request_header_2"></a>Request Header</h6> <div class="paragraph"> <p>The <code>version</code> field in the header is updated to <code>11</code>.</p> </div> </div> </div> <div class="sect4"> <h5 id="_distribution_aware_client_topology_change_header_2"><a class="anchor" href="#_distribution_aware_client_topology_change_header_2"></a>Distribution-Aware Client Topology Change Header</h5> <div class="admonitionblock important"> <table> <tr> <td class="icon"> <i class="icon-important" title="Important"></i> </td> <td class="content"> <div class="title">Updated for 1.1</div> This section has been modified to be more efficient when talking to distributed caches with virtual nodes enabled. </td> </tr> </table> </div> <div class="paragraph"> <p>This is what hash-distribution-aware clients receive as response header when a topology change is sent back:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header with topology change marker</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">See previous section.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology Id</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Topology ID</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Num Key Owners</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">2 bytes (Unsigned Short)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Globally configured number of copies for each Infinispan distributed key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Hash Function Version</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Hash function version, pointing to a specific hash function in use. See <a href="#_hot_rod_hash_functions">Hot Rod hash functions</a> for details.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Hash space size</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Modulus used by Infinispan for for all module arithmetic related to hash code generation. Clients will likely require this information in order to apply the correct hash calculation to the keys.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Num servers in topology</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Number of Infinispan Hot Rod servers running within the cluster. This could be a subset of the entire cluster if only a fraction of those nodes are running Hot Rod servers.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Num Virtual Nodes Owners</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Field added in version <code>1.1</code> of the protocol that represents the number of configured virtual nodes. If no virtual nodes are configured or the cache is not configured with distribution, this field will contain 0.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Host/IP length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of hostname or IP address of individual cluster member that Hot Rod client can use to access it. Using variable length here allows for covering for hostnames, IPv4 and IPv6 addresses.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Host/IP address</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String containing hostname or IP address of individual cluster member that Hot Rod client can use to access it.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Port</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">2 bytes (Unsigned Short)</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Port that Hot Rod clients can use to communicat with this cluster member.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m1: Hashcode</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">4 bytes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">32 bit integer representing the hashcode of a cluster member that a Hot Rod client can use indentify in which cluster member a key is located having applied the CSA to it.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Host/IP length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Host/IP address</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Port</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">2 bytes (Unsigned Short)</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">m2: Hashcode</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">4 bytes</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;etc</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> </div> <div class="sect4"> <h5 id="_server_node_hash_code_calculation"><a class="anchor" href="#_server_node_hash_code_calculation"></a>Server node hash code calculation</h5> <div class="paragraph"> <p>Adding support for virtual nodes has made version <code>1.0</code> of the Hot Rod protocol impractical due to bandwidth it would have taken to return hash codes for all virtual nodes in the clusters (this number could easily be in the millions). So, as of version <code>1.1</code> of the Hot Rod protocol, clients are given the base hash id or hash code of each server, and then they have to calculate the real hash position of each server both with and without virtual nodes configured. Here are the rules clients should follow when trying to calculate a node&#8217;s hash code:</p> </div> <div class="paragraph"> <p>1. With <em>virtual nodes disabled</em> : Once clients have received the base hash code of the server, they need to normalize it in order to find the exact position of the hash wheel. The process of normalization involves passing the base hash code to the hash function, and then do a small calculation to avoid negative values. The resulting number is the node&#8217;s position in the hash wheel:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">int</span> getNormalizedHash(<span class="type">int</span> nodeBaseHashCode, Hash hashFct) {
   <span class="keyword">return</span> hashFct.hash(nodeBaseHashCode) &amp; <span class="predefined-type">Integer</span>.MAX_VALUE; <span class="comment">// make sure no negative numbers are involved.</span>
}</code></pre> </div> </div> <div class="paragraph"> <p>2. With <em>virtual nodes enabled</em> : In this case, each node represents N different virtual nodes, and to calculate each virtual node&#8217;s hash code, we need to take the the range of numbers between 0 and N-1 and apply the following logic:</p> </div> <div class="ulist"> <ul> <li> <p>For virtual node with 0 as id, use the technique used to retrieve a node&#8217;s hash code, as shown in the previous section.</p> </li> <li> <p>For virtual nodes from 1 to N-1 ids, execute the following logic:</p> </li> </ul> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">int</span> virtualNodeHashCode(<span class="type">int</span> nodeBaseHashCode, <span class="type">int</span> id, Hash hashFct) {
   <span class="type">int</span> virtualNodeBaseHashCode = id;
   virtualNodeBaseHashCode = <span class="integer">31</span> * virtualNodeBaseHashCode + nodeBaseHashCode;
   <span class="keyword">return</span> getNormalizedHash(virtualNodeBaseHashCode, hashFct);
}</code></pre> </div> </div> </div> <div class="sect4"> <h5 id="_hot_rod_protocol_1_2"><a class="anchor" href="#_hot_rod_protocol_1_2"></a>Hot Rod Protocol 1.2</h5> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="icon-tip" title="Tip"></i> </td> <td class="content"> <div class="title">Infinispan versions</div> This version of the protocol is implemented since Infinispan 5.2.0.Final. Since Infinispan 5.3.0, HotRod supports encryption via SSL. However, since this only affects the transport, the version number of the protocol has not been incremented. </td> </tr> </table> </div> <div class="sect5"> <h6 id="_request_header_3"><a class="anchor" href="#_request_header_3"></a>Request Header</h6> <div class="paragraph"> <p>The <code>version</code> field in the header is updated to <code>12</code>.</p> </div> <div class="paragraph"> <p>Two new request operation codes have been added:</p> </div> <div class="ulist"> <ul> <li> <p><code>0x1B</code> = getWithMetadata request</p> </li> <li> <p><code>0x1D</code> = bulkKeysGet request</p> </li> </ul> </div> <div class="paragraph"> <p>Two new flags have been added too:</p> </div> <div class="ulist"> <ul> <li> <p><code>0x0002</code> = use cache-level configured default lifespan</p> </li> <li> <p><code>0x0004</code> = use cache-level configured default max idle</p> </li> </ul> </div> </div> <div class="sect5"> <h6 id="_response_header_2"><a class="anchor" href="#_response_header_2"></a>Response Header</h6> <div class="paragraph"> <p>Two new response operation codes have been added:</p> </div> <div class="ulist"> <ul> <li> <p><code>0x1C</code> = getWithMetadata response</p> </li> <li> <p><code>0x1E</code> = bulkKeysGet response</p> </li> </ul> </div> </div> <div class="sect5"> <h6 id="_operations_2"><a class="anchor" href="#_operations_2"></a>Operations</h6> <div class="paragraph"> <div class="title">GetWithMetadata</div> <p>Request format:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of key. Note that the size of a vint can be up to 5 bytes which in theory can produce bigger numbers than Integer.MAX_VALUE. However, Java cannot create a single array that’s bigger than Integer.MAX_VALUE, hence the protocol is limiting vint array lengths to Integer.MAX_VALUE.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Byte array containing the key whose value is being requested.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response format:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00</code> = success, if key retrieved<br> <code>0x02</code> = if key does not exist<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Flag</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">A flag indicating whether the response contains expiration information. The value of the flag is obtained as a bitwise OR operation between <code>INFINITE_LIFESPAN (0x01)</code> and <code>INFINITE_MAXIDLE (0x02)</code>.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Created</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">Long</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">(optional) a Long representing the timestamp when the entry was created on the server. This value is returned only if the flag&#8217;s <code>INFINITE_LIFESPAN</code> bit is not set.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Lifespan</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">(optional) a vInt representing the lifespan of the entry in seconds. This value is returned only if the flag&#8217;s <code>INFINITE_LIFESPAN</code> bit is not set.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">LastUsed</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">Long</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">(optional) a Long representing the timestamp when the entry was last accessed on the server. This value is returned only if the flag&#8217;s <code>INFINITE_MAXIDLE</code> bit is not set.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">MaxIdle</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">(optional) a vInt representing the maxIdle of the entry in seconds. This value is returned only if the flag&#8217;s <code>INFINITE_MAXIDLE</code> bit is not set.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Entry Version</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">8 bytes</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Unique value of an existing entry&#8217;s modification. The protocol does not mandate that entry_version values are sequential. They just need to be unique per update at the key level.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If success, length of value</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Value</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">If success, the requested value</p></td> </tr> </tbody> </table> <div class="paragraph"> <div class="title">BulkKeysGet</div> <p>Request format:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Request header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Scope</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> = Default Scope - This scope is used by RemoteCache.keySet() method. If the remote cache is a distributed cache, the server launch a map/reduce operation to retrieve all keys from all of the nodes. (Remember, a topology-aware Hot Rod Client could be load balancing the request to any one node in the cluster). Otherwise, it&#8217;ll get keys from the cache instance local to the server receiving the request (that is because the keys should be the same across all nodes in a replicated cache).<br> <code>1</code> = Global Scope - This scope behaves the same to Default Scope.<br> <code>2</code> = Local Scope - In case when remote cache is a distributed cache, the server will not launch a map/reduce operation to retrieve keys from all nodes. Instead, it&#8217;ll only get keys local from the cache instance local to the server receiving the request.<br></p></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response format:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Header</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">variable</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Response header</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Response status</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00</code> = success, data follows<br></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">More</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">One byte representing whether more keys need to be read from the stream. So, when it&#8217;s set to 1, it means that an entry follows, whereas when it&#8217;s set to 0, it&#8217;s the end of stream and no more entries are left to read. For more information on BulkGet look <a href="http://community.jboss.org/docs/DOC-15592">here</a></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 1 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Length of key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 1</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Retrieved key</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">More</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">1 byte</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 2 Length</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">vInt</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">Key 2</p></td> <td class="tableblock halign-center valign-top"><p class="tableblock">byte array</p></td> <td class="tableblock halign-left valign-top"></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">&#8230; etc</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> </div> </div> <div class="sect4"> <h5 id="_hot_rod_protocol_1_3"><a class="anchor" href="#_hot_rod_protocol_1_3"></a>Hot Rod Protocol 1.3</h5> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="icon-tip" title="Tip"></i> </td> <td class="content"> <div class="title">Infinispan versions</div> This version of the protocol is implemented since Infinispan 6.0.0.Final. </td> </tr> </table> </div> <div class="sect5"> <h6 id="_request_header_4"><a class="anchor" href="#_request_header_4"></a>Request Header</h6> <div class="paragraph"> <p>The <code>version</code> field in the header is updated to <code>13</code>.</p> </div> <div class="paragraph"> <p>A new request operation code has been added:</p> </div> <div class="ulist"> <ul> <li> <p><code>0x1F</code> = query request</p> </li> </ul> </div> </div> <div class="sect5"> <h6 id="_response_header_3"><a class="anchor" href="#_response_header_3"></a>Response Header</h6> <div class="paragraph"> <p>A new response operation code has been added:</p> </div> <div class="ulist"> <ul> <li> <p><code>0x20</code> = query response</p> </li> </ul> </div> </div> <div class="sect5"> <h6 id="_operations_3"><a class="anchor" href="#_operations_3"></a>Operations</h6> <div class="paragraph"> <div class="title">Query</div> <p>Request format:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">TODO</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> <div class="paragraph"> <p>Response format:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:20%;"> <col style="width:13%;"> <col style="width:66%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Field Name</th> <th class="tableblock halign-center valign-top">Size</th> <th class="tableblock halign-left valign-top">Value</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">TODO</p></td> <td class="tableblock halign-center valign-top"></td> <td class="tableblock halign-left valign-top"></td> </tr> </tbody> </table> </div> </div> </div> <div class="sect3"> <h4 id="_hot_rod_hash_functions"><a class="anchor" href="#_hot_rod_hash_functions"></a>1.4.3. Hot Rod Hash Functions</h4> <div class="paragraph"> <p>Infinispan makes use of a consistent hash function to place nodes on a hash wheel, and to place keys of entries on the same wheel to determine where entries live.</p> </div> <div class="paragraph"> <p>In Infinispan 4.2 and earlier, the hash space was hardcoded to 10240, but since 5.0, the hash space is <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Integer.html#MAX_VALUE">Integer.MAX_INT</a> . Please note that since Hot Rod clients should not assume a particular hash space by default, every time a hash-topology change is detected, this value is sent back to the client via the Hot Rod protocol.</p> </div> <div class="paragraph"> <p>When interacting with Infinispan via the Hot Rod protocol, it is mandated that keys (and values) are byte arrays, to ensure platform neutral behavior. As such, smart-clients which are aware of hash distribution on the backend would need to be able to calculate the hash codes of such byte array keys, again in a platform-neutral manner. To this end, the hash functions used by Infinispan are versioned and documented, so that it can be re-implemented by non-Java clients if needed.</p> </div> <div class="paragraph"> <p>The version of the hash function in use is provided in the Hot Rod protocol, as the hash function version parameter.</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Version 1 (single byte, 0x01) The initial version of the hash function in use is <a href="https://github.com/infinispan/infinispan/blob/master/commons/src/main/java/org/infinispan/commons/hash/MurmurHash2.java">Austin Appleby&#8217;s MurmurHash 2.0 algorithm</a> , a fast, non-cryptographic hash that exhibits excellent distribution, collision resistance and avalanche behavior. The specific version of the algorithm used is the slightly slower, endian-neutral version that allows consistent behavior across both big- and little-endian CPU architectures. Infinispan&#8217;s version also hard-codes the hash seed as -1. For details of the algorithm, please visit <a href="http://sites.google.com/site/murmurhash/">Austin Appleby&#8217;s MurmurHash 2.0 page</a> . Other implementations are detailed on <a href="http://en.wikipedia.org/wiki/MurmurHash">Wikipedia</a> . This hash function was the default one used by the Hot Rod server until Infinispan 4.2.1.</p> </li> <li> <p>Version 2 (single byte, 0x02) Since Infinispan 5.0, a new hash function is used by default which is <a href="https://github.com/infinispan/infinispan/blob/master/commons/src/main/java/org/infinispan/commons/hash/MurmurHash3.java">Austin Appleby&#8217;s MurmurHash 3.0 algorithm</a> . Detailed information about the hash function can be found in this <a href="http://code.google.com/p/smhasher/wiki/MurmurHash3">wiki</a> . Compared to 2.0, it provides better performance and spread.</p> </li> </ol> </div> </div> <div class="sect3"> <h4 id="_java_hot_rod_client"><a class="anchor" href="#_java_hot_rod_client"></a>1.4.4. Java Hot Rod client</h4> <div class="paragraph"> <p>Hot Rod is a binary, language neutral protocol. This article explains how a Java client can interact with a server via the Hot Rod protocol. A reference implementation of the protocol written in Java can be found in all Infinispan distributions, and this article focuses on the capabilities of this java client.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="icon-tip" title="Tip"></i> </td> <td class="content"> Looking for more clients? Visit <a href="http://infinispan.org/hotrod-clients">this website</a> for clients written in a variety of different languages. </td> </tr> </table> </div> <div class="sect4"> <h5 id="_basic_api"><a class="anchor" href="#_basic_api"></a>Basic API</h5> <div class="paragraph"> <p>Below is a sample code snippet on how the client API can be used to store or retrieve information from a Hot Rod server using the Java Hot Rod client. It assumes that a Hot Rod server has been started bound to the default location (localhost:11222)</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="comment">//API entry point, by default it connects to localhost:11222</span>
CacheContainer cacheContainer = <span class="keyword">new</span> RemoteCacheManager();

<span class="comment">//obtain a handle to the remote default cache</span>
Cache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = cacheContainer.getCache();

<span class="comment">//now add something to the cache and make sure it is there</span>
cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ferrari</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">assert</span> cache.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>).equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">ferrari</span><span class="delimiter">&quot;</span></span>);

<span class="comment">//remove the data</span>
cache.remove(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">assert</span> !cache.containsKey(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>) : <span class="string"><span class="delimiter">&quot;</span><span class="content">Value must have been removed!</span><span class="delimiter">&quot;</span></span>;
</code></pre> </div> </div> <div class="paragraph"> <p>The client API maps the local API: <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/client/hotrod/RemoteCacheManager.html">RemoteCacheManager</a> corresponds to <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/manager/DefaultCacheManager.html">DefaultCacheManager</a> (both implement <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/manager/CacheContainer.html">CacheContainer</a> ). This common API facilitates an easy migration from local calls to remote calls through Hot Rod: all one needs to do is switch between <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/manager/DefaultCacheManager.html">DefaultCacheManager</a> and <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/client/hotrod/RemoteCacheManager.html">RemoteCacheManager</a> - which is further simplified by the common <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/manager/CacheContainer.html">CacheContainer</a> interface that both inherit.</p> </div> <div class="paragraph"> <p>Starting from Infinispan 5.2, all keys can be retrieved from the remote cache (whether it&#8217;s local, replicated, or distributed) by using keySet() method. If the remote cache is a distributed cache, the server will start a map/reduce job to retrieve all keys from clustered nodes, and return all keys to the client. Please use this method with care if there are large number of keys.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="predefined-type">Set</span> keys = remoteCache.keySet();
</code></pre> </div> </div> </div> <div class="sect4"> <h5 id="_versioned_api"><a class="anchor" href="#_versioned_api"></a>Versioned API</h5> <div class="paragraph"> <p>A RemoteCacheManager provides instances of <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> interface that represents a handle to the named or default cache on the remote cluster. API wise, it extends the <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/Cache.html">Cache</a> interface to which it also adds some new methods, including the so called versioned API. Please find below some examples of this API <a href="#sid-68355052">but to understand the motivation behind it, make sure you read this section</a>.</p> </div> <div class="paragraph"> <p>The code snippet bellow depicts the usage of these versioned methods:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="comment">// To use the versioned API, remote classes are specifically needed</span>
RemoteCacheManager remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager();
RemoteCache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = remoteCacheManager.getCache();

remoteCache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ferrari</span><span class="delimiter">&quot;</span></span>);
RemoteCache.VersionedValue valueBinary = remoteCache.getVersioned(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// removal only takes place only if the version has not been changed</span>
<span class="comment">// in between. (a new version is associated with 'car' key on each change)</span>
<span class="keyword">assert</span> remoteCache.remove(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>, valueBinary.getVersion());
<span class="keyword">assert</span> !cache.containsKey(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>);
</code></pre> </div> </div> <div class="paragraph"> <p>In a similar way, for replace:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java">remoteCache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ferrari</span><span class="delimiter">&quot;</span></span>);
RemoteCache.VersionedValue valueBinary = remoteCache.getVersioned(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">assert</span> remoteCache.replace(<span class="string"><span class="delimiter">&quot;</span><span class="content">car</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">lamborghini</span><span class="delimiter">&quot;</span></span>, valueBinary.getVersion());
</code></pre> </div> </div> <div class="paragraph"> <p>For more details on versioned operations refer to <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> 's javadoc.</p> </div> </div> <div class="sect4"> <h5 id="_async_api"><a class="anchor" href="#_async_api"></a>Async API</h5> <div class="paragraph"> <p>This cool feature is "borrowed" from the Infinispan core and it is largely discussed <a href="#_asynchronous_api">here</a></p> </div> </div> <div class="sect4"> <h5 id="_unsupported_methods"><a class="anchor" href="#_unsupported_methods"></a>Unsupported methods</h5> <div class="paragraph"> <p>Some of the <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/Cache.html">Cache</a> methods are not being supported by the <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> . Calling one of these methods results in an <a href="http://docs.oracle.com/javase/6/docs/api/java/lang/UnsupportedOperationException.html">UnsupportedOperationException</a> being thrown. Most of these methods do not make sense on the remote cache (e.g. listener management operations), or correspond to methods that are not supported by local cache as well (e.g. containsValue). Another set of unsupported operations are some of the atomic operations inherited from <a href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ConcurrentMap.html">ConcurrentMap</a> :</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="type">boolean</span> remove(<span class="predefined-type">Object</span> key, <span class="predefined-type">Object</span> value);
<span class="type">boolean</span> replace(<span class="predefined-type">Object</span> key, <span class="predefined-type">Object</span> value);
<span class="type">boolean</span> replace(<span class="predefined-type">Object</span> key, <span class="predefined-type">Object</span> oldValue, <span class="predefined-type">Object</span> value);
</code></pre> </div> </div> <div class="paragraph"> <p><a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> offers alternative versioned methods for these atomic operations, that are also network friendly, by not sending the whole value object over the network, but a version identifier. See the section on versioned API.</p> </div> <div class="paragraph"> <p>Each one of these unsupported operation is documented in the <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> javadoc.</p> </div> </div> </div> <div class="sect3"> <h4 id="_return_values"><a class="anchor" href="#_return_values"></a>1.4.5. Return values</h4> <div class="paragraph"> <p>There is a set of methods that alter a cached entry and return the previous existing value, e.g.:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java">V remove(<span class="predefined-type">Object</span> key);
V put(K key, V value);</code></pre> </div> </div> <div class="paragraph"> <p>By default on RemoteCache, these operations return null even if such a previous value exists. This approach reduces the amount of data sent over the network. However, if these return values are needed they can be enforced on a per invocation basis using flags:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java">cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">aKey</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">initialValue</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">assert</span> <span class="predefined-constant">null</span> == cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">aKey</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">aValue</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">assert</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">aValue</span><span class="delimiter">&quot;</span></span>.equals(cache.withFlags(Flag.FORCE_RETURN_VALUE).put(<span class="string"><span class="delimiter">&quot;</span><span class="content">aKey</span><span class="delimiter">&quot;</span></span>,
<span class="error"> </span><span class="error"> </span> <span class="string"><span class="delimiter">&quot;</span><span class="content">newValue</span><span class="delimiter">&quot;</span></span>));
</code></pre> </div> </div> <div class="paragraph"> <p>This default behavior can can be changed through force-return-value=true configuration parameter (see configuration section bellow).</p> </div> </div> <div class="sect3"> <h4 id="_intelligence"><a class="anchor" href="#_intelligence"></a>1.4.6. Intelligence</h4> <div class="paragraph"> <p>HotRod defines three level of intelligence for the clients:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>basic client, interested in neither cluster nor hash information</p> </li> <li> <p>topology-aware client, interested in cluster information</p> </li> <li> <p>hash-distribution-aware client, that is interested in both cluster and hash information</p> </li> </ol> </div> <div class="paragraph"> <p>The java client supports all 3 levels of intelligence. It is transparently notified whenever a new server is added/removed from the HotRod cluster. At startup it only needs to know the address of one HotRod server (ip:host). On connection to the server the cluster topology is piggybacked to the client, and all further requests are being dispatched to all available servers. Any further topology change is also piggybacked.</p> </div> <div class="sect4"> <h5 id="_distribution_aware_client"><a class="anchor" href="#_distribution_aware_client"></a>Distribution-aware client</h5> <div class="paragraph"> <p>Another aspect of the 3rd level of intelligence is the fact that it is hash-distribution-aware. This means that, for each operation, the client chooses the most appropriate remote server to go to: the data owner. As an example, for a put(k,v) operation, the client calculates k&#8217;s hash value and knows exactly on which server the data resides on. Then it picks up a tcp connection to that particular server and dispatches the operation to it. This means less burden on the server side which would otherwise need to lookup the value based on the key&#8217;s hash. It also results in a quicker response from the server, as an additional network roundtrip is skipped. This hash-distribution-aware aspect is only relevant to the distributed HotRod clusters and makes no difference for replicated server deployments.</p> </div> </div> </div> <div class="sect3"> <h4 id="_request_balancing"><a class="anchor" href="#_request_balancing"></a>1.4.7. Request Balancing</h4> <div class="paragraph"> <p>Request balancing is only relevant when the server side is configured with replicated infinispan cluster (on distributed clusters the hash-distribution-aware client logic is used, as discussed in the previos paragraph). Because the client is topology-aware, it knows the list of available servers at all the time. Request balancing has to do with how the client dispatches requests to the available servers.</p> </div> <div class="paragraph"> <p>The default strategy is round-robin: requests are being dispatched to all existing servers in a circular manner. E.g. given a cluster of servers {s1, s2, s3} here is how request will be dispatched:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java">CacheContainer cacheContainer = <span class="keyword">new</span> RemoteCacheManager();
Cache&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; cache = cacheContainer.getCache();

cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">aValue</span><span class="delimiter">&quot;</span></span>); <span class="comment">//this goes to s1</span>
cache.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">key2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">aValue</span><span class="delimiter">&quot;</span></span>); <span class="comment">//this goes to s2</span>
<span class="predefined-type">String</span> value = cache.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">key1</span><span class="delimiter">&quot;</span></span>); <span class="comment">//this goes to s3</span>

cache.remove(<span class="string"><span class="delimiter">&quot;</span><span class="content">key2</span><span class="delimiter">&quot;</span></span>); <span class="comment">//this is dispatched to s1 again, and so on...</span>
</code></pre> </div> </div> <div class="paragraph"> <p>Custom types of balancing policies can defined by implementing the <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/client/hotrod/impl/transport/tcp/RequestBalancingStrategy.html">RequestBalancingStrategy</a> and by specifying it through the infinispan.client.hotrod.request-balancing-strategy configuration property. Please refer to configuration section for more details on this.</p> </div> <div class="sect4"> <h5 id="_persistent_connections"><a class="anchor" href="#_persistent_connections"></a>Persistent connections</h5> <div class="paragraph"> <p>In order to avoid creating a TCP connection on each request (which is a costly operation), the client keeps a pool of persistent connections to all the available servers and it reuses these connections whenever it is possible. The validity of the connections is checked using an async thread that iterates over the connections in the pool and sends a HotRod ping command to the server. By using this connection validation process the client is being proactive: there&#8217;s a hight chance for broken connections to be found while being idle in the pool and no on actual request from the application.</p> </div> <div class="paragraph"> <p>The number of connections per server, total number of connections, how long should a connection be kept idle in the pool before being closed - all these (and more) can be configured. Please refer to the javadoc of <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/client/hotrod/RemoteCacheManager.html">RemoteCacheManager</a> for a list of all possible configuration elements.</p> </div> </div> <div class="sect4"> <h5 id="_marshalling_data"><a class="anchor" href="#_marshalling_data"></a>Marshalling data</h5> <div class="paragraph"> <p>The Hot Rod client allows one to plug in a custom marshaller for transforming user objects into byte arrays and the other way around. This transformation is needed because of Hot Rod&#8217;s binary nature - it doesn&#8217;t know about objects.</p> </div> <div class="paragraph"> <p>The marshaller can be plugged through the "marshaller" configuration element (see Configuration section): the value should be the fully qualified name of a class implementing the <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/marshall/Marshaller.html">Marshaller</a> interface. This is a optional parameter, if not specified it defaults to the <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/marshall/jboss/GenericJBossMarshaller.html">GenericJBossMarshaller</a> - a highly optimized implementation based on the <a href="http://www.jboss.org/jbossmarshalling">JBoss Marshalling</a> library.</p> </div> <div class="paragraph"> <p>Since version 5.0, there&#8217;s a new marshaller available to Java Hot Rod clients based on Apache Avro which generates portable payloads. You can find more information about it <a href="#sid-68355061">here</a></p> </div> </div> <div class="sect4"> <h5 id="_statistics"><a class="anchor" href="#_statistics"></a>Statistics</h5> <div class="paragraph"> <p>Various server usage statistics can be obtained through the <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a> .stats() method. This returns a <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/client/hotrod/ServerStatistics.html">ServerStatistics</a> object - please refer to javadoc for details on the available statistics.</p> </div> </div> <div class="sect4"> <h5 id="_configuration"><a class="anchor" href="#_configuration"></a>Configuration</h5> <div class="paragraph"> <p>All the configurations are passed to the RemoteCacheManager&#8217;s constructor as key-value pairs, through an instance of <a href="http://docs.oracle.com/javase/6/docs/api/java/util/Properties.html">java.util.Properties</a> or reference to a .properties file. Please refer to the javadoc of RemoteCacheManager for a exhaustive list of the possible configuration elements.</p> </div> </div> <div class="sect4"> <h5 id="_multi_get_operations"><a class="anchor" href="#_multi_get_operations"></a>Multi-Get Operations</h5> <div class="paragraph"> <p>The Java Hot Rod client does not provide multi-get functionality out of the box but clients can build it themselves with the given APIs.</p> </div> </div> <div class="sect4"> <h5 id="_more_info"><a class="anchor" href="#_more_info"></a>More info</h5> <div class="paragraph"> <p>It is highly recommended to read the following Javadocs (this is pretty much all the public API of the client):</p> </div> <div class="ulist"> <ul> <li> <p><a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/client/hotrod/RemoteCacheManager.html">RemoteCacheManager</a></p> </li> <li> <p><a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/client/hotrod/RemoteCache.html">RemoteCache</a></p> </li> </ul> </div> </div> </div> <div class="sect3"> <h4 id="sid-68355052"><a class="anchor" href="#sid-68355052"></a>1.4.8. Consistent Concurrent Updates With Hot Rod Versioned Operations</h4> <div class="paragraph"> <p>Data structures, such as Infinispan <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/Cache.html">Cache</a> , that are accessed and modified concurrently can suffer from data consistency issues unless there&#8217;re mechanisms to guarantee data correctness. Infinispan Cache, since it implements <a href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ConcurrentMap.html">ConcurrentMap</a> , provides operations such as <a href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ConcurrentMap.html#replace(K, V, V)">conditional replace</a> , <a href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ConcurrentMap.html#putIfAbsent(K, V)">putIfAbsent</a> , and <a href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ConcurrentMap.html#remove(java.lang.Object, java.lang.Object)">conditional remove</a> to its clients in order to guarantee data correctness. It even allows clients to operate against cache instances within JTA transactions, hence providing the necessary data consistency guarantees.</p> </div> <div class="paragraph"> <p>However, when it comes to <a href="http://community.jboss.org/wiki/HotRodProtocol">Hot Rod protocol</a> backed servers, clients do not yet have the ability to start remote transactions but they can call instead versioned operations to mimic the conditional methods provided by the embedded Infinispan cache instance API. Let&#8217;s look at a real example to understand how it works.</p> </div> <div class="sect4"> <h5 id="_data_consistency_problem"><a class="anchor" href="#_data_consistency_problem"></a>Data Consistency Problem</h5> <div class="paragraph"> <p>Imagine you have two ATMs that connect using Hot Rod to a bank where an account&#8217;s balance is stored. Two closely followed operations to retrieve the latest balance could return 500 CHF (swiss francs) as shown below:</p> </div> <div class="imageblock"> <div class="content"> <img src="images/server_modules_6.png" alt="server modules 6"> </div> </div> <div class="paragraph"> <p>Next a customer connects to the first ATM and requests 400 CHF to be retrieved. Based on the last value read, the ATM could calculate what the new balance is, which is 100 CHF, and request a put with this new value. Let&#8217;s imagine now that around the same time another customer connects to the ATM and requests 200 CHF to be retrieved. Let&#8217;s assume that the ATM thinks it has the latest balance and based on its calculations it sets the new balance to 300 CHF:</p> </div> <div class="imageblock"> <div class="content"> <img src="images/server_modules_7.png" alt="server modules 7"> </div> </div> <div class="paragraph"> <p>Obviously, this would be wrong. Two concurrent updates have resulted in an incorrect account balance. The second update should not have been allowed since the balance the second ATM had was incorrect. Even if the ATM would have retrieved the balance before calculating the new balance, someone could have updated between the new balance being retrieved and the update. Before finding out how to solve this issue in a client-server scenario with Hot Rod, let&#8217;s look at how this is solved when Infinispan clients run in peer-to-peer mode where clients and Infinispan live within the same JVM.</p> </div> <div class="sect5"> <h6 id="_embedded_mode_solution"><a class="anchor" href="#_embedded_mode_solution"></a>Embedded-mode Solution</h6> <div class="paragraph"> <p>If the ATM and the Infinispan instance storing the bank account lived in the same JVM, the ATM could use the <a href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ConcurrentMap.html#replace(K, V, V)">conditional replace API</a> referred at the beginning of this article. So, it could send the previous known value to verify whether it has changed since it was last read. By doing so, the first operation could double check that the balance is still 500 CHF when it was to update to 100 CHF. Now, when the second operation comes, the current balance would not be 500 CHF any more and hence the conditional replace call would fail, hence avoiding data consistency issues:</p> </div> <div class="imageblock"> <div class="content"> <img src="images/server_modules_8.png" alt="server modules 8"> </div> </div> </div> <div class="sect5"> <h6 id="_client_server_solution"><a class="anchor" href="#_client_server_solution"></a>Client-Server Solution</h6> <div class="paragraph"> <p>In theory, Hot Rod could use the same p2p solution but sending the previous value would be not practical. In this example, the previous value is just an integer but the value could be a lot bigger and hence forcing clients to send it to the server would be rather wasteful. Instead, Hot Rod offers versioned operations to deal with this situation.</p> </div> <div class="paragraph"> <p>Basically, together with each key/value pair, Hot Rod stores a version number which uniquely identifies each modification. So, using an operation called <a href="http://community.jboss.org/wiki/HotRodProtocol#getWithVersion_response">getVersioned or getWithVersion</a> , clients can retrieve not only the value associated with a key, but also the current version. So, if we look at the previous example once again, the ATMs could call getVersioned and get the balance&#8217;s version:</p> </div> <div class="imageblock"> <div class="content"> <img src="images/server_modules_9.png" alt="server modules 9"> </div> </div> <div class="paragraph"> <p>When the ATMs wanted to modify the balance, instead of just calling put, they could call <a href="http://community.jboss.org/wiki/HotRodProtocol#removeIfUnmodified_request">replaceIfUnmodified</a> operation passing the latest version number of which the clients are aware of. The operation will only succeed if the version passed matches the version in the server. So, the first modification by the ATM would be allowed since the client passes 1 as version and the server side version for the balance is also 1. On the other hand, the second ATM would not be able to make the modification because after the first ATMs modification the version would have been incremented to 2, and now the passed version (1) and the server side version (2) would not match:</p> </div> <div class="imageblock"> <div class="content"> <img src="images/server_modules_10.png" alt="server modules 10"> </div> </div> </div> </div> </div> <div class="sect3"> <h4 id="sid-68355104"><a class="anchor" href="#sid-68355104"></a>1.4.9. Interacting With Hot Rod Server From Within Same JVM</h4> <div class="paragraph"> <p>Normally, a Hot Rod server is accessed via a Hot Rod protocol client such as the Java Hot Rod client. However, there might be situations where not only do you want to access the Hot Rod server remotely, you might also want to access it locally from within the same JVM that the Hot Rod server is running. For example, you might have an Infinispan cache pushing changes <a href="#_remote_cache_loader">via the RemoteCacheStore to a Hot Rod server</a>, and if the cache goes down, you might want to access the data directly from the Hot Rod server itself.</p> </div> <div class="paragraph"> <p>In this situations, we have to remember that the Hot Rod protocol specifies that keys and values are stored as byte arrays. This means that if the client code, using an existing Hot Rod client, stored Strings or Integers, or any other complex serializable or externalizable object, you won&#8217;t be able to retrieve these objects straight from the cache that the Hot Rod server uses.</p> </div> <div class="paragraph"> <p>To actually get the fully constructed objects that you&#8217;re after, you&#8217;re gonna need to take the byte arrays stored within the Hot Rod server and unmarshall them into something that you can use. In the future, this is something that might be done for you, as suggested in <a href="https://jira.jboss.org/browse/ISPN-706">ISPN-706</a> (superseded by <a href="https://issues.jboss.org/browse/ISPN-2281">ISPN-2281</a> ), but for the time being, clients wanting to access Hot Rod server data will have to do it themselves.</p> </div> <div class="paragraph"> <p>Two different use cases need to be differentiated at this stage and to explain how to transform the Hot Rod server data into something usable, we&#8217;ll assume that the clients are java clients:</p> </div> <div class="sect4"> <h5 id="_data_stored_directly_via_a_hot_rod_client"><a class="anchor" href="#_data_stored_directly_via_a_hot_rod_client"></a>Data Stored Directly Via A Hot Rod Client</h5> <div class="paragraph"> <p>The most common case is for a client to use a Hot Rod client library directly to store data in the Hot Rod server. In this case, assuming that the client used the existing Java Hot Rod client, the default marshaller used to marshall objects into byte arrays is the <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/marshall/jboss/GenericJBossMarshaller.html">GenericJBossMarshaller</a> . So, if a user wants to read data from the Hot Rod server directly, it would need to execute something along the lines of:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.marshall.jboss.GenericJBossMarshaller</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.util.ByteArrayKey</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.server.core.CacheValue</span>;
...

<span class="comment">// Create a new instance of the marshaller:</span>
GenericJBossMarshaller marshaller = <span class="keyword">new</span> GenericJBossMarshaller();
<span class="predefined-type">Object</span> key = ...

<span class="comment">// Take the cache key and convert into a byte array,</span>
<span class="comment">// and wrap it with an instance of ByteArrayKey</span>
ByteArrayKey bytesKey = <span class="keyword">new</span> ByteArrayKey(marshaller.objectToByteBuffer(key));

<span class="comment">// Internally, Hot Rod stores values wrapped in a CacheValue, so retrieve it</span>
CacheValue cacheValue = (CacheValue) cache.get(bytesKey);

<span class="comment">// Take the data part which is byte array and unmarshall it to retrieve the value</span>
<span class="predefined-type">Object</span> value = marshaller.objectFromByteBuffer(cacheValue.data());
</code></pre> </div> </div> <div class="paragraph"> <p>If you want to store data directly in the HotRod server, you&#8217;d have to execute something like this:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.marshall.jboss.GenericJBossMarshaller</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.util.ByteArrayKey</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.server.core.CacheValue</span>;
...

<span class="comment">// Create a new instance of the marshaller:</span>
GenericJBossMarshaller marshaller = <span class="keyword">new</span> GenericJBossMarshaller();
<span class="predefined-type">Object</span> key = ...
Object value = ...

<span class="comment">// Take the cache key and convert into a byte array,</span>
<span class="comment">// and wrap it with an instance of ByteArrayKey</span>
ByteArrayKey bytesKey = <span class="keyword">new</span> ByteArrayKey(marshaller.objectToByteBuffer(key));

<span class="comment">// Internally, Hot Rod stores values wrapped in a CacheValue, so create instance</span>
<span class="comment">// Remember that you need to give it a version number, so either:</span>
<span class="comment">// 1. Increment previous value's version</span>
<span class="comment">// 2. Or generate a new version number that minimises potential clash</span>
<span class="comment">//    with a concurrent update to the same key in the cluster</span>
CacheValue cacheValue = <span class="keyword">new</span> CacheValue(marshaller.objectToByteBuffer(value), <span class="integer">1</span>)

<span class="comment">// Finally, store it in the cache</span>
cache.put(bytesKey, cacheValue);
</code></pre> </div> </div> </div> <div class="sect4"> <h5 id="_data_stored_via_remote_cache_store"><a class="anchor" href="#_data_stored_via_remote_cache_store"></a>Data Stored Via Remote Cache Store</h5> <div class="paragraph"> <p>Other times, Hot Rod server might be storing data coming from a <a href="https://docs.jboss.org/author/pages/viewpage.action?pageId=3737163">RemoteCacheStore</a> , rather than user code. In this case, there&#8217;re a couple of differences to the code above. First of all, the marshaller is slightly different. Instead, the RemoteCacheStore uses the <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/marshall/VersionAwareMarshaller.html">VersionAwareMarshaller</a> which all it does is add Infinispan version information to the byte array generated. The second difference is that RemoteCacheStore stores internal cache entry classes, which apart from the value part, they contain other extra information. So, any code trying to read these directly from the Hot Rod server would need to take in account. For example, to read data from such Hot Rod server:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.marshall.VersionAwareMarshaller</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.util.ByteArrayKey</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.server.core.CacheValue</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.container.entries.CacheEntry</span>;
...

<span class="comment">// Create a new instance of the marshaller</span>
VersionAwareMarshaller marshaller = <span class="keyword">new</span> VersionAwareMarshaller();
<span class="predefined-type">Object</span> key = ...

<span class="comment">// Take the cache key and convert into a byte array,</span>
<span class="comment">// and wrap it with an instance of ByteArrayKey</span>
ByteArrayKey bytesKey = <span class="keyword">new</span> ByteArrayKey(marshaller.objectToByteBuffer(key));

<span class="comment">// Internally, Hot Rod stores values wrapped in a CacheValue, so retrieve it</span>
CacheValue cacheValue = (CacheValue) cache.get(bytesKey);

<span class="comment">// However, in this case the data part of CacheValue does not contain directly</span>
<span class="comment">// the value Instead, it contains an instance of CacheEntry, so we need to</span>
<span class="comment">// unmarshall that and then get the actual value</span>
CacheEntry cacheEntry = (CacheEntry)
<span class="error"> </span><span class="error"> </span> marshaller.objectFromByteBuffer(cacheValue.data());
<span class="predefined-type">Object</span> value = cacheEntry.getValue();
</code></pre> </div> </div> <div class="paragraph"> <p>And to actually write data back into the Hot Rod server directly:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.marshall.VersionAwareMarshaller</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.util.ByteArrayKey</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.server.core.CacheValue</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.container.entries.CacheEntry</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.container.entries.InternalEntryFactory</span>;
...

<span class="comment">// Create a new instance of the marshaller:</span>
VersionAwareMarshaller marshaller = <span class="keyword">new</span> VersionAwareMarshaller();
<span class="predefined-type">Object</span> key = ...
Object value = ...

<span class="comment">// Take the cache key and convert into a byte array</span>
ByteArrayKey bytesKey = <span class="keyword">new</span> ByteArrayKey(marshaller.objectToByteBuffer(key));

<span class="comment">// With the value to store, a new CacheEntry instance needs to be created:</span>
CacheEntry cacheEntry = InternalEntryFactory.create(bytesKey, value, ...)

<span class="comment">// Internally, Hot Rod stores values wrapped in a CacheValue, so create instance</span>
<span class="comment">// Remember that you need to give it a version number, so either:</span>
<span class="comment">// 1. Increment previous value's version</span>
<span class="comment">// 2. Or generate a new version number that minimises potential clash</span>
<span class="comment">//    with a concurrent update to the same key in the cluster</span>
CacheValue cacheValue = <span class="keyword">new</span> CacheValue(
<span class="error"> </span><span class="error"> </span> marshaller.objectToByteBuffer(cacheEntry), <span class="integer">1</span>)

<span class="comment">// Finally, store it in the cache</span>
cache.put(bytesKey, cacheValue);
</code></pre> </div> </div> </div> <div class="sect4"> <h5 id="_multiple_tiers_of_caches"><a class="anchor" href="#_multiple_tiers_of_caches"></a>Multiple Tiers of Caches</h5> <div class="paragraph"> <p>A combination of the Hot Rod protocol and <a href="http://community.jboss.org/docs/DOC-14893?uniqueTitle=false#Remote_cache_loader">RemoteCacheLoader</a> opened the way for a set of new architectures in Infinispan, where layers of caches can exists and interact. This article takes a look at such a layered architecture.</p> </div> <div class="sect5"> <h6 id="_sample_architecture_near_caching"><a class="anchor" href="#_sample_architecture_near_caching"></a>Sample architecture/near caching</h6> <div class="imageblock"> <div class="content"> <img src="images/client_server.png" alt="client server"> </div> </div> <div class="paragraph"> <p>The diagram above shows an Infinispan server cluster running 3 hotrod servers. This cluster is accessed remotely, through HotRod, by another infinispan cluster:  client cluster (upper part of the image). All the nodes in the server cluster are configured to run HotRod servers, so requests from remote loader are being balanced between them. The client cluster is configured with invalidation as cluster mode and a RemoteCacheLoader to access data stored in the server cluster. Application data is held on the server cluster which runs in DIST mode for scalability.</p> </div> <div class="paragraph"> <p>In this deployment the client code, running in same address space with the client cluster,  holds all its data in the server cluster. Client cluster acts as an <em>near-cache</em> for frequently accessed entries.</p> </div> </div> </div> </div> <div class="sect3"> <h4 id="_querying_via_the_java_hot_rod_client"><a class="anchor" href="#_querying_via_the_java_hot_rod_client"></a>1.4.10. Querying via the Java Hot Rod client</h4> <div class="paragraph"> <p>While previous Infinispan versions were already providing <a href="#_querying_infinispan">indexing and searching</a> of Java entities to embedded clients, starting with Infinispan 6.0 and the introduction of the new <a href="#_hot_rod_protocol_1_3">Hot Rod protocol version 1.3</a> we add support for remote, language neutral, querying.</p> </div> <div class="paragraph"> <p>This leap required two major changes:</p> </div> <div class="ulist"> <ul> <li> <p>Since non-JVM clients cannot benefit from directly using <a href="http://lucene.apache.org/">Apache Lucene</a>'s Java API, Infinispan defines its own new <a href="#_infinispan_s_query_dsl">query language</a>, based on an internal DSL that is easily implementable in all languages for which we currently have an implementation of the Hot Rod client.</p> </li> <li> <p>In order to enable indexing, the entities put in the cache by clients can no longer be opaque binary blobs understood solely by the client. Their structure has to be known to both server and client, so a common way of encoding structured data had to be adopted. Furthermore, allowing multi-language clients to access the data requires a language and platform-neutral encoding. Google&#8217;s <a href="http://code.google.com/p/protobuf/">Protocol Buffers</a> was elected as an encoding format for both over-the-wire and storage due to its efficiency, robustness, good multi-language support and support for schema evolution.</p> </li> </ul> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="icon-note" title="Note"></i> </td> <td class="content"> As of 6.0, only the Java implementation of the Hot Rod client was upgraded to support querying. Clients for other languages will follow soon. </td> </tr> </table> </div> <div class="sect4"> <h5 id="_storing_protobuf_encoded_entities"><a class="anchor" href="#_storing_protobuf_encoded_entities"></a>Storing Protobuf encoded entities</h5> <div class="paragraph"> <p>Remote clients that want to be able to index and query their stored entities must do so using the Protobuf encoding format. This is <em>key</em> for the search capability to work. But it&#8217;s also possible to store Protobuf entities just for gaining the benefit of platform independence and not enable indexing if you do not need it.</p> </div> <div class="paragraph"> <p>Protobuf is all about structured data, so first thing you do to use it is define the structure of your data. This is accomplished by declaring protocol buffer message types in .proto files, like in the following example. Protobuf is a broad subject, we will not detail it here, so please consult the Protobuf <a href="https://developers.google.com/protocol-buffers/docs/overview">Developer Guide</a> for an in-depth explanation. It suffices to say for now that our example defines an entity (message type in protobuf speak) named <em>Book</em>, placed in a package named <em>book_sample</em>. Our entity declares several fields of primitive types and a repeatable field (an array basically) named <em>authors</em>. The <em>Author</em> message instances are embedded in the <em>Book</em> message instance.</p> </div> <div class="listingblock"> <div class="title">library.proto</div> <div class="content"> <pre class="CodeRay"><code class="proto language-proto">package book_sample;

message Book {
  required string title = 1;
  required string description = 2;
  required int32 publicationYear = 3; // no native Date type available in Protobuf

  repeated Author authors = 4;
}

message Author {
  required string name = 1;
  required string surname = 2;
}</code></pre> </div> </div> <div class="paragraph"> <p>There are a few important notes we need to make about Protobuf messages:</p> </div> <div class="ulist"> <ul> <li> <p>nesting of messages is possible, but the resulting structure is strictly a tree, never a graph</p> </li> <li> <p>there is no concept of type inheritance</p> </li> <li> <p>collections are not supported but arrays can be easily emulated using repeated fields</p> </li> </ul> </div> <div class="paragraph"> <p>Using Protobuf with the Java Hot Rod client is a two step process. First, the client must be configured to use a dedicated marshaller, <a href="http://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/client/hotrod/marshall/ProtoStreamMarshaller.html"><em>ProtoStreamMarshaller</em></a>. This marshaller uses the <a href="https://github.com/infinispan/protostream"><em>ProtoStream</em></a> library to assist you in encoding your objects. The second step is instructing <em>ProtoStream</em> library on how to marshall your message types. The following example highlights this process.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
13
14
15
16
17
18
19
</pre></td> <td class="code"><pre><span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.configuration.ConfigurationBuilder</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod.marshall.ProtoStreamMarshaller</span>;
<span class="keyword">import</span> <span class="include">org.infinispan.protostream.SerializationContext</span>;
...

ConfigurationBuilder clientBuilder = <span class="keyword">new</span> ConfigurationBuilder();
clientBuilder.addServer()
    .host(<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1</span><span class="delimiter">&quot;</span></span>).port(<span class="integer">11234</span>)
    .marshaller(<span class="keyword">new</span> ProtoStreamMarshaller());

RemoteCacheManager remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(clientBuilder.build());

SerializationContext srcCtx = ProtoStreamMarshaller.getSerializationContext(remoteCacheManager);

serCtx.registerProtofile(<span class="string"><span class="delimiter">&quot;</span><span class="content">/library.protobin</span><span class="delimiter">&quot;</span></span>);
serCtx.registerMarshaller(<span class="predefined-type">Book</span>.class, <span class="keyword">new</span> BookMarshaller());
serCtx.registerMarshaller(Author.class, <span class="keyword">new</span> AuthorMarshaller());

<span class="comment">// Book and Author classes omitted for brevity</span></pre></td> </tr></table> </code></pre> </div> </div> <div class="paragraph"> <p>The interesting part in this sample is obtaining the <em>SerializationContext</em> associated to the <em>RemoteCacheManager</em> and then instructing ProtoStream about the protobuf types we want to marshall. The <em>SerializationContext</em> is provided by the library for this purpose. The <code>SerializationContext.registerProtofile</code> method receives the name of a classpath resource that is expected to be a serialized protobuf binary descriptor containing our type declarations. The binary descriptor (.protobin) is compiled with the help of Protobuf&#8217;s <em>protoc</em> generator tool using the <em>--descriptor_set_out</em> command line option out of the <em>library.proto</em> file we created earlier. It&#8217;s basically just a more compact equivalent representation of our file. Future Infinispan versions will be able to accept the .proto file directly (see <a href="https://issues.jboss.org/browse/ISPN-3480">ISPN-3480</a>). Generating binary descriptors from .proto files is described <a href="https://developers.google.com/protocol-buffers/docs/techniques#self-description">here</a>.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="icon-note" title="Note"></i> </td> <td class="content"> A <em>RemoteCacheManager</em> has no <em>SerializationContext</em> associated with it unless it was configured to use a <em>ProtoStreamMarshaller</em>. </td> </tr> </table> </div> <div class="paragraph"> <p>The next relevant part is the registration of per entity marshallers for our domain model types. They must be provided by the user for each type or marshalling will fail. Writing marshallers is a simple process. The <em>BookMarshaller</em> example should get you started. The most important thing you need to consider is they need to be stateless and threadsafe as a single instance of them is being used.</p> </div> <div class="listingblock"> <div class="title">BookMarshaller.java</div> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.protostream.MessageMarshaller</span>;
...

public <span class="type">class</span> <span class="class">BookMarshaller</span> <span class="directive">implements</span> MessageMarshaller&lt;<span class="predefined-type">Book</span>&gt; {

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="predefined-type">String</span> getTypeName() {
      <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">book_sample.Book</span><span class="delimiter">&quot;</span></span>;
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> <span class="predefined-type">Book</span>&gt; getJavaClass() {
      <span class="keyword">return</span> <span class="predefined-type">Book</span>.class;
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="type">void</span> writeTo(ProtoStreamWriter writer, <span class="predefined-type">Book</span> book) <span class="directive">throws</span> <span class="exception">IOException</span> {
      writer.writeString(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>, book.getTitle());
      writer.writeString(<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>, book.getDescription());
      writer.writeCollection(<span class="string"><span class="delimiter">&quot;</span><span class="content">authors</span><span class="delimiter">&quot;</span></span>, book.getAuthors(), Author.class);
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="predefined-type">Book</span> readFrom(ProtoStreamReader reader) <span class="directive">throws</span> <span class="exception">IOException</span> {
      <span class="predefined-type">String</span> title = reader.readString(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>);
      <span class="predefined-type">String</span> description = reader.readString(<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>);
      <span class="type">int</span> publicationYear = reader.readInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">publicationYear</span><span class="delimiter">&quot;</span></span>);
      <span class="predefined-type">Set</span>&lt;Author&gt; authors = reader.readCollection(<span class="string"><span class="delimiter">&quot;</span><span class="content">authors</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;Author&gt;(), Author.class);
      <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">Book</span>(title, description, publicationYear, authors);
   }
}</code></pre> </div> </div> <div class="paragraph"> <p>Once you&#8217;ve followed these steps to setup your client you can start reading and writing Java objects to the remote cache and the actual data stored in the cache will be protobuf encoded provided that marshallers were registered with the remote client for all involved types (<em>Book</em> and <em>Author</em> in our example). Keeping your objects stored in protobuf format has the benefit of being able to consume them with compatible clients written in different languages.</p> </div> <div class="paragraph"> <p>TODO Add reference to sample in C++ client user guide</p> </div> </div> <div class="sect4"> <h5 id="_indexing_of_protobuf_encoded_entries"><a class="anchor" href="#_indexing_of_protobuf_encoded_entries"></a>Indexing of Protobuf encoded entries</h5> <div class="paragraph"> <p>After configuring the client as described in the previous section you can start configuring indexing for your caches on the server side. Activating indexing and the various indexing specific configurations is identical to embedded mode and is detailed in the <a href="#_configuration_7">Querying Infinispan</a> chapter.</p> </div> <div class="paragraph"> <p>There is however an extra configuration step involved. While in embedded mode the indexing metadata is obtained via Java reflection by analyzing the presence of various Hibernate Search annotations on the entry&#8217;s class, this is obviously not possible if the entry is protobuf encoded. The server needs to extract the relevant metadata from the same binary descriptor (.protobin file) as the client. The descriptor is currently supplied to the server by remotely invoking the <em>ProtobufMetadataManager</em> MBean via JMX. The <em>ProtobufMetadataManager</em> is a cluster-wide replicated repository of protobuf descriptors. For each running cache manager a separate <em>ProtobufMetadataManager</em> MBean instance exists. Its ObjectName follows this pattern:</p> </div> <div class="literalblock"> <div class="content"> <pre>&lt;jmx domain&gt;:type=RemoteQuery,name=&lt;cache manager name&gt;,component=ProtobufMetadataManager</pre> </div> </div> <div class="paragraph"> <p>The method relevant for registering the protobuf descriptor file has the signature:</p> </div> <div class="literalblock"> <div class="content"> <pre>void registerProtofile(byte[] descriptorFile)</pre> </div> </div> <div class="paragraph"> <p>A detailed example for all the described steps can be seen in the Java Hot Rod client test suite, particularly in <a href="https://github.com/infinispan/infinispan/blob/6.0.0.CR1/client/hotrod-client/src/test/java/org/infinispan/client/hotrod/query/HotRodQueryTest.java">HotRodQueryTest</a></p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="icon-note" title="Note"></i> </td> <td class="content"> Once indexing is enabled for a cache all fields of Protobuf encoded entries are going to be indexed. Future versions will allow you to select which fields to index (see <a href="https://issues.jboss.org/browse/ISPN-3718">ISPN-3718</a>). </td> </tr> </table> </div> </div> <div class="sect4"> <h5 id="_a_remote_query_example"><a class="anchor" href="#_a_remote_query_example"></a>A remote query example</h5> <div class="paragraph"> <p>You&#8217;ve managed to configure both client and server to talk protobuf and you&#8217;ve enabled indexing. Let&#8217;s put some data in the cache and try to search for it then!</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.client.hotrod</span>.*;
<span class="keyword">import</span> <span class="include">org.infinispan.query.dsl</span>.*;
...

RemoteCacheManager remoteCacheManager = ...;
RemoteCache&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">Book</span>&gt; remoteCache = remoteCacheManager.getCache();

<span class="predefined-type">Book</span> book1 = <span class="keyword">new</span> <span class="predefined-type">Book</span>();
book1.setTitle(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hibernate in Action</span><span class="delimiter">&quot;</span></span>);
remoteCache.put(<span class="integer">1</span>, book1);

<span class="predefined-type">Book</span> book2 = <span class="keyword">new</span> <span class="predefined-type">Book</span>();
book2.setTile(<span class="string"><span class="delimiter">&quot;</span><span class="content">Infinispan Data Grid Platform</span><span class="delimiter">&quot;</span></span>);
remoteCache.put(<span class="integer">2</span>, book2);

QueryFactory qf = Search.getQueryFactory(remoteCache);
<span class="predefined-type">Query</span> query = qf.from(<span class="predefined-type">Book</span>.class)
            .having(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).like(<span class="string"><span class="delimiter">&quot;</span><span class="content">%Infinispan%</span><span class="delimiter">&quot;</span></span>).toBuilder()
            .build();

<span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; list = query.list(); <span class="comment">// Voila! We have our book back from the cache!</span></code></pre> </div> </div> <div class="paragraph"> <p>The key part of creating a query is obtaining the <em>QueryFactory</em> for the remote cache using the <em>org.infinispan.client.hotrod.Search.getQueryFactory()</em> method. Once you have this creating the query is similar to embedded mode which is covered in <a href="#_infinispan_s_query_dsl">this</a> section.</p> </div> </div> <div class="sect4"> <h5 id="_running_in_compatibility_mode"><a class="anchor" href="#_running_in_compatibility_mode"></a>Running in Compatibility Mode</h5> <div class="paragraph"> <p>TODO</p> </div> </div> </div> </div> <div class="sect2"> <h3 id="_infinispan_rest_server"><a class="anchor" href="#_infinispan_rest_server"></a>1.5. Infinispan REST Server</h3> <div class="paragraph"> <p>This server provides easy to use <a href="http://en.wikipedia.org/wiki/Representational_State_Transfer">RESTful</a> HTTP access to the Infinispan data grid, build on JAX_RS. This application is delivered (currently) as a <a href="http://en.wikipedia.org/wiki/WAR_file_format_(Sun)">WAR file</a>, which you can deploy to a servlet container (as many instances as you need).</p> </div> <div class="sect3"> <h4 id="_configuration_2"><a class="anchor" href="#_configuration_2"></a>1.5.1. Configuration</h4> <div class="paragraph"> <p>Out of the box, Infinispan will create and use a new LOCAL mode cache. To set a custom configuration:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Unzip the REST WAR file (or use an <a href="http://community.jboss.org/docs/DOC-9719">exploded</a> deployment)</p> </li> <li> <p>Create an Infinispan configuration XML file and name this <code>infinispan.xml</code></p> </li> <li> <p>Place this file in infinispan-server-rest.war/WEB-INF/classes</p> </li> </ol> </div> <div class="paragraph"> <p>Alternatively, you could:</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>Unzip the REST WAR file (or use an <a href="http://community.jboss.org/docs/DOC-9719">exploded</a> deployment)</p> </li> <li> <p>Create an Infinispan configuration XML file, call it whatever you want and place it wherever you want</p> </li> <li> <p>Edit <code>infinispan-server-rest.war/WEB-INF/web.xml</code> and look for the <code>infinispan.config</code> init-param. Change the value of this init-param to the full path to your Infinispan configuration.</p> </li> </ol> </div> <div class="paragraph"> <p><span class="image"><img src="../images/WebXmlInfinispanConfig.png" alt="WebXmlInfinispanConfig"></span></p> </div> <div class="paragraph"> <p>Please note that the REST server only allows interaction with either the default cache (named <code>___defaultcache</code>) or one of the named caches in the configuration file. This is because the REST server starts the default and pre-defined caches on startup in order to provide consistent behavior.</p> </div> <div class="admonitionblock warning"> <table> <tr> <td class="icon"> <i class="icon-warning" title="Warning"></i> </td> <td class="content"> Creation of new named caches on the fly is not supported. </td> </tr> </table> </div> <div class="paragraph"> <p>As a result, if you don&#8217;t use a custom configuration file, you&#8217;ll only be able to interact with the default cache. To interact with more caches, use a configuration file with the desired named caches.</p> </div> </div> <div class="sect3"> <h4 id="_rest_api"><a class="anchor" href="#_rest_api"></a>1.5.2. REST API</h4> <div class="paragraph"> <p>HTTP PUT and POST methods are used to place data in the cache, with URLs to address the cache name and key(s) - the data being the body of the request (the data can be anything you like). It is important that a Content-Type header is set. Other headers are used to control the cache settings and behaviour (detailed in that link).</p> </div> <div class="sect4"> <h5 id="_putting_data_in"><a class="anchor" href="#_putting_data_in"></a>Putting data in</h5> <div class="sect5"> <h6 id="__code_put_cachename_cachekey_code"><a class="anchor" href="#__code_put_cachename_cachekey_code"></a><code>PUT /{cacheName}/{cacheKey}</code></h6> <div class="paragraph"> <p>A PUT request of the above URL form will place the payload (body) in the given cache, with the given key (the named cache must exist on the server). For example <code>http://someserver/hr/payRoll/3</code> (in which case <code>hr</code> is the cache name, and <code>payRoll/3</code> is the key). Any existing data will be replaced, and Time-To-Live and Last-Modified values etc will updated (if applicable).</p> </div> </div> <div class="sect5"> <h6 id="__code_post_cachename_cachekey_code"><a class="anchor" href="#__code_post_cachename_cachekey_code"></a><code>POST /{cacheName}/{cacheKey}</code></h6> <div class="paragraph"> <p>Exactly the same as PUT, only if a value in a cache/key already exists, it will return a Http CONFLICT status (and the content will not be updated).</p> </div> </div> <div class="sect5"> <h6 id="_headers"><a class="anchor" href="#_headers"></a>Headers</h6> <div class="ulist"> <ul> <li> <p>Content-Type : MANDATORY (use <a href="http://www.iana.org/assignments/media-types/">media/mime-types</a> for example: "application/json"). If you set the Content-Type to <code>application/x-java-serialized-object</code>, then it will be stored as a Java object</p> </li> <li> <p>performAsync : OPTIONAL true/false (if true, this will return immediately, and then replicate data to the cluster on its own. Can help with bulk data inserts/large clusters.)</p> </li> <li> <p>timeToLiveSeconds : OPTIONAL number (the number of seconds before this entry will automatically be deleted). If no parameter is sent, Infinispan assumes -1 as default value, which means that the entry will not expire. Passing any negative value will have the same effect.</p> </li> <li> <p>maxIdleTimeSeconds : OPTIONAL number (the number of seconds after last usage of this entry when it will automatically be deleted). If no parameter is sent, Infinispan assumes -1 as default value, which means that the entry will not expire as a result of idle time. Passing any negative value will have the same effect.</p> </li> </ul> </div> <div class="ulist"> <div class="title">Passing 0 as parameter for timeToLiveSeconds and/or maxIdleTimeSeconds</div> <ul> <li> <p>If both <code>timeToLiveSeconds</code> and <code>maxIdleTimeSeconds</code> are 0, the cache will use the default <code>lifespan</code> and <code>maxIdle</code> values configured in XML/programmatically</p> </li> <li> <p>If <em>only</em> <code>maxIdleTimeSeconds</code> is 0, it uses the <code>timeToLiveSeconds</code> value passed as parameter (or -1 if not present), and default <code>maxIdle</code> configured in XML/programmatically</p> </li> <li> <p>If <em>only</em> <code>timeToLiveSeconds</code> is 0, it uses default <code>lifespan</code> configured in XML/programmatically, and <code>maxIdle</code> is set to whatever came as parameter (or -1 if not present)</p> </li> </ul> </div> </div> </div> <div class="sect4"> <h5 id="_getting_data_back_out"><a class="anchor" href="#_getting_data_back_out"></a>Getting data back out</h5> <div class="paragraph"> <p>HTTP GET and HEAD are used to retrieve data from entries.</p> </div> <div class="sect5"> <h6 id="__code_get_cachename_cachekey_code"><a class="anchor" href="#__code_get_cachename_cachekey_code"></a><code>GET /{cacheName}/{cacheKey}</code></h6> <div class="paragraph"> <p>This will return the data found in the given cacheName, under the given key - as the body of the response. A Content-Type header will be supplied which matches what the data was inserted as (other then if it is a Java object, see below). Browsers can use the cache directly of course (eg as a CDN). An <a href="http://en.wikipedia.org/wiki/HTTP_ETag">ETag</a> will be returned unique for each entry, as will the Last-Modified and Expires headers field indicating the state of the data at the given URL. ETags allow browsers (and other clients) to ask for data only in the case where it has changed (to save on bandwidth) - this is standard HTTP and is honoured by Infinispan.</p> </div> <div class="paragraph"> <p>Since Infinispan 5.3 it is possible to obtain additional information by appending the "extended" parameter on the query string, as follows:</p> </div> <div class="literalblock"> <div class="content"> <pre>GET /cacheName/cacheKey?extended</pre> </div> </div> <div class="paragraph"> <p>This will return the following custom headers:</p> </div> <div class="ulist"> <ul> <li> <p>Cluster-Primary-Owner: the node name of the primary owner for this key</p> </li> <li> <p>Cluster-Node-Name: the JGroups node name of the server that has handled the request</p> </li> <li> <p>Cluster-Physical-Address: the physical JGroups address of the server that has handled the request.</p> </li> </ul> </div> </div> <div class="sect5"> <h6 id="__code_head_cachename_cachekey_code"><a class="anchor" href="#__code_head_cachename_cachekey_code"></a><code>HEAD /{cacheName}/{cacheKey}</code></h6> <div class="paragraph"> <p>The same as GET, only no content is returned (only the header fields). You will receive the same content that you stored. E.g., if you stored a String, this is what you get back. If you stored some XML or JSON, this is what you will receive. If you stored a binary (base 64 encoded) blob, perhaps a serialized; Java; object - you will need to; deserialize this yourself.</p> </div> <div class="paragraph"> <p>Similarly to the GET method, the HEAD method also supports returning extended information via headers. See above.</p> </div> </div> </div> <div class="sect4"> <h5 id="_listing_keys"><a class="anchor" href="#_listing_keys"></a>Listing keys</h5> <div class="sect5"> <h6 id="__code_get_cachename_code"><a class="anchor" href="#__code_get_cachename_code"></a><code>GET /{cacheName}</code></h6> <div class="paragraph"> <p>This will return a list of keys present in the given cacheName as the body of the response. The format of the response can be controlled via the Accept header as follows:</p> </div> <div class="ulist"> <ul> <li> <p>application/xml - the list of keys will be returned in XML format.</p> </li> <li> <p>application/json - the list of keys will be return in JSON format.</p> </li> <li> <p>text/html - the list of keys will be returned in HTML format.</p> </li> <li> <p>text/plain - the list of keys will be returned in plain text format, one key per line</p> </li> </ul> </div> <div class="paragraph"> <p>If the cache identified by cacheName is distributed, only the keys owned by the node handling the request will be returned. To return all keys, append the "global" parameter to the query, as follows:</p> </div> <div class="literalblock"> <div class="content"> <pre>GET /cacheName?global</pre> </div> </div> </div> </div> <div class="sect4"> <h5 id="_removing_data"><a class="anchor" href="#_removing_data"></a>Removing data</h5> <div class="paragraph"> <p>Data can be removed at the cache key/element level, or via a whole cache name using the HTTP delete method.</p> </div> <div class="sect5"> <h6 id="__code_delete_cachename_cachekey_code"><a class="anchor" href="#__code_delete_cachename_cachekey_code"></a><code>DELETE /{cacheName}/{cacheKey}</code></h6> <div class="paragraph"> <p>Removes the given key name from the cache.</p> </div> </div> <div class="sect5"> <h6 id="__code_delete_cachename_code"><a class="anchor" href="#__code_delete_cachename_code"></a><code>DELETE /{cacheName}</code></h6> <div class="paragraph"> <p>Removes ALL the entries in the given cache name (i.e., everything from that path down). If the operation is successful, it returns 200 code.</p> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="icon-tip" title="Tip"></i> </td> <td class="content"> <div class="title">Make it quicker!</div> Set the header performAsync to true to return immediately and let the removal happen in the background. </td> </tr> </table> </div> </div> </div> </div> <div class="sect3"> <h4 id="_client_side_code"><a class="anchor" href="#_client_side_code"></a>1.5.3. Client side code</h4> <div class="paragraph"> <p>Part of the point of a RESTful service is that you don&#8217;t need to have tightly coupled client libraries/bindings. All you need is a HTTP client library. For Java, Apache HTTP Commons Client works just fine (and is used in the integration tests), or you can use java.net API.</p> </div> <div class="sect4"> <h5 id="_ruby_example"><a class="anchor" href="#_ruby_example"></a>Ruby example</h5> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="ruby language-ruby"><span class="comment"># Shows how to interact with Infinispan REST api from ruby.</span>
<span class="comment"># No special libraries, just standard net/http</span>
<span class="comment">#</span>
<span class="comment"># Author: Michael Neale</span>
<span class="comment">#</span>
require <span class="string"><span class="delimiter">'</span><span class="content">net/http</span><span class="delimiter">'</span></span>

http = <span class="constant">Net</span>::<span class="constant">HTTP</span>.new(<span class="string"><span class="delimiter">'</span><span class="content">localhost</span><span class="delimiter">'</span></span>, <span class="integer">8080</span>)

<span class="comment">#Create new entry</span>
http.post(<span class="string"><span class="delimiter">'</span><span class="content">/infinispan/rest/MyData/MyKey</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">DATA HERE</span><span class="delimiter">'</span></span>, {<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>})

<span class="comment">#get it back</span>
puts http.get(<span class="string"><span class="delimiter">'</span><span class="content">/infinispan/rest/MyData/MyKey</span><span class="delimiter">'</span></span>).body

<span class="comment">#use PUT to overwrite</span>
http.put(<span class="string"><span class="delimiter">'</span><span class="content">/infinispan/rest/MyData/MyKey</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">MORE DATA</span><span class="delimiter">'</span></span>, {<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>})

<span class="comment">#and remove...</span>
http.delete(<span class="string"><span class="delimiter">'</span><span class="content">/infinispan/rest/MyData/MyKey</span><span class="delimiter">'</span></span>)

<span class="comment">#Create binary data like this... just the same...</span>
http.put(<span class="string"><span class="delimiter">'</span><span class="content">/infinispan/rest/MyImages/Image.png</span><span class="delimiter">'</span></span>, <span class="constant">File</span>.read(<span class="string"><span class="delimiter">'</span><span class="content">/Users/michaelneale/logo.png</span><span class="delimiter">'</span></span>), {<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">image/png</span><span class="delimiter">&quot;</span></span>})


<span class="comment">#and if you want to do json...</span>
require <span class="string"><span class="delimiter">'</span><span class="content">rubygems</span><span class="delimiter">'</span></span>
require <span class="string"><span class="delimiter">'</span><span class="content">json</span><span class="delimiter">'</span></span>

<span class="comment">#now for fun, lets do some JSON !</span>
data = {<span class="symbol">:name</span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">michael</span><span class="delimiter">&quot;</span></span>, <span class="symbol">:age</span> =&gt; <span class="integer">42</span> }
http.put(<span class="string"><span class="delimiter">'</span><span class="content">/infinispan/rest/Users/data/0</span><span class="delimiter">'</span></span>, data.to_json, {<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span> =&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>})
</code></pre> </div> </div> </div> <div class="sect4"> <h5 id="_python_example"><a class="anchor" href="#_python_example"></a>Python example</h5> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="python language-python">
<span class="comment"># Sample python code using the standard http lib only</span>
<span class="comment">#</span>

<span class="keyword">import</span> <span class="include">httplib</span>


<span class="comment">#putting data in</span>
conn = httplib.HTTPConnection(<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost:8080</span><span class="delimiter">&quot;</span></span>)
data = <span class="string"><span class="delimiter">&quot;</span><span class="content">SOME DATA HERE </span><span class="content">\!</span><span class="delimiter">&quot;</span></span> <span class="comment">#could be string, or a file...</span>
conn.request(<span class="string"><span class="delimiter">&quot;</span><span class="content">POST</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/infinispan/rest/Bucket/0</span><span class="delimiter">&quot;</span></span>, data, {<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>})
response = conn.getresponse()
<span class="keyword">print</span> response.status

<span class="comment">#getting data out</span>
<span class="keyword">import</span> <span class="include">httplib</span>
conn = httplib.HTTPConnection(<span class="string"><span class="delimiter">&quot;</span><span class="content">localhost:8080</span><span class="delimiter">&quot;</span></span>)
conn.request(<span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/infinispan/rest/Bucket/0</span><span class="delimiter">&quot;</span></span>)
response = conn.getresponse()
<span class="keyword">print</span> response.status
<span class="keyword">print</span> response.read()
</code></pre> </div> </div> </div> <div class="sect4"> <h5 id="_java_example"><a class="anchor" href="#_java_example"></a>Java example</h5> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java">
<span class="keyword">import</span> <span class="include">java.io.BufferedReader</span>;
<span class="keyword">import</span> <span class="include">java.io.IOException</span>;
<span class="keyword">import</span> <span class="include">java.io.InputStreamReader</span>;
<span class="keyword">import</span> <span class="include">java.io.OutputStreamWriter</span>;
<span class="keyword">import</span> <span class="include">java.net.HttpURLConnection</span>;
<span class="keyword">import</span> <span class="include">java.net.URL</span>;

<span class="comment">/**
 * Rest example accessing Infinispan Cache.
 * @author Samuel Tauil (samuel@redhat.com)
 *
 */</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">RestExample</span> {

   <span class="comment">/**
    * Method that puts a String value in cache.
    * @param urlServerAddress
    * @param value
    * @throws IOException
    */</span>
   <span class="directive">public</span> <span class="type">void</span> putMethod(<span class="predefined-type">String</span> urlServerAddress, <span class="predefined-type">String</span> value) <span class="directive">throws</span> <span class="exception">IOException</span> {
<span class="error"> </span><span class="error"> </span><span class="error"> </span>   <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">----------------------------------------</span><span class="delimiter">&quot;</span></span>);
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Executing PUT</span><span class="delimiter">&quot;</span></span>);
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">----------------------------------------</span><span class="delimiter">&quot;</span></span>);
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="predefined-type">URL</span> address = <span class="keyword">new</span> <span class="predefined-type">URL</span>(urlServerAddress);
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">executing request </span><span class="delimiter">&quot;</span></span> + urlServerAddress);
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="predefined-type">HttpURLConnection</span> connection = (<span class="predefined-type">HttpURLConnection</span>) address.openConnection();
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Executing put method of value: </span><span class="delimiter">&quot;</span></span> + value);
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>connection.setRequestMethod(<span class="string"><span class="delimiter">&quot;</span><span class="content">PUT</span><span class="delimiter">&quot;</span></span>);
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>connection.setRequestProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>);
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>connection.setDoOutput(<span class="predefined-constant">true</span>);

<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="predefined-type">OutputStreamWriter</span> outputStreamWriter = <span class="keyword">new</span> <span class="predefined-type">OutputStreamWriter</span>(connection.getOutputStream());
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>outputStreamWriter.write(value);
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>connection.connect();
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>outputStreamWriter.flush();
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">----------------------------------------</span><span class="delimiter">&quot;</span></span>);
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="predefined-type">System</span>.out.println(connection.getResponseCode() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span> + connection.getResponseMessage());
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">----------------------------------------</span><span class="delimiter">&quot;</span></span>);
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>connection.disconnect();
   }

   <span class="comment">/**
    * Method that gets a value by a key in url as param value.
    * @param urlServerAddress
    * @return String value
    * @throws IOException
    */</span>
   <span class="directive">public</span> <span class="predefined-type">String</span> getMethod(<span class="predefined-type">String</span> urlServerAddress) <span class="directive">throws</span> <span class="exception">IOException</span> {
      <span class="predefined-type">String</span> line = <span class="keyword">new</span> <span class="predefined-type">String</span>();
      <span class="predefined-type">StringBuilder</span> stringBuilder = <span class="keyword">new</span> <span class="predefined-type">StringBuilder</span>();

      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">----------------------------------------</span><span class="delimiter">&quot;</span></span>);
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Executing GET</span><span class="delimiter">&quot;</span></span>);
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">----------------------------------------</span><span class="delimiter">&quot;</span></span>);

      <span class="predefined-type">URL</span> address = <span class="keyword">new</span> <span class="predefined-type">URL</span>(urlServerAddress);
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">executing request </span><span class="delimiter">&quot;</span></span> + urlServerAddress);

      <span class="predefined-type">HttpURLConnection</span> connection = (<span class="predefined-type">HttpURLConnection</span>) address.openConnection();
      connection.setRequestMethod(<span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>);
      connection.setRequestProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>);
      connection.setDoOutput(<span class="predefined-constant">true</span>);

      <span class="predefined-type">BufferedReader</span>&amp;nbsp; bufferedReader = <span class="keyword">new</span> <span class="predefined-type">BufferedReader</span>(<span class="keyword">new</span> <span class="predefined-type">InputStreamReader</span>(connection.getInputStream()));

      connection.connect();

      <span class="keyword">while</span> ((line = bufferedReader.readLine()) <span class="error">\</span>!= <span class="predefined-constant">null</span>) {
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>   stringBuilder.append(line + <span class="string"><span class="delimiter">'</span><span class="content">\n</span><span class="delimiter">'</span></span>);
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>}

      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Executing get method of value: </span><span class="delimiter">&quot;</span></span> + stringBuilder.toString());

      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">----------------------------------------</span><span class="delimiter">&quot;</span></span>);
      <span class="predefined-type">System</span>.out.println(connection.getResponseCode() + <span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span> + connection.getResponseMessage());
      <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">----------------------------------------</span><span class="delimiter">&quot;</span></span>);

      connection.disconnect();

      <span class="keyword">return</span> stringBuilder.toString();
   }

   <span class="comment">/**
    * Main method example.
    * @param args
    * @throws IOException
    */</span>
   <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="error">\</span>[<span class="error">\</span>] args) <span class="directive">throws</span> <span class="exception">IOException</span> {
      <span class="comment">//Attention to the cache name &quot;cacheX&quot; it was configured in xml file with tag &lt;namedCache name=&quot;cacheX&quot;&gt;</span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>RestExample restExample = <span class="keyword">new</span> RestExample();
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>restExample.putMethod(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/infinispan/rest/cacheX/1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Infinispan REST Test</span><span class="delimiter">&quot;</span></span>);
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>restExample.getMethod(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/infinispan/rest/cacheX/1</span><span class="delimiter">&quot;</span></span>);<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span>}
}
</code></pre> </div> </div> </div> </div> </div> <div class="sect2"> <h3 id="_using_infinispan_memcached_server"><a class="anchor" href="#_using_infinispan_memcached_server"></a>1.6. Using Infinispan Memcached Server</h3> <div class="paragraph"> <p>The Infinispan distribution contains a server module that implements the <a href="http://github.com/memcached/memcached/blob/master/doc/protocol.txt">Memcached text protocol</a> . This allows Memcached clients to talk to one or several Infinispan backed Memcached servers. These servers could either be working standalone just like Memcached does where each server acts independently and does not communicate with the rest, or they could be clustered where servers replicate or distribute their contents to other Infinispan backed Memcached servers, thus providing clients with failover capabilities.</p> </div> <div class="sect3"> <h4 id="_starting_an_infinispan_memcached_server"><a class="anchor" href="#_starting_an_infinispan_memcached_server"></a>1.6.1. Starting an Infinispan Memcached server</h4> <div class="paragraph"> <p>The simplest way to start up an Infinispan memcached server is to simply unzip the all distribution and either run the startServer.bat or startServer.sh script passing memcached as the protocol to run. For example:</p> </div> <div class="listingblock"> <div class="content"> <pre>$ ./bin/startServer.sh -r memcached</pre> </div> </div> <div class="paragraph"> <p>When the script is called without any further parameters, the started Infinispan Memcached server binds to <em>port 11211 on localhost</em> (127.0.0.1) and uses a local (unclustered) Infinispan cache instance configured with default values underneath.</p> </div> </div> <div class="sect3"> <h4 id="_command_line_options_2"><a class="anchor" href="#_command_line_options_2"></a>1.6.2. Command Line Options</h4> <div class="paragraph"> <p>You can optionally pass a set of parameters to the Infinispan Memcached server that allow you to configure different parts of the server.</p> </div> <div class="paragraph"> <p>Please note that, since the Memcached protocol does not allow specifying a cache to use, the mapping between Infinispan Memcached server instances and Infinispan Cache instances is 1 to 1. Therefore, when passing an Infinispan configuration file to the Infinispan Memcache server, either define a named cache with name "memcachedCache" or modify the default cache configuration.</p> </div> </div> <div class="sect3"> <h4 id="_enabling_statistics"><a class="anchor" href="#_enabling_statistics"></a>1.6.3. Enabling Statistics</h4> <div class="paragraph"> <p>The memcached module makes use of the JMX statistics in the cache configuration. For example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;default&gt;</span>
   ...
   <span class="tag">&lt;jmxStatistics</span> <span class="attribute-name">enabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   ...
<span class="tag">&lt;/default&gt;</span>
</code></pre> </div> </div> <div class="paragraph"> <p>Infinispan Memcached server has jmx statistics enabled by default.</p> </div> </div> <div class="sect3"> <h4 id="_command_clarifications"><a class="anchor" href="#_command_clarifications"></a>1.6.4. Command Clarifications</h4> <div class="sect4"> <h5 id="_flush_all"><a class="anchor" href="#_flush_all"></a>Flush All</h5> <div class="paragraph"> <p>Even in a clustered environment, flush_all command leads to the clearing of the Infinispan Memcached server where the call lands. There&#8217;s no attempt to propagate this flush to other nodes in the cluster. This is done so that flush_all with delay use case can be reproduced with the Infinispan Memcached server. The aim of passing a delay to flush_all is so that different Memcached servers in a full can be flushed at different times, and hence avoid overloading the database with requests as a result of all Memcached servers being empty. For more info, check the <a href="http://github.com/memcached/memcached/blob/master/doc/protocol.txt">Memcached text protocol section on flush_all</a> .</p> </div> </div> </div> <div class="sect3"> <h4 id="_unsupported_features"><a class="anchor" href="#_unsupported_features"></a>1.6.5. Unsupported Features</h4> <div class="paragraph"> <p>This section explains those parts of the memcached text protocol that for one reason or the other, are not currently supported by the Infinispan based memcached implementation.</p> </div> <div class="sect4"> <h5 id="_individual_stats"><a class="anchor" href="#_individual_stats"></a>Individual Stats</h5> <div class="paragraph"> <p>Due to difference in nature between the original memcached implementation which is C/C++ based and the Infinispan implementation which is Java based, there&#8217;re some general purpose stats that are not supported. For these unsupported stats, Infinispan memcached server always returns 0.</p> </div> <div class="ulist"> <div class="title">Unsupported statistics</div> <ul> <li> <p>pid</p> </li> <li> <p>pointer_size</p> </li> <li> <p>rusage_user</p> </li> <li> <p>rusage_system</p> </li> <li> <p>bytes</p> </li> <li> <p>curr_connections</p> </li> <li> <p>total_connections</p> </li> <li> <p>connection_structures</p> </li> <li> <p>auth_cmds</p> </li> <li> <p>auth_errors</p> </li> <li> <p>limit_maxbytes</p> </li> <li> <p>threads</p> </li> <li> <p>conn_yields</p> </li> <li> <p>reclaimed</p> </li> </ul> </div> </div> <div class="sect4"> <h5 id="_statistic_settings"><a class="anchor" href="#_statistic_settings"></a>Statistic Settings</h5> <div class="paragraph"> <p>The settings statistics section of the text protocol has not been implemented due to its volatility.</p> </div> </div> <div class="sect4"> <h5 id="_settings_with_arguments_parameter"><a class="anchor" href="#_settings_with_arguments_parameter"></a>Settings with Arguments Parameter</h5> <div class="paragraph"> <p>Since the arguments that can be send to the Memcached server are not documented, Infinispan Memcached server does not support passing any arguments to stats command. If any parameters are passed, the Infinispan Memcached server will respond with a CLIENT_ERROR .</p> </div> </div> <div class="sect4"> <h5 id="_delete_hold_time_parameter"><a class="anchor" href="#_delete_hold_time_parameter"></a>Delete Hold Time Parameter</h5> <div class="paragraph"> <p>Memcached does no longer honor the optional hold time parameter to delete command and so the Infinispan based memcached server does not implement such feature either.</p> </div> </div> <div class="sect4"> <h5 id="_verbosity_command"><a class="anchor" href="#_verbosity_command"></a>Verbosity Command</h5> <div class="paragraph"> <p>Verbosity command is not supported since Infinispan logging cannot be simplified to defining the logging level alone.</p> </div> </div> </div> <div class="sect3"> <h4 id="_talking_to_infinispan_memcached_servers_from_non_java_clients"><a class="anchor" href="#_talking_to_infinispan_memcached_servers_from_non_java_clients"></a>1.6.6. Talking To Infinispan Memcached Servers From Non-Java Clients</h4> <div class="paragraph"> <p>This section shows how to talk to Infinispan memcached server via non-java client, such as a python script.</p> </div> <div class="sect4"> <h5 id="_multi_clustered_server_tutorial"><a class="anchor" href="#_multi_clustered_server_tutorial"></a>Multi Clustered Server Tutorial</h5> <div class="paragraph"> <p>The example showcases the distribution capabilities of Infinispan memcached severs that are not available in the original memcached implementation.</p> </div> <div class="ulist"> <ul> <li> <p>Start first Infinispan memcached server giving to it a port number and an Infinispan configuration supporting distribution. This configuration is the same one used for the GUI demo:</p> <div class="literalblock"> <div class="content"> <pre>$ ./bin/startServer.sh -r memcached -c etc/config-samples/gui-demo-cache-config.xml -p 12211</pre> </div> </div> </li> <li> <p>Start a second Infinispan memcached server passing to it a different port number:</p> </li> </ul> </div> <div class="paragraph"> <p>$ ./bin/startServer.sh -r memcached -c etc/config-samples/gui-demo-cache-config.xml -p 13211</p> </div> <div class="ulist"> <ul> <li> <p>Execute <a href="http://anonsvn.jboss.org/repos/infinispan/branches/4.1.x/server/memcached/src/test/resources/test_memcached_read.py">test_memcached_write.py</a> script which basically executes several write operations against the Infinispan memcached server bound to port 12211. If the script is executed successfully, you should see an output similar to this:</p> <div class="literalblock"> <div class="content"> <pre>Connecting to 127.0.0.1:12211
Testing set ['Simple_Key': Simple value] ... OK
Testing set ['Expiring_Key' : 999 : 3] ... OK
Testing increment 3 times ['Incr_Key' : starting at 1 ]
Initialise at 1 ... OK
Increment by one ... OK
Increment again ... OK
Increment yet again ... OK
Testing decrement 1 time ['Decr_Key' : starting at 4 ]
Initialise at 4 ... OK
Decrement by one ... OK
Testing decrement 2 times in one call ['Multi_Decr_Key' : 3 ]
Initialise at 3 ... OK
Decrement by 2 ... OK</pre> </div> </div> </li> <li> <p>Execute <a href="http://anonsvn.jboss.org/repos/infinispan/branches/4.1.x/server/memcached/src/test/resources/test_memcached_read.py">test_memcached_read.py</a> script which connects to server bound to 127.0.0.1:13211 and verifies that it can read the data that was written by the writer script to the first server. If the script is executed successfully, you should see an output similar to this:</p> <div class="literalblock"> <div class="content"> <pre>Connecting to 127.0.0.1:13211
Testing get ['Simple_Key'] should return Simple value ... OK
Testing get ['Expiring_Key'] should return nothing... OK
Testing get ['Incr_Key'] should return 4 ... OK
Testing get ['Decr_Key'] should return 3 ... OK
Testing get ['Multi_Decr_Key'] should return 1 ... OK</pre> </div> </div> </li> </ul> </div> </div> </div> </div> <div class="sect2"> <h3 id="_infinispan_websocket_server"><a class="anchor" href="#_infinispan_websocket_server"></a>1.7. Infinispan WebSocket Server</h3> <div class="paragraph"> <p>The Infinispan WebSocket Server can be used to expose an Infinispan Cache instance over a <a href="http://dev.w3.org/html5/websockets/">WebSocket Interface</a> via a very simple Javascript "Cache" API. The WebSocket Interface was introduced as part of the HTML 5 specification.  It defines a full-duplex communication channel to the browser, operating over a single socket (unlike Comet or Ajax) and is exposed to the browser via a Javascript interface.</p> </div> <div class="admonitionblock warning"> <table> <tr> <td class="icon"> <i class="icon-warning" title="Warning"></i> </td> <td class="content"> This is a highly experimental module. </td> </tr> </table> </div> <div class="sect3"> <h4 id="_starting_the_server"><a class="anchor" href="#_starting_the_server"></a>1.7.1. Starting The Server</h4> <div class="paragraph"> <p>The Infinispan WebSocket server is included in Infinispan distributions, in both the -bin.zip and -all.zip archives.  To start the server, use the bin/startServer.sh (or bin\startServer.bat) command-line scripts, using the -r websocket switch.</p> </div> <div class="literalblock"> <div class="content"> <pre>$ bin/startServer.sh -r websocket</pre> </div> </div> <div class="paragraph"> <p>For more help on available switches, check out the <a href="#_server_command_line_options">server command line options</a>.</p> </div> </div> <div class="sect3"> <h4 id="_javascript_api"><a class="anchor" href="#_javascript_api"></a>1.7.2. Javascript API</h4> <div class="paragraph"> <p>Writing a web page that uses the Infinispan Cache API is trivial.  The page simply needs to include a <code>&lt;script /&gt;</code> declaration for the infinispan-ws.js Javascript source file.  This script is served up by WebSocket Server.</p> </div> <div class="paragraph"> <p>So, for loading infinispan-ws.js from a WebSocket Server instance running on <em>www.acme.com:8181</em> (default port):</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/javascript</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">src</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;a href=</span><span class="delimiter">&quot;</span></span><span class="attribute-name">http:</span><span class="error">/</span><span class="error">/</span><span class="attribute-name">www.acme.com:61999</span><span class="error">/</span><span class="attribute-name">infinispan-ws.js</span><span class="error">&quot;</span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">_blank</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>http://www.acme.com:8181/infinispan-ws.js<span class="tag">&lt;/a&gt;</span>&quot; /<span class="error">&gt;</span></code></pre> </div> </div> <div class="sect4"> <h5 id="_creating_a_client_side_cache_object_instance"><a class="anchor" href="#_creating_a_client_side_cache_object_instance"></a>Creating a Client-Side Cache Object Instance</h5> <div class="paragraph"> <p>The client-side interface to a server-side Infinispan cache is the Cache Javascript object.  It can be constructed as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="javascript language-javascript"><span class="tag">&lt;script</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text/javascript</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="inline"><span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="keyword">var</span> cache = <span class="keyword">new</span> Cache();
<span class="error"> </span><span class="error"> </span><span class="error"> </span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="comment">// etc...</span></span>
<span class="tag">&lt;/script&gt;</span></code></pre> </div> </div> <div class="paragraph"> <p>By default, the Cache instance will interface to the default Infinispan Cache associated with the WebSocket Server from which the infinispan-ws.js Javascript source file was loaded.  So, in the above case, the Cache object instance will connect to the WebSocket Server running on <em>www.acme.com:8181</em> (i.e. <em>ws://www.acme.com:8181</em> ).</p> </div> <div class="paragraph"> <p>The Infinispan Cache name and WebSocket Server address can be specified in the <em>Cache</em> object constructor as follows:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="javascript language-javascript"><span class="keyword">var</span> cache = <span class="keyword">new</span> Cache(<span class="string"><span class="delimiter">&quot;</span><span class="content">omCache</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ws://ws.acmews.com:8181</span><span class="delimiter">&quot;</span></span>);
<span class="comment">// etc...</span></code></pre> </div> </div> </div> <div class="sect4"> <h5 id="_cache_operations"><a class="anchor" href="#_cache_operations"></a>Cache Operations</h5> <div class="paragraph"> <p>A number of cache operations can be performed via the Cache object instance such as <em>get</em> , <em>put</em> , <em>remove</em> , <em>notify</em> and <em>unnotify</em> .</p> </div> <div class="paragraph"> <p>The get and notify operations require a callback function to be registered with the Cache object instance.  This callback function receives all add/update/remove notifications on any cache entries for which the notify function was invoked.  It also asynchronously receives the result of a single invocation of the get function i.e. get can be thought of as "notify once, immediately".</p> </div> <div class="paragraph"> <p>The callback function is registered with the Cache object instance via the registerCallback function.  The function should have 2 parameters - key and value , relating to the cache key and value.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="javascript language-javascript"><span class="keyword">var</span> cache = <span class="keyword">new</span> Cache();

<span class="comment">// Ask to be notified about some cache entries...</span>
cache.notify(<span class="string"><span class="delimiter">&quot;</span><span class="content">orderStatus</span><span class="delimiter">&quot;</span></span>);
cache.notify(<span class="string"><span class="delimiter">&quot;</span><span class="content">expectedDeliveryTime</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// Register the callback function for receiving notifcations...</span>
cache.registerCallback(cacheCallback);

<span class="comment">// Cache callback function...</span>
<span class="keyword">function</span> <span class="function">cacheCallback</span>(key, value) {
<span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="comment">// Handle notification...</span>
}
</code></pre> </div> </div> <div class="paragraph"> <p>Getting and updating data in the cache is done by simply calling the get , put and remove functions on the Cache object instance.  These operations could be triggered by user interaction with a web form e.g.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="html language-html"><span class="tag">&lt;form</span> <span class="attribute-name">onsubmit</span>=<span class="string"><span class="delimiter">&quot;</span><span class="keyword">return</span> <span class="predefined-constant">false</span>;<span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

    <span class="comment">&lt;!-- Other form components... --&gt;</span>

    <span class="comment">&lt;!-- Buttons for making cache updates... --&gt;</span>
    <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">button</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Put</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>cache.put(<span class="local-variable">this</span>.form.key.value, <span class="local-variable">this</span>.form.val.value)<span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">button</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Get</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>cache.get(<span class="local-variable">this</span>.form.key.value)<span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">button</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Remove</span><span class="delimiter">&quot;</span></span>
<span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span><span class="error"> </span> <span class="attribute-name">onclick</span>=<span class="string"><span class="delimiter">&quot;</span>cache.remove(<span class="local-variable">this</span>.form.key.value)<span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/form&gt;</span>
</code></pre> </div> </div> </div> </div> <div class="sect3"> <h4 id="_sample_code"><a class="anchor" href="#_sample_code"></a>1.7.3. Sample code</h4> <div class="paragraph"> <p>Infinispan&#8217;s source tree contains a sample HTML document that makes use of the WebSocket server.  Browse through the source of this HTML document <a href="http://fisheye.jboss.org/browse/Infinispan/trunk/server/websocket/src/main/distribution/sample-websocket-client.html">here</a> .</p> </div> </div> <div class="sect3"> <h4 id="_browser_support"><a class="anchor" href="#_browser_support"></a>1.7.4. Browser Support</h4> <div class="paragraph"> <p>At the time of writing, Google Chrome was the only browser with native WebSocket support.  However, the <a href="http://jwebsocket.org/">jWebSocket</a> project provides a client side Javascript library that adds WebSocket support to any Flash enabled browser.</p> </div> </div> <div class="sect3"> <h4 id="_screencast"><a class="anchor" href="#_screencast"></a>1.7.5. Screencast</h4> <div class="paragraph"> <p>See the following <a href="http://www.screencast.com/t/ZGEzNDJlY">demo of the Infinispan WebSocket Server</a> in action.</p> </div> </div> <div class="sect3"> <h4 id="_status"><a class="anchor" href="#_status"></a>1.7.6. Status</h4> <div class="paragraph"> <p>Prototype/Alpha.</p> </div> </div> <div class="sect3"> <h4 id="_source"><a class="anchor" href="#_source"></a>1.7.7. Source</h4> <div class="paragraph"> <p><a href="https://github.com/infinispan/infinispan/tree/master/server/websocket">Browse Infinispan&#8217;s Git repository</a> .</p> </div> </div> </div> <div class="sect2"> <h3 id="sid-68355061"><a class="anchor" href="#sid-68355061"></a>1.8. Portable Serialization with Apache Avro</h3> <div class="paragraph"> <p>Hot Rod clients can be configured with a marshaller that produces platform independent payloads using <a href="http://avro.apache.org/">Apache Avro</a> . This means that payloads generated by a Java, Avro-based, marshaller could be read by a Python, Avro-based, marshaller. When Hot Rod clients in other languages such as Python or Ruby become available, this will mean that for example, data stored via Java Hot Rod client will be readable by a Python Hot Rod client.</p> </div> <div class="sect3"> <h4 id="_languages_supported"><a class="anchor" href="#_languages_supported"></a>1.8.1. Languages Supported</h4> <div class="paragraph"> <p>Avro currently supports providing portable serialization payloads for the following languages:</p> </div> <div class="ulist"> <ul> <li> <p>C</p> </li> <li> <p>C++</p> </li> <li> <p>Java</p> </li> <li> <p>Python</p> </li> <li> <p>Ruby</p> </li> </ul> </div> <div class="paragraph"> <p>So interoperability of payloads is limited to these languages. The choice of Avro over other existing portable serialization libraries (i.e. Google Protocol Buffers, Apache Thrift, MessagePack&#8230;etc) was done based languages supported, ease of use, and payload size.</p> </div> </div> <div class="sect3"> <h4 id="_object_types_supported"><a class="anchor" href="#_object_types_supported"></a>1.8.2. Object Types Supported</h4> <div class="paragraph"> <p>Avro based marshaller currently supports basic type and collection marshalling:</p> </div> <div class="ulist"> <ul> <li> <p>Basic types include:</p> </li> <li> <p>UTF-8 string</p> </li> <li> <p>Integer</p> </li> <li> <p>Long</p> </li> <li> <p>Float</p> </li> <li> <p>Double</p> </li> <li> <p>Boolean</p> </li> <li> <p>Byte Array</p> </li> <li> <p>Collections composed of the basic types</p> <div class="ulist"> <ul> <li> <p>Arrays</p> </li> <li> <p>Lists</p> </li> <li> <p>Maps</p> </li> <li> <p>Sets</p> </li> </ul> </div> </li> </ul> </div> <div class="paragraph"> <p>Marshalling of complex objects is not supported because it&#8217;s not fully solvable as some language don&#8217;t support some concepts other languages offer. Instead, it is recommended that for any complex object marshalling requirements, users serialize these complex objects into byte arrays using portable serialization libraries such as <a href="http://code.google.com/apis/protocolbuffers/">Google Protocol Buffers</a> , <a href="http://incubator.apache.org/thrift/">Apache Thrift</a> , <a href="http://msgpack.org/">MessagePack</a> , or <a href="http://avro.apache.org/">Apache Avro</a> . Once the byte array has been created, simply pass it to the Hot Rod client API which will handle it accordingly.</p> </div> <div class="paragraph"> <p>Therefore, it&#8217;s clear that users are free to use any portable serialization library to transform their complex objects into byte arrays, regardless of the fact that Infinispan uses Apache Avro for basic type and collection marshalling. The only limitation here is that the target language used to serialize complex objects needs to be amongst the languages that Apache Avro supports.</p> </div> <div class="paragraph"> <p>Short and Byte Java primitive types are not supported per se. Instead, clients should pass integers which will be encoded efficiently using <a href="http://lucene.apache.org/java/2_4_0/fileformats.html#VInt">variable-length</a> <a href="http://code.google.com/apis/protocolbuffers/docs/encoding.html#types">zig zag</a> coding. Primitive arrays not supported except byte arrays. Instead, use their object counter partners, i.e. Integer&#8230;etc.</p> </div> <div class="sect4"> <h5 id="_java_configuration"><a class="anchor" href="#_java_configuration"></a>Java Configuration</h5> <div class="paragraph"> <p>To configure a Java Hot Rod client with Avro marshaller, simply pass a infinispan.client.hotrod.marshaller property to the RemoteCacheManager constructor containing the value of org.infinispan.client.hotrod.marshall.ApacheAvroMarshaller. For example:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
props.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">infinispan.client.hotrod.marshaller</span><span class="delimiter">&quot;</span></span>,
<span class="error"> </span><span class="error"> </span> <span class="string"><span class="delimiter">&quot;</span><span class="content">org.infinispan.client.hotrod.marshall.ApacheAvroMarshaller</span><span class="delimiter">&quot;</span></span>);
RemoteCacheManager remoteCacheManager = <span class="keyword">new</span> RemoteCacheManager(props);
</code></pre> </div> </div> <div class="paragraph"> <p>Note however that if all you&#8217;re going to be using are Java Hot Rod clients, there&#8217;s no need to configure Avro based marshaller. The default marshaller is capable of transforming any Serializable or Externalizable java object into a byte array in a quick and efficient manner.</p> </div> <div class="paragraph"> <p>Please remember as well that when remote java clients are configured with the Apache Avro marshaller, the server&#8217;s marshaller does not need changing. This is because the server does not make any attempt at unmarshalling the data that&#8217;s been passed to it. Internally, it keeps the data as byte arrays.</p> </div> </div> </div> </div> <div class="sect2"> <h3 id="sid-68355066"><a class="anchor" href="#sid-68355066"></a>1.9. Load Testing Infinispan Server Modules</h3> <div class="paragraph"> <p>This section details how to load test and benchmark these server implementations using <a href="http://grinder.sourceforge.net/">Grinder</a>, which is a Java load testing framework that makes it easy to run a distributed test using many load injector machines.</p> </div> <div class="olist arabic"> <ol class="arabic"> <li> <p>First of all, <a href="http://grinder.sourceforge.net/download.html">download Grinder version 3.4 or higher</a> and unzip it somewhere locally.</p> </li> <li> <p>Next, <a href="http://www.jboss.org/infinispan/downloads.html">download</a> and unzip the Infinispan version that you want to be testing. Make sure you download the -all.zip distribution to run these tests. Note that although Infinispan REST server was included in 4.0, Memcached and Hot Rod servers are only included from 4.1 onwards.</p> </li> <li> <p>Download Infinispan Grinder scripts and other material from <a href="http://github.com/galderz/infinispan-server-grinder/archives/master">this source repository</a> .</p> </li> <li> <p>Next up, modify bin/setGrinderEnv.sh file to set correct environment paths. Primarily, you should be looking at setting the following properties correctly (The rest of properties not mentioned below can be left as they are) :</p> <div class="olist loweralpha"> <ol class="loweralpha" type="a"> <li> <p>INFINISPAN_HOME : It should point to the location where Infinispan was unzipped.</p> </li> <li> <p>GRINDER_HOME : It should point to where Grinder was unzipped.</p> </li> <li> <p>GRINDER_PROPERTIES : It should point to the grinder.properties provided with the Infinispan Grinder scripts</p> </li> <li> <p>SPYMEMCACHED_HOME : It should only be modified to point to Spymemcached Memcached client library if you&#8217;re planning to load test Infinispan Memcached server.</p> </li> </ol> </div> </li> <li> <p>It is time now to start the Infinispan server that you want to be testing. If you want to start the Hot Rod server quickly, the following command should do the job:</p> <div class="olist loweralpha"> <ol class="loweralpha" type="a"> <li> <p>$INFINISPAN_HOME/bin/startServer.sh -r hotrod -l 0.0.0.0</p> </li> </ol> </div> </li> <li> <p>Finally, let&#8217;s start the load test. Currently, a single load test exists which after a warmup phase, it does a certain amount of put/get calls on a pool of keys with a configurable distribution. By default, it executes 20% put operations and 80% get operations. So, if you&#8217;re going to start the Hot Rod test, you&#8217;d simply do:</p> <div class="olist loweralpha"> <ol class="loweralpha" type="a"> <li> <p>cd infinispan-server-grinder/</p> </li> <li> <p>./bin/startHotRodAgent.sh</p> </li> </ol> </div> </li> <li> <p>Once the test has finished, the output can be located in infinispan-server-grinder/log/out-${host}-0.log and will show something like this at the bottom:</p> </li> </ol> </div> <div class="listingblock"> <div class="content"> <pre>         Tests    Errors   Mean Test   Test Time   TPS        
                           Time (ms)   Standard                
                                       Deviation               
                                       (ms)                    

Test 1   25       0        13742.56    457.22      0.29      "Warmup (1000 ops)"
Test 2   400136   0        1.92        2.55        4687.08   "Read (20000 ops per thread)"
Test 3   99864    0        2.41        4.97        1169.78   "Put (20000 ops per thread)"

Totals   500025   0        2.70        97.26       1952.38 
</pre> </div> </div> <div class="paragraph"> <p>The output is saying that it first run 25 threads, each sending 1000 operations in order to warm up the cache. Afterwards, each of these 25 threads send 20.000 operations making a total of 500.000 operations, out of which 400136 were get calls and 99864 were put calls, and the test here indicates what was the mean test time for each of these operations, including standard deviation and how many operations per second (TPS) were executed. In this case, 4686 get operations per second and 1169 put operations per second.</p> </div> </div> <div class="sect2"> <h3 id="_server_command_line_options"><a class="anchor" href="#_server_command_line_options"></a>1.10. Server Command Line Options</h3> <div class="paragraph"> <p>Please find below the set of common command line parameters that can be passed to the startServer.sh and startServer.bat scripts.</p> </div> <div class="listingblock"> <div class="content"> <pre>$ ./bin/startServer.sh -h
usage: startServer [options]

options:
  -h, --help                        
        Show this help message

  -V, --version
        Show version information

  --                 
        Stop processing options

  -p, --port=&lt;num&gt;                  
        TCP port number to listen on
        (default: 11211 for Memcached, 11222 for Hot Rod
        and 8181 for WebSocket server)

  -l, --host=&lt;host or ip&gt;
        Interface to listen on
        (default: 127.0.0.1, localhost)

  -m, --master_threads=&lt;num&gt;
        Number of threads accepting incoming connections
        (default: unlimited while resources are available)

  -t, --work_threads=&lt;num&gt;
        Number of threads processing incoming requests and sending responses
        (default: unlimited while resources are available)

  -c, --cache_config=&lt;filename&gt;
        Cache configuration file
        (default: creates cache with default values)

  -r, --protocol=[memcached|hotrod|websocket]
        Protocol to understand by the server.
        This is a mandatory option and you should choose one of these options         

  -i, --idle_timeout=&lt;num&gt;
        Idle read timeout, in seconds, used to detect stale connections
        (default: -1)
        If no new messages have been read within this time,
        the server disconnects the channel.
        Passing -1 disables idle timeout.

  -n, --tcp_no_delay=[true|false]
        TCP no delay flag switch (default: true)

  -s, --send_buf_size=&lt;num&gt;
        Send buffer size (default: as defined by the OS).

  -e, --recv_buf_size=&lt;num&gt;
        Receive buffer size (default: as defined by the OS).

  -o, --proxy_host=&lt;host or ip&gt;
        Host address to expose in topology information sent to clients.
        If not present, it defaults to configured host.
        Servers that do not transmit topology information ignore this setting.

  -x, --proxy_port=&lt;num&gt;
        Port to expose in topology information sent to clients.
        If not present, it defaults to configured port.
        Servers that do not transmit topology information ignore this setting.

  -k, --topo_lock_timeout=&lt;num&gt;
        Controls lock timeout (in milliseconds) for those servers that maintain
        the topology information in an internal cache.

  -u, --topo_repl_timeout=&lt;num&gt;
        Sets the maximum replication time (in milliseconds) for transfer of
        topology information between servers.
        If state transfer is enabled, this setting also controls the topology
        cache state transfer timeout.
        If state transfer is disabled, it controls the amount of time to wait
        for this topology data to be lazily loaded from a different node when
        not present locally.

  -a, --topo_state_trasfer=[true|false]
        Enabling topology information state transfer means that when a server
        starts it retrieves this information from a different node.
        Otherwise, if set to false, the topology information is lazily loaded
        if not available locally.

  -D&lt;name&gt;[=&lt;value&gt;]
        Set a system property

</pre> </div> </div> </div> </div> </div> </div> <div id="footer"> <div id="footer-text"> Last updated 2014-07-11 13:12:30 UTC </div> </div> </body> </html>