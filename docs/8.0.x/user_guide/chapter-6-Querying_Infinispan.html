<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="generator" content="Asciidoctor 0.1.4"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>Querying Infinispan</title> <style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }
audio, canvas, video { display: inline-block; }
audio:not([controls]) { display: none; height: 0; }
[hidden] { display: none; }
html { background: #fff; color: #000; font-family: sans-serif; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; }
body { margin: 0; }
a:focus { outline: thin dotted; }
a:active, a:hover { outline: 0; }
h1 { font-size: 2em; margin: 0.67em 0; }
abbr[title] { border-bottom: 1px dotted; }
b, strong { font-weight: bold; }
dfn { font-style: italic; }
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }
mark { background: #ff0; color: #000; }
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }
pre { white-space: pre-wrap; }
q { quotes: "\201C" "\201D" "\2018" "\2019"; }
small { font-size: 80%; }
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }
img { border: 0; }
svg:not(:root) { overflow: hidden; }
figure { margin: 0; }
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }
legend { border: 0; padding: 0; }
button, input, select, textarea { font-family: inherit; font-size: 100%; margin: 0; }
button, input { line-height: normal; }
button, select { text-transform: none; }
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; cursor: pointer; }
button[disabled], html input[disabled] { cursor: default; }
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; padding: 0; }
input[type="search"] { -webkit-appearance: textfield; -moz-box-sizing: content-box; -webkit-box-sizing: content-box; box-sizing: content-box; }
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }
textarea { overflow: auto; vertical-align: top; }
table { border-collapse: collapse; border-spacing: 0; }
*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
html, body { font-size: 100%; }
body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }
a:hover { cursor: pointer; }
a:focus { outline: none; }
img, object, embed { max-width: 100%; height: auto; }
object, embed { height: 100%; }
img { -ms-interpolation-mode: bicubic; }
#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }
.left { float: left !important; }
.right { float: right !important; }
.text-left { text-align: left !important; }
.text-right { text-align: right !important; }
.text-center { text-align: center !important; }
.text-justify { text-align: justify !important; }
.hide { display: none; }
.antialiased, body { -webkit-font-smoothing: antialiased; }
img { display: inline-block; vertical-align: middle; }
textarea { height: auto; min-height: 50px; }
select { width: 100%; }
p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }
.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #7a2518; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }
a { color: #005498; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #00467f; }
a img { border: none; }
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Georgia, "URW Bookman L", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }
h1 { font-size: 2.125em; }
h2 { font-size: 1.6875em; }
h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }
h4 { font-size: 1.125em; }
h5 { font-size: 1.125em; }
h6 { font-size: 1em; }
hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }
em, i { font-style: italic; line-height: inherit; }
strong, b { font-weight: bold; line-height: inherit; }
small { font-size: 60%; line-height: inherit; }
code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; color: #6d180b; }
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }
ul, ol { margin-left: 1.5em; }
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }
abbr { text-transform: none; }
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: inherit; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }
blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }
.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }
@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
.print-only { display: none !important; }
@media print { * { background: transparent !important; color: #000 !important; box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }
.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }
*:not(pre) > code { font-size: 0.9375em; padding: 1px 3px 0; white-space: nowrap; background-color: #f2f2f2; border: 1px solid #cccccc; -webkit-border-radius: 4px; border-radius: 4px; text-shadow: none; }
pre, pre > code { line-height: 1.4; color: inherit; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }
kbd.keyseq { color: #555555; }
kbd:not(.keyseq) { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }
kbd kbd:first-child { margin-left: 0; }
kbd kbd:last-child { margin-right: 0; }
.menuseq, .menu { color: #090909; }
p a > code:hover { color: #561309; }
#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }
#header { margin-bottom: 2.5em; }
#header > h1 { color: black; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #6f6f6f; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }
#toc { border-bottom: 3px double #ebebeb; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }
#toctitle { color: #7a2518; }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; }
  #toc.toc2 { position: fixed; width: 20em; left: 0; top: 0; border-right: 1px solid #ebebeb; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; }
  #toc.toc2 > ul { font-size: .95em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1.25em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #ebebeb; left: auto; right: 0; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; border-width: 0; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }
#content #toctitle { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-size: 1em; padding-left: 0.125em; }
#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }
#footer-text { color: #dddddd; line-height: 1.44; }
.sect1 { padding-bottom: 1.25em; }
.sect1 + .sect1 { border-top: 3px double #ebebeb; }
#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }
.imageblock, .literalblock, .listingblock, .verseblock, .videoblock { margin-bottom: 1.25em; }
.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }
.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }
table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }
.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #6f6f6f; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }
.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }
.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }
.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; line-height: 1.6; }
.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }
.literalblock > .content pre, .listingblock > .content pre { background: none; border-width: 1px 0; border-style: dotted; border-color: #bfbfbf; -webkit-border-radius: 4px; border-radius: 4px; padding: 0.75em 0.75em 0.5em 0.75em; word-wrap: break-word; }
.literalblock > .content pre.nowrap, .listingblock > .content pre.nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock > .content pre > code, .listingblock > .content pre > code { display: block; }
@media only screen { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.8em; } }
@media only screen and (min-width: 768px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.9em; } }
@media only screen and (min-width: 1280px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 1em; } }
.listingblock > .content { position: relative; }
.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }
.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }
.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }
.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }
table.pyhltable { border: 0; margin-bottom: 0; }
table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }
table.pyhltable td.code { padding-left: .75em; padding-right: 0; }
.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }
.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }
table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }
.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: inherit; color: #555555; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }
table thead th, table tfoot th { font-weight: bold; }
table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 4px; border-radius: 4px; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }
table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }
table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }
table.tableblock td .paragraph:last-child p, table.tableblock td > p:last-child { margin-bottom: 0; }
th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }
th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }
th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }
th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }
th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }
th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }
p.tableblock.header { color: #222222; font-weight: bold; }
td > div.verse { white-space: pre; }
ol { margin-left: 1.75em; }
ul li ol { margin-left: 1.5em; }
dl dd { margin-left: 1.125em; }
dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }
ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }
ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }
ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }
ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }
ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }
ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }
.unstyled dl dt { font-weight: normal; font-style: normal; }
ol.arabic { list-style-type: decimal; }
ol.decimal { list-style-type: decimal-leading-zero; }
ol.loweralpha { list-style-type: lower-alpha; }
ol.upperalpha { list-style-type: upper-alpha; }
ol.lowerroman { list-style-type: lower-roman; }
ol.upperroman { list-style-type: upper-roman; }
ol.lowergreek { list-style-type: lower-greek; }
.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }
td.hdlist1 { padding-right: .8em; font-weight: bold; }
td.hdlist1, td.hdlist2 { vertical-align: top; }
.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }
.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }
.qanda > ol > li > p > em:only-child { color: #00467f; }
.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }
.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }
.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }
a.image { text-decoration: none; }
span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }
.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }
div.unbreakable { page-break-inside: avoid; }
.big { font-size: larger; }
.small { font-size: smaller; }
.underline { text-decoration: underline; }
.overline { text-decoration: overline; }
.line-through { text-decoration: line-through; }
.aqua { color: #00bfbf; }
.aqua-background { background-color: #00fafa; }
.black { color: black; }
.black-background { background-color: black; }
.blue { color: #0000bf; }
.blue-background { background-color: #0000fa; }
.fuchsia { color: #bf00bf; }
.fuchsia-background { background-color: #fa00fa; }
.gray { color: #606060; }
.gray-background { background-color: #7d7d7d; }
.green { color: #006000; }
.green-background { background-color: #007d00; }
.lime { color: #00bf00; }
.lime-background { background-color: #00fa00; }
.maroon { color: #600000; }
.maroon-background { background-color: #7d0000; }
.navy { color: #000060; }
.navy-background { background-color: #00007d; }
.olive { color: #606000; }
.olive-background { background-color: #7d7d00; }
.purple { color: #600060; }
.purple-background { background-color: #7d007d; }
.red { color: #bf0000; }
.red-background { background-color: #fa0000; }
.silver { color: #909090; }
.silver-background { background-color: #bcbcbc; }
.teal { color: #006060; }
.teal-background { background-color: #007d7d; }
.white { color: #bfbfbf; }
.white-background { background-color: #fafafa; }
.yellow { color: #bfbf00; }
.yellow-background { background-color: #fafa00; }
span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }
.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #005498; color: #003f72; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }
.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }
.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 0; border-radius: 0; }

</style> <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css"> <style>
/* Foundation stylesheet for CodeRay (to match GitHub theme) | MIT License | http://foundation.zurb.com */
table.CodeRay { border-collapse: collapse; padding: 2px; margin-bottom: 0; border: 0; background: transparent; }
table.CodeRay td { padding: 0 .5em; vertical-align: top; }
table.CodeRay td.line-numbers { text-align: right; color: #999; border-right: 1px solid #e5e5e5; padding-left: 0; }
span.line-numbers { border-right: 1px solid #E5E5E5; color: #999; display: inline-block; margin-right: 0.5em; padding-right: 0.5em; }
.CodeRay td.line-numbers strong, .CodeRay span.line-numbers strong { font-weight: normal; }
.CodeRay .debug { color: white !important; background: blue !important; }
.CodeRay .annotation { color: #007; }
.CodeRay .attribute-name { color: #f08; }
.CodeRay .attribute-value { color: #700; }
.CodeRay .binary { color: #509; }
.CodeRay .comment  { color: #999; font-style: italic; }
.CodeRay .char { color: #04D; }
.CodeRay .char .content { color: #04D; }
.CodeRay .char .delimiter { color: #039; }
.CodeRay .class { color: #458; }
.CodeRay .complex { color: #A08; }
.CodeRay .constant { color: teal; }
.CodeRay .color { color: #0A0; }
.CodeRay .class-variable { color: #369; }
.CodeRay .decorator { color: #B0B; }
.CodeRay .definition { color: #099; }
.CodeRay .directive { color: #088; }
.CodeRay .delimiter { color: black; }
.CodeRay .doc { color: #970; }
.CodeRay .doctype { color: #34b; }
.CodeRay .doc-string { color: #D42; }
.CodeRay .escape  { color: #666; }
.CodeRay .entity { color: #800; }
.CodeRay .error { color: #808; }
.CodeRay .exception { color: #C00; }
.CodeRay .filename { color: #099; }
.CodeRay .function { color: #900; }
.CodeRay .global-variable { color: teal; }
.CodeRay .hex { color: #058; }
.CodeRay .integer  { color: #099; }
.CodeRay .include { color: #B44; }
.CodeRay .inline { color: black; }
.CodeRay .inline .inline { background: #ccc; }
.CodeRay .inline .inline .inline { background: #bbb; }
.CodeRay .inline .inline-delimiter { color: #D14; }
.CodeRay .inline-delimiter { color: #D14; }
.CodeRay .important { color: #f00; }
.CodeRay .interpreted { color: #B2B; }
.CodeRay .instance-variable { color: teal; }
.CodeRay .label { color: #970; }
.CodeRay .local-variable { color: #963; }
.CodeRay .octal { color: #40E; }
.CodeRay .predefined { color: #369; }
.CodeRay .preprocessor { color: #579; }
.CodeRay .pseudo-class { color: #00C; }
.CodeRay .predefined-type { color: #074; }
.CodeRay .reserved, .keyword  { color: #000; }
.CodeRay .key { color: #808; }
.CodeRay .key .delimiter { color: #606; }
.CodeRay .key .char { color: #80f; }
.CodeRay .value { color: #088; }
.CodeRay .regexp { background-color: #fff0ff; }
.CodeRay .regexp .content { color: #808; }
.CodeRay .regexp .delimiter { color: #404; }
.CodeRay .regexp .modifier { color: #C2C; }
.CodeRay .regexp .function  { color: #404; font-weight: bold; }
.CodeRay .string { color: #D20; }
.CodeRay .string .string { }
.CodeRay .string .string .string { background-color: #ffd0d0; }
.CodeRay .string .content { color: #D14; }
.CodeRay .string .char { color: #D14; }
.CodeRay .string .delimiter { color: #D14; }
.CodeRay .shell { color: #D14; }
.CodeRay .shell .content { }
.CodeRay .shell .delimiter { color: #D14; }
.CodeRay .symbol { color: #990073; }
.CodeRay .symbol .content { color: #A60; }
.CodeRay .symbol .delimiter { color: #630; }
.CodeRay .tag, .CodeRay .attribute-name { color: #070; }
.CodeRay .tag-special { color: #D70; }
.CodeRay .type { color: #339; }
.CodeRay .variable  { color: #036; }
.CodeRay .insert { background: #afa; }
.CodeRay .delete { background: #faa; }
.CodeRay .change { color: #aaf; background: #007; }
.CodeRay .head { color: #f8f; background: #505; }
.CodeRay .insert .insert { color: #080; }
.CodeRay .delete .delete { color: #800; }
.CodeRay .change .change { color: #66f; }
.CodeRay .head .head { color: #f4f; }

</style> </head> <body class="book"> <div id="header"> </div> <div id="content"> <div class="sect1"> <h2 id="_querying_infinispan"><a class="anchor" href="#_querying_infinispan"></a>1. Querying Infinispan</h2> <div class="sectionbody"> <div class="paragraph"> <p>Infinispan supports indexing and searching of Java objects stored in the grid using powerful search APIs which complement its main Map-like API. Historically, searching was first available in Infinispan via <a href="http://lucene.apache.org/">Apache Lucene</a>'s API but since version 6.0 Infinispan provides its own <a href="#_infinispan_s_query_dsl">query API</a> based on a simple and expressive internal DSL. Searching with the new API is available for both embedded and remote clients while the Lucene based API is only available to embedded clients. The remote querying capability is further described in the <a href="#_querying_via_the_java_hot_rod_client">Hot Rod client chapter</a>.</p> </div> <div class="sect2"> <h3 id="_the_infinispan_query_module"><a class="anchor" href="#_the_infinispan_query_module"></a>1.1. The infinispan-query module</h3> <div class="paragraph"> <p>This module adds indexing and querying capabilities to Infinispan. It uses <a href="http://hibernate.org/subprojects/search">Hibernate Search</a> and <a href="http://lucene.apache.org/">Apache Lucene</a> to index and search objects in the cache. It allows users to obtain objects within the cache without needing to know the keys to each object that they want to obtain. You can search your objects based on some of its properties. For example to retrieve all red cars (exact metadata match), or all books about a specific topic (full text search and relevance scoring).</p> </div> <div class="paragraph"> <p>The queries can be expressed as Lucene queries, built directly using the Lucene Query API or built with the help of Hibernate Search Query DSL. Alternatively, you can also use Infinispan&#8217;s own query DSL which most users might find easier to use than the one based on Lucene at the cost of not being able to access some of the powerful capabilities which are specific to the underlying Lucene implementation.</p> </div> <div class="sect3"> <h4 id="_configuration"><a class="anchor" href="#_configuration"></a>1.1.1. Configuration</h4> <div class="paragraph"> <p>Indexing must be enabled in the configuration (as explained in <a href="#sid-68355029">XML Configuration</a> or <a href="#sid-68355029">Programmatic configuration</a> ). This will trigger automatic indexing of objects stored in the cache; there are several different ways to specify how these objects need to be indexed explained in the following paragraphs. To run queries you use the <em>SearchManager</em> which exposes all necessary methods to get started.</p> </div> </div> </div> <div class="sect2"> <h3 id="_simple_example"><a class="anchor" href="#_simple_example"></a>1.2. Simple example</h3> <div class="paragraph"> <p>We&#8217;re going to store <em>Book</em> instances in Infinispan; each <em>Book</em> will be defined as in the following example; we have to choose which properties are indexed, and for each property we can optionally choose advanced indexing options using the annotations defined in the Hibernate Search project.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="comment">// example values stored in the cache and indexed:</span>
<span class="keyword">import</span> <span class="include">org.hibernate.search.annotations</span>.*;

<span class="comment">//Values you want to index need to be annotated with @Indexed, then you pick which fields and how they are to be indexed:</span>
<span class="annotation">@Indexed</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Book</span> {
   <span class="annotation">@Field</span> <span class="predefined-type">String</span> title;
   <span class="annotation">@Field</span> <span class="predefined-type">String</span> description;
   <span class="annotation">@Field</span> <span class="annotation">@DateBridge</span>(resolution=Resolution.YEAR) <span class="predefined-type">Date</span> publicationYear;
   <span class="annotation">@IndexedEmbedded</span> <span class="predefined-type">Set</span>&lt;Author&gt; authors = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;Author&gt;();
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">Author</span> {
   <span class="annotation">@Field</span> <span class="predefined-type">String</span> name;
   <span class="annotation">@Field</span> <span class="predefined-type">String</span> surname;
   <span class="comment">// hashCode() and equals() omitted</span>
}
</code></pre> </div> </div> <div class="paragraph"> <p>Now assuming we stored several <em>Book</em> instances in our Infinispan <em>Cache</em> , we can search them for any matching field as in the following example.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="comment">// get the search manager from the cache:</span>
SearchManager searchManager = org.infinispan.query.Search.getSearchManager(cache);

<span class="comment">// create any standard Lucene query, via Lucene's QueryParser or any other means:</span>
org.apache.lucene.search.Query fullTextQuery = <span class="comment">//any Apache Lucene Query</span>

<span class="comment">// convert the Lucene query to a CacheQuery:</span>
CacheQuery cacheQuery = searchManager.getQuery( fullTextQuery );

<span class="comment">// get the results:</span>
<span class="predefined-type">List</span>&lt;<span class="predefined-type">Object</span>&gt; found = cacheQuery.list();

</code></pre> </div> </div> <div class="paragraph"> <p>A Lucene Query is often created by parsing a query in text format such as "title:infinispan AND authors.name:sanne", or by using the query builder provided by Hibernate Search.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="comment">// get the search manager from the cache:</span>
SearchManager searchManager = org.infinispan.query.Search.getSearchManager( cache );

<span class="comment">// you could make the queries via Lucene APIs, or use some helpers:</span>
QueryBuilder queryBuilder = searchManager.buildQueryBuilderForClass(<span class="predefined-type">Book</span>.class).get();

<span class="comment">// the queryBuilder has a nice fluent API which guides you through all options.</span>
<span class="comment">// this has some knowledge about your object, for example which Analyzers</span>
<span class="comment">// need to be applied, but the output is a fairly standard Lucene Query.</span>
org.apache.lucene.search.Query luceneQuery = queryBuilder.phrase()
                  .onField(<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>)
                  .andField(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>)
                  .sentence(<span class="string"><span class="delimiter">&quot;</span><span class="content">a book on highly scalable query engines</span><span class="delimiter">&quot;</span></span>)
                  .createQuery();

<span class="comment">// the query API itself accepts any Lucene Query, and on top of that</span>
<span class="comment">// you can restrict the result to selected class types:</span>
CacheQuery query = searchManager.getQuery(luceneQuery, <span class="predefined-type">Book</span>.class);

<span class="comment">// and there are your results!</span>
<span class="predefined-type">List</span> objectList = query.list();

<span class="keyword">for</span> (<span class="predefined-type">Object</span> book : objectList) {
      <span class="predefined-type">System</span>.out.println(book);
}
</code></pre> </div> </div> <div class="paragraph"> <p>A part from <em>list()</em> you have the option for streaming results, or use pagination.</p> </div> <div class="paragraph"> <p>This barely scratches the surface of all what is possible to do: see the <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single">Hibernate Search reference documentation</a> to learn about sorting, numeric fields, declarative filters, caching filters, complex object graph indexing, custom types and the powerful faceting search API.</p> </div> <div class="sect3"> <h4 id="_notable_differences_with_hibernate_search"><a class="anchor" href="#_notable_differences_with_hibernate_search"></a>1.2.1. Notable differences with Hibernate Search</h4> <div class="paragraph"> <p>Using <em>@DocumentId</em> to mark a field as identifier does not apply to Infinispan values; in Infinispan Query the identifier for all <em>@Indexed</em> objects is the key used to store the value. You can still customize how the key is indexed using a combination of <em>@Transformable</em> , <em>@ProvidedId</em> , custom types and custom <em>FieldBridge</em> implementations.</p> </div> </div> <div class="sect3"> <h4 id="_requirements_for_the_key_transformable_and_providedid"><a class="anchor" href="#_requirements_for_the_key_transformable_and_providedid"></a>1.2.2. Requirements for the Key: @Transformable and @ProvidedId</h4> <div class="paragraph"> <p>The key for each value needs to be indexed as well, and the key instance must be transformed in a <em>String</em>. Infinispan includes some default transformation routines to encode common primitives, but to use a custom key you must provide an implementation of <em>org.infinispan.query.Transformer</em> .</p> </div> <div class="sect4"> <h5 id="_registering_a_transformer_via_annotations"><a class="anchor" href="#_registering_a_transformer_via_annotations"></a>Registering a Transformer via annotations</h5> <div class="paragraph"> <p>You can annotate your key type with <em>org.infinispan.query.Transformable</em> :</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java">
<span class="annotation">@Transformable</span>(transformer = CustomTransformer.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomKey</span> {
   ...
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">CustomTransformer</span> <span class="directive">implements</span> <span class="predefined-type">Transformer</span> {
   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="predefined-type">Object</span> fromString(<span class="predefined-type">String</span> s) {
      ...
      return <span class="keyword">new</span> CustomKey(...);
   }

   <span class="annotation">@Override</span>
   <span class="directive">public</span> <span class="predefined-type">String</span> toString(<span class="predefined-type">Object</span> customType) {
      CustomKey ck = (CustomKey) customType;
      <span class="keyword">return</span> ...
   }
}
</code></pre> </div> </div> </div> <div class="sect4"> <h5 id="_registering_a_transformer_programmatically"><a class="anchor" href="#_registering_a_transformer_programmatically"></a>Registering a Transformer programmatically</h5> <div class="paragraph"> <p>Using this technique, you don&#8217;t have to annotated your custom key type:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java">org.infinispan.query.SearchManager.registerKeyTransformer(<span class="predefined-type">Class</span>&lt;?&gt;, <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> <span class="predefined-type">Transformer</span>&gt;)</code></pre> </div> </div> </div> <div class="sect4"> <h5 id="__providedid"><a class="anchor" href="#__providedid"></a>@ProvidedId</h5> <div class="paragraph"> <p>The <em>org.hibernate.search.annotations.ProvidedId</em> annotation lets you apply advanced indexing options to the key field: the field name to be used, and/or specify a custom <em>FieldBridge</em> .</p> </div> </div> </div> </div> <div class="sect2"> <h3 id="_configuration_2"><a class="anchor" href="#_configuration_2"></a>1.3. Configuration</h3> <div class="sect3"> <h4 id="_configuration_via_xml"><a class="anchor" href="#_configuration_via_xml"></a>1.3.1. Configuration via XML</h4> <div class="paragraph"> <p>To enable indexing via XML, you need to add the <code>&lt;indexing /&gt;</code> element to your cache configuration, and optionally pass additional properties to the embedded Hibernate Search engine:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="xml language-xml"><span class="tag">&lt;infinispan&gt;</span>
   <span class="tag">&lt;cache-container</span> <span class="attribute-name">default-cache</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;indexing</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LOCAL</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default.directory_provider</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>ram<span class="tag">&lt;/property&gt;</span>
         <span class="tag">&lt;/indexing&gt;</span>
      <span class="tag">&lt;/local-cache&gt;</span>
   <span class="tag">&lt;/cache-container&gt;</span>
<span class="tag">&lt;/infinispan&gt;</span>
</code></pre> </div> </div> <div class="paragraph"> <p>In this example the index is stored in memory, so when this nodes is shutdown the index is lost: good for a quick demo, but in real world cases you&#8217;ll want to use the default (store on filesystem) or store the index in Infinispan as well. For the complete reference of properties to define, refer to the <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#search-configuration">Hibernate Search documentation</a> .</p> </div> </div> <div class="sect3"> <h4 id="_automatic_configuration"><a class="anchor" href="#_automatic_configuration"></a>1.3.2. Automatic configuration</h4> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="xml language-xml">      <span class="tag">&lt;local-cache</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;indexing</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">LOCAL</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">auto-config</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;/indexing&gt;</span>
      <span class="tag">&lt;/local-cache&gt;</span>
</code></pre> </div> </div> <div class="paragraph"> <p>Tha attribute auto-config provides a simple way of configuring indexing based on the cache type. For replicated and local caches, the indexing is configured to be persisted on disk and not shared with any other processes. Also, it is configured so that minimum delay exists between the moment an object is indexed and the moment it is available for searches (near real time).</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="icon-note" title="Note"></i> </td> <td class="content"> it is possible to redefine any property added via auto-config, and also add new properties, allowing for advanced tuning. </td> </tr> </table> </div> <div class="paragraph"> <p>The auto config adds the following properties for replicated and local caches:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:7%;"> <col style="width:21%;"> <col style="width:71%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Property name</th> <th class="tableblock halign-left valign-top">value</th> <th class="tableblock halign-left valign-top">description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">hibernate.search.default.directory_provider</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">filesystem</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Filesystem based index. More details at <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#search-configuration-directory">Hibernate Search documentation</a></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">hibernate.search.default.exclusive_index_use</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">indexing operation in exclusive mode, allowing Hibernate Search to optimize writes</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">hibernate.search.default.indexmanager</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">near-real-time</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">make use of Lucene near real time feature, meaning indexed objects are promptly available to searches</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">hibernate.search.default.reader.strategy</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">shared</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Reuse index reader across several queries, thus avoiding reopening it</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>For distributed caches, the auto-config configure indexes in infinispan itself, internally handled as a master-slave mechanism where indexing operations are sent to a single node which is responsible to write to the index.</p> </div> <div class="paragraph"> <p>The auto config properties for distributed caches are:</p> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <colgroup> <col style="width:7%;"> <col style="width:21%;"> <col style="width:71%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Property name</th> <th class="tableblock halign-left valign-top">value</th> <th class="tableblock halign-left valign-top">description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">hibernate.search.default.directory_provider</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">infinispan</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Indexes stored in Infinispan. More details at <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#infinispan-directories">Hibernate Search documentation</a></p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">hibernate.search.default.exclusive_index_use</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">indexing operation in exclusive mode, allowing Hibernate Search to optimize writes</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">hibernate.search.default.indexmanager</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">org.infinispan.query.indexmanager.InfinispanIndexManager</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Delegates index writing to a single node in the Infinispan cluster</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">hibernate.search.default.reader.strategy</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">shared</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Reuse index reader across several queries, avoiding reopening it</p></td> </tr> </tbody> </table> </div> <div class="sect3"> <h4 id="_lucene_directory"><a class="anchor" href="#_lucene_directory"></a>1.3.3. Lucene Directory</h4> <div class="paragraph"> <p>Infinispan Query isn&#8217;t aware of where you store the indexes, it just passes the configuration of which <em>Lucene Directory</em> implementation you want to use to the Hibernate Search engine. There are several <em>Lucene Directory</em> implementations bundled, and you can plug your own or add third party implementations: the Directory is the IO API for Lucene to store the indexes.</p> </div> <div class="paragraph"> <p>The most common <em>Lucene Directory</em> implementations used with <em>Infinispan Query</em> are:</p> </div> <div class="ulist"> <ul> <li> <p>Ram - stores the index in a local map to the node. This index can&#8217;t be shared.</p> </li> <li> <p>Filesystem - stores the index in a locally mounted filesystem. This could be a network shared FS, but sharing this way is generally not recommended.</p> </li> <li> <p>Infinispan - stores the index in a different dedicated Infinispan cache. This cache can be configured as replicated or distributed, to share the index among nodes. See also the dedicated chapter on the Lucene Directory in this guide.</p> </li> </ul> </div> <div class="paragraph"> <p>Of course having a shared index vs. an independent index on each node directly affects behaviour of the Query module; some combinations might not make much sense.</p> </div> </div> <div class="sect3"> <h4 id="_using_programmatic_configuration_and_index_mapping"><a class="anchor" href="#_using_programmatic_configuration_and_index_mapping"></a>1.3.4. Using programmatic configuration and index mapping</h4> <div class="paragraph"> <p>In the following example we start Infinispan programmatically, avoiding XML configuration files, and also map an object <em>Author</em> which is to be stored in the grid and made searchable on two properties but without annotating the class.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java">
SearchMapping mapping = <span class="keyword">new</span> SearchMapping();
mapping.entity(Author.class).indexed().providedId()
      .property(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">ElementType</span>.METHOD).field()
      .property(<span class="string"><span class="delimiter">&quot;</span><span class="content">surname</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">ElementType</span>.METHOD).field();

<span class="predefined-type">Properties</span> properties = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
properties.put(org.hibernate.search.Environment.MODEL_MAPPING, mapping);
properties.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.search.[other options]</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">[...]</span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">Configuration</span> infinispanConfiguration = <span class="keyword">new</span> ConfigurationBuilder()
      .indexing()
         .enable()
         .indexLocalOnly(<span class="predefined-constant">true</span>)
         .withProperties(properties)
      .build();

DefaultCacheManager cacheManager = <span class="keyword">new</span> DefaultCacheManager(infinispanConfiguration);

Cache&lt;<span class="predefined-type">Long</span>, Author&gt; cache = cacheManager.getCache();
SearchManager sm = Search.getSearchManager(cache);

Author author = <span class="keyword">new</span> Author(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Manik</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Surtani</span><span class="delimiter">&quot;</span></span>);
cache.put(author.getId(), author);

QueryBuilder qb = sm.buildQueryBuilderForClass(Author.class).get();
<span class="predefined-type">Query</span> q = qb.keyword().onField(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>).matching(<span class="string"><span class="delimiter">&quot;</span><span class="content">Manik</span><span class="delimiter">&quot;</span></span>).createQuery();
CacheQuery cq = sm.getQuery(q, Author.class);
Assert.assertEquals(cq.getResultSize(), <span class="integer">1</span>);
</code></pre> </div> </div> </div> </div> <div class="sect2"> <h3 id="_cache_modes_and_managing_indexes"><a class="anchor" href="#_cache_modes_and_managing_indexes"></a>1.4. Cache modes and managing indexes</h3> <div class="paragraph"> <p>Index management is currently controlled by the <em>Configuration.setIndexLocalOnly()</em> setter, or the <code>&lt;indexing index="LOCAL" /&gt;</code> XML element. If you set this to true, only modifications made locally on each node are considered in indexing. Otherwise, remote changes are considered too.</p> </div> <div class="paragraph"> <p>Regarding actually configuring a Lucene directory, refer to the <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#search-configuration">Hibernate Search documentation</a> on how to pass in the appropriate Lucene configuration via the Properties object passed to QueryHelper.</p> </div> <div class="sect3"> <h4 id="_local"><a class="anchor" href="#_local"></a>1.4.1. LOCAL</h4> <div class="paragraph"> <p>In local mode, you may use any Lucene Directory implementation. Also the option <em>indexLocalOnly</em> isn&#8217;t meaningful.</p> </div> </div> <div class="sect3"> <h4 id="_replication"><a class="anchor" href="#_replication"></a>1.4.2. REPLICATION</h4> <div class="paragraph"> <p>In replication mode, each node can have its own local copy of the index. So indexes can either be stored locally on each node (RAMDirectory, FSDirectory, etc) but you need to set <em>indexLocalOnly</em> to <em>false</em> , so that each node will apply needed updates it receives from other nodes in addition to the updates started locally. Any Directory implementation can be used, but you have to make sure that when a new node is started it receives an up to date copy of the index; typically rsync is well suited for this task, but being an external operation you might end up with a slightly out-of-sync index, especially if updates are very frequent.</p> </div> <div class="paragraph"> <p>Alternately, if you use some form of shared storage for indexes (see <em>Sharing the Index</em> ), you then have to set <em>indexLocalOnly</em> to <em>true</em> so that each node will apply only the changes originated locally; in this case there&#8217;s no risk in having an out-of-sync index, but to avoid write contention on the index you should make sure that a single node is "in charge" of updating the index. Again, the Hibernate Search reference documentation describes means to use <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#jms-backend">a JMS queue</a> or <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#jgroups-backend">JGroups</a> to send indexing tasks to a master node.</p> </div> <div class="paragraph"> <p>The diagram below shows a replicated deployment, in which each node has a local index.</p> </div> <div class="imageblock"> <div class="content"> <img src="images/QueryingInfinispan-REPLonly.png" alt="QueryingInfinispan REPLonly"> </div> </div> </div> <div class="sect3"> <h4 id="_distribution"><a class="anchor" href="#_distribution"></a>1.4.3. DISTRIBUTION</h4> <div class="paragraph"> <p>For these 2 cache modes, you <em>need</em> to use a shared index and set <em>indexLocalOnly</em> to true.</p> </div> <div class="paragraph"> <p>The diagram below shows a deployment with a shared index. Note that while not mandatory, a shared index can be used for replicated (vs. distributed) caches as well.</p> </div> <div class="imageblock"> <div class="content"> <img src="images/QueryingInfinispan-DISTINVALandREPL.png" alt="QueryingInfinispan DISTINVALandREPL"> </div> </div> </div> <div class="sect3"> <h4 id="_invalidation"><a class="anchor" href="#_invalidation"></a>1.4.4. INVALIDATION</h4> <div class="paragraph"> <p>Indexing or searching of elements under INVALIDATION mode is not supported.</p> </div> </div> </div> <div class="sect2"> <h3 id="_sharing_the_index"><a class="anchor" href="#_sharing_the_index"></a>1.5. Sharing the Index</h3> <div class="paragraph"> <p>The most simple way to share an index is to use some form of shared storage for the indexes, like an <em>FSDirectory</em> on a shared disk; however this form is problematic as the <em>FSDirectory</em> relies on specific locking semantics which are often incompletely implemented on network filesystems, or not reliable enough; if you go for this approach make sure to search for potential problems on the Lucene mailing lists for other experiences and workarounds. Good luck, test well.</p> </div> <div class="paragraph"> <p>There are many alternative Directory implementations you can find, one of the most suited approaches when working with Infinispan is of course to store the index in an Infinispan cache: have a look at the <a href="#sid-68355039">InfinispanDirectoryProvider</a> , as all Infinispan based layers it can be combined with persistent CacheLoaders to keep the index on a shared filesystem without the locking issues, or alternatively in a database, cloud storage, or any other CacheLoader implementation; you could backup the index in the same store used to backup your values.</p> </div> <div class="paragraph"> <p>For full documentation on clustering the Lucene engine, refer to the <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#search-configuration">Hibernate Search documentation</a> to properly configure it clustered.</p> </div> </div> <div class="sect2"> <h3 id="_clustering_the_index_in_infinispan"><a class="anchor" href="#_clustering_the_index_in_infinispan"></a>1.6. Clustering the Index in Infinispan</h3> <div class="paragraph"> <p>Again the configuration details are in the Hibernate Search reference, in particular in the <a href="http://docs.jboss.org/hibernate/stable/search/reference/en-US/html_single/#infinispan-directories">infinispan-directories</a> section. This backend will by default start a secondary Infinispan CacheManager, and optionally take another Infinispan configuration file: don&#8217;t reuse the same configuration or you will start grids recursively! It is currently not possible to share the same CacheManager.</p> </div> </div> <div class="sect2"> <h3 id="_rebuilding_the_index"><a class="anchor" href="#_rebuilding_the_index"></a>1.7. Rebuilding the Index</h3> <div class="paragraph"> <p>Occasionally you might need to rebuild the Lucene index by reconstructing it from the data stored in the Cache. You need to rebuild the index if you change the definition of what is indexed on your types, or if you change for example some <em>Analyzer</em> parameter, as Analyzers affect how the index is defined. Also, you might need to rebuild the index if you had it destroyed by some system administration mistake. To rebuild the index just get a reference to the MassIndexer and start it; beware if might take some time as it needs to reprocess all data in the grid!</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java">SearchManager searchManager = Search.getSearchManager(cache);
searchManager.getMassIndexer().start();</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="icon-tip" title="Tip"></i> </td> <td class="content"> This is also available as a <code>start</code> JMX operation on the <a href="http://docs.jboss.org/infinispan/8.0/apidocs/jmxComponents.html#MassIndexer">MassIndexer MBean</a> registered under the name <code>org.infinispan:type=Query,manager="{name-of-cache-manager}",cache="{name-of-cache}",component=MassIndexer</code>. </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="_obtaining_query_statistics"><a class="anchor" href="#_obtaining_query_statistics"></a>1.8. Obtaining query statistics</h3> <div class="paragraph"> <p>Query <a href="http://docs.jboss.org/hibernate/search/4.4/api/org/hibernate/search/stat/Statistics.html"><em>Statistics</em></a> can be obtained from the <em>SearchManager</em>, as demonstrated in the following code snippet.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java">SearchManager searchManager = Search.getSearchManager(cache);
org.hibernate.search.stat.Statistics statistics = searchManager.getStatistics();</code></pre> </div> </div> <div class="admonitionblock tip"> <table> <tr> <td class="icon"> <i class="icon-tip" title="Tip"></i> </td> <td class="content"> This data is also available via JMX through the <a href="http://docs.jboss.org/hibernate/search/4.4/reference/en-US/html/search-monitoring.html#d0e7624">Hibernate Search StatisticsInfoMBean</a> registered under the name <code>org.infinispan:type=Query,manager="{name-of-cache-manager}",cache="{name-of-cache}",component=Statistics</code>. Please note this MBean is always registered by Infinispan but the statistics are collected only if <a href="#_enabling_jmx_statistics">statistics collection is enabled</a> at cache level. </td> </tr> </table> </div> <div class="admonitionblock warning"> <table> <tr> <td class="icon"> <i class="icon-warning" title="Warning"></i> </td> <td class="content"> Hibernate Search has its own configuration properties <code>hibernate.search.jmx_enabled</code> and <code>hibernate.search.generate_statistics</code> for JMX statistics as explained <a href="http://docs.jboss.org/hibernate/search/4.4/reference/en-US/html/search-monitoring.html#d0e7595">here</a>. Using them with Infinispan Query is forbidden as it will only lead to duplicated MBeans and unpredictable results. </td> </tr> </table> </div> </div> <div class="sect2"> <h3 id="_infinispan_s_query_dsl"><a class="anchor" href="#_infinispan_s_query_dsl"></a>1.9. Infinispan&#8217;s Query DSL</h3> <div class="admonitionblock warning"> <table> <tr> <td class="icon"> <i class="icon-warning" title="Warning"></i> </td> <td class="content"> This is a new API undergoing refinements and changes that might break compatibility in future releases. </td> </tr> </table> </div> <div class="paragraph"> <p>Starting with 6.0 Infinispan provides its own query DSL, independent of Lucene and Hibernate Search. Decoupling the query API from the underlying query and indexing mechanism makes it possible to introduce new alternative engines in the future, besides Lucene, and still being able to use the same uniform query API. This opens up the possibility of introducing a future index-less searching engine based on Map/Reduce that will be accessible exclusively via the new query API. The current implementation of indexing and searching is still based on Hibernate Search and Lucene so all indexing related aspects presented in this chapter still apply.</p> </div> <div class="paragraph"> <p>The new API simplifies the writing of queries by not exposing the user to the low level details of constructing Lucene query objects and also has the advantage of being available to <a href="#_querying_via_the_java_hot_rod_client">remote Hot Rod clients</a>. But before delving into further details, let&#8217;s examine first a simple example of writing a query for the <em>Book</em> entity from <a href="#_simple_example">previous example</a>.</p> </div> <div class="listingblock"> <div class="title">Query example using Infinispan&#8217;s query DSL</div> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="keyword">import</span> <span class="include">org.infinispan.query.dsl</span>.*;

<span class="comment">// get the search manager from the cache, as in previous examples:</span>
SearchManager searchManager = org.infinispan.query.Search.getSearchManager(cache);

<span class="comment">// get the DSL query factory, to be used for constructing the Query object:</span>
QueryFactory qf = searchManager.getQueryFactory();

<span class="comment">// create a query for all the books that have a title which contains the word &quot;engine&quot;:</span>
org.infinispan.query.dsl.Query query = qf.from(<span class="predefined-type">Book</span>.class)
      .having(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).like(<span class="string"><span class="delimiter">&quot;</span><span class="content">%engine%</span><span class="delimiter">&quot;</span></span>)
      .toBuilder().build();

<span class="comment">// get the results:</span>
<span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; list = query.list();</code></pre> </div> </div> <div class="paragraph"> <p>The API is located in the <em>org.infinispan.query.dsl</em> package. A query is created with the help of the <em>QueryFactory</em> instance which is obtained from the per-cache <em>SearchManager</em>. Each <em>QueryFactory</em> instance is bound to the same <em>Cache</em> instance as the <em>SearchManager</em>, but it is otherwise a stateless and thread-safe object that can be used for creating multiple queries in parallel.</p> </div> <div class="paragraph"> <p>Query creation starts with the invocation of the <code>from(Class entityType)</code> method which returns a <em>QueryBuilder</em> object that is further responsible for creating queries targeted to the specified entity class from the given cache.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="icon-note" title="Note"></i> </td> <td class="content"> A query will always target a single entity type and is evaluated over the contents of a single cache. Running a query over multiple caches or creating queries that target several entity types (joins) is not supported. </td> </tr> </table> </div> <div class="paragraph"> <p>The <em>QueryBuilder</em> accumulates search criteria and configuration specified through the invocation of its DSL methods and is ultimately used to build a <em>Query</em> object by the invocation of the <code>QueryBuilder.build()</code> method that completes the construction. Being a stateful object, it cannot be used for constructing multiple queries at the same time (except for <a href="#_nested_conditions">nested queries</a>) but can be reused afterwards.</p> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="icon-note" title="Note"></i> </td> <td class="content"> This <em>QueryBuilder</em> is different from the one from Hibernate Search but has a somewhat similar purpose, hence the same name. We are considering renaming it in near future to prevent ambiguity. </td> </tr> </table> </div> <div class="paragraph"> <p>Executing the query and fetching the results is as simple as invoking the <code>list()</code> method of the <em>Query</em> object. Once executed the <em>Query</em> object is not reusable. If you need to re-execute it in order to obtain fresh results then a new instance must be obtained by calling <code>QueryBuilder.build()</code>.</p> </div> </div> <div class="sect2"> <h3 id="_filtering_operators"><a class="anchor" href="#_filtering_operators"></a>1.10. Filtering operators</h3> <div class="paragraph"> <p>Constructing a query is a hierarchical process of composing multiple criteria and is best explained following this hierarchy.</p> </div> <div class="paragraph"> <p>The simplest possible form of a query criteria is a restriction on the values of an entity attribute according to a filtering operator that accepts zero or more arguments. The entity attribute is specified by invoking the <code>having(String attributePath)</code> method of the query builder which returns an intermediate context object (<a href="http://docs.jboss.org/infinispan/8.0/apidocs/org/infinispan/query/dsl/FilterConditionEndContext.html"><em>FilterConditionEndContext</em></a>) that exposes all the available operators. Each of the methods defined by <em>FilterConditionEndContext</em> is an operator that accepts an argument, except for <code>between</code> which has two arguments and <code>isNull</code> which has no arguments. The arguments are statically evaluated at the time the query is constructed, so if you&#8217;re looking for a feature similar to SQL&#8217;s correlated sub-queries, that is not currently available.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="comment">// a single query criterion</span>
QueryBuilder qb = ...
qb.having(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">Infinispan Data Grid Platform</span><span class="delimiter">&quot;</span></span>);</code></pre> </div> </div> <table class="tableblock frame-all grid-all" style="width:100%; "> <caption class="title">Table 1. <em>FilterConditionEndContext</em> exposes the following filtering operators:</caption> <colgroup> <col style="width:7%;"> <col style="width:21%;"> <col style="width:71%;"> </colgroup> <thead> <tr> <th class="tableblock halign-left valign-top">Filter</th> <th class="tableblock halign-left valign-top">Arguments</th> <th class="tableblock halign-left valign-top">Description</th> </tr> </thead> <tbody> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">in</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Collection values</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left operand is equal to one of the elements from the Collection of values given as argument.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">in</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Object&#8230; values</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left operand is equal to one of the (fixed) list of values given as argument.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">contains</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Object value</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument (which is expected to be an array or a Collection) contains the given element.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">containsAll</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Collection values</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument (which is expected to be an array or a Collection) contains all the elements of the given collection, in any order.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">containsAll</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Object&#8230; values</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument (which is expected to be an array or a Collection) contains all of the the given elements, in any order.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">containsAny</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Collection values</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument (which is expected to be an array or a Collection) contains any of the elements of the given collection.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">containsAny</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Object&#8230; values</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument (which is expected to be an array or a Collection) contains any of the the given elements.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">isNull</p></td> <td class="tableblock halign-left valign-top"></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument is null.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">like</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">String pattern</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument (which is expected to be a String) matches a wildcard pattern that follows the JPA rules.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">eq</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Object value</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument is equal to the given value.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">gt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Object value</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument is greater than the given value.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">gte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Object value</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument is greater than or equal to the given value.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">lt</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Object value</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument is less than the given value.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">lte</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Object value</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument is less than or equal to the given value.</p></td> </tr> <tr> <td class="tableblock halign-left valign-top"><p class="tableblock">between</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Object from, Object to</p></td> <td class="tableblock halign-left valign-top"><p class="tableblock">Checks that the left argument is between the given range limits.</p></td> </tr> </tbody> </table> <div class="paragraph"> <p>It&#8217;s important to note that query construction requires a multi-step chaining of method invocation that must be done in the proper sequence, must be properly completed exactly <em>once</em> and must not be done twice, or it will result in an error. The following examples are invalid, and depending on each case they lead to criteria being ignored (in benign cases) or an exception being thrown (in more serious ones).</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="comment">// Incomplete construction. This query does not have any filter on &quot;title&quot; attribute yet,</span>
<span class="comment">// although the author may have intended to add one.</span>
QueryBuilder qb1 = ...
qb1.having(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Query</span> q1 = qb1.build(); <span class="comment">// consequently, this query matches all Book instances regardless of title!</span>

<span class="comment">// Duplicated completion. This results in an exception at run-time.</span>
<span class="comment">// Maybe the author intended to connect two conditions with a boolean operator,</span>
<span class="comment">// but this does NOT actually happen here.</span>
QueryBuilder qb2 = ...
qb2.having(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).like(<span class="string"><span class="delimiter">&quot;</span><span class="content">%Infinispan%</span><span class="delimiter">&quot;</span></span>);
qb2.having(<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>).like(<span class="string"><span class="delimiter">&quot;</span><span class="content">%clustering%</span><span class="delimiter">&quot;</span></span>);   <span class="comment">// will throw java.lang.IllegalStateException: Sentence already started. Cannot use 'having(..)' again.</span>
<span class="predefined-type">Query</span> q2 = qb2.build();</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="icon-note" title="Note"></i> </td> <td class="content"> All fields participating in the query need to be indexed by Hibernate Search for querying to work in embedded mode. We plan to add index-less searching with Map/Reduce in future versions (see <a href="https://issues.jboss.org/browse/ISPN-3717">ISPN-3717</a>). </td> </tr> </table> </div> <div class="sect3"> <h4 id="_filtering_based_on_attributes_of_embedded_entities"><a class="anchor" href="#_filtering_based_on_attributes_of_embedded_entities"></a>1.10.1. Filtering based on attributes of embedded entities</h4> <div class="paragraph"> <p>The <code>having</code> method also accepts dot separated attribute paths for referring to <em>embedded entity</em> attributes, so the following is a valid query:</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="comment">// match all books that have an author named &quot;Manik&quot;</span>
<span class="predefined-type">Query</span> query = queryFactory.from(<span class="predefined-type">Book</span>.class)
      .having(<span class="string"><span class="delimiter">&quot;</span><span class="content">author.name</span><span class="delimiter">&quot;</span></span>).eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">Manik</span><span class="delimiter">&quot;</span></span>)
      .toBuilder().build();</code></pre> </div> </div> <div class="paragraph"> <p>Each part of the attribute path must refer to an existing indexed attribute in the corresponding entity or embedded entity class respectively. It&#8217;s possible to have multiple levels of embedding.</p> </div> </div> </div> <div class="sect2"> <h3 id="_boolean_conditions"><a class="anchor" href="#_boolean_conditions"></a>1.11. Boolean conditions</h3> <div class="paragraph"> <p>Combining multiple attribute conditions with logical conjunction (<code>and</code>) and disjunction (<code>or</code>) operators in order to create more complex conditions is demonstrated in the following example. The well known operator precedence rule for boolean operators applies here, so the order of DSL method invocations during construction is irrelevant. Here <code>and</code> operator still has higher priority than <code>or</code> even though <code>or</code> was invoked first.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="comment">// match all books that have the word &quot;Infinispan&quot; in their title</span>
<span class="comment">// or have an author named &quot;Manik&quot; and their description contains the word &quot;clustering&quot;</span>
<span class="predefined-type">Query</span> query = queryFactory.from(<span class="predefined-type">Book</span>.class)
  .having(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).like(<span class="string"><span class="delimiter">&quot;</span><span class="content">%Infinispan%</span><span class="delimiter">&quot;</span></span>)
  .or().having(<span class="string"><span class="delimiter">&quot;</span><span class="content">author.name</span><span class="delimiter">&quot;</span></span>).eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">Manik</span><span class="delimiter">&quot;</span></span>)
  .and().having(<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>).like(<span class="string"><span class="delimiter">&quot;</span><span class="content">%clustering%</span><span class="delimiter">&quot;</span></span>)
  .toBuilder().build();</code></pre> </div> </div> <div class="paragraph"> <p>Boolean negation is achieved with the <code>not</code> operator, which has highest precedence among logical operators and applies only to the next simple attribute condition.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="comment">// match all books that do not have the word &quot;Infinispan&quot; in their title and are authored by &quot;Manik&quot;</span>
<span class="predefined-type">Query</span> query = queryFactory.from(<span class="predefined-type">Book</span>.class)
  .not().having(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).like(<span class="string"><span class="delimiter">&quot;</span><span class="content">%Infinispan%</span><span class="delimiter">&quot;</span></span>)
  .and().having(<span class="string"><span class="delimiter">&quot;</span><span class="content">author.name</span><span class="delimiter">&quot;</span></span>).eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">Manik</span><span class="delimiter">&quot;</span></span>)
  .toBuilder().build();</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_nested_conditions"><a class="anchor" href="#_nested_conditions"></a>1.12. Nested conditions</h3> <div class="paragraph"> <p>Changing the precendece of logical operators is achieved with nested filter conditions. Logical operators can be used to connect two simple attribute conditions as presented before, but can also connect a simple attribute condition with the subsequent complex condition created with the same query factory.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="comment">// match all books that have an author named &quot;Manik&quot; and their title contains</span>
<span class="comment">// the word &quot;Infinispan&quot; or their description contains the word &quot;clustering&quot;</span>
<span class="predefined-type">Query</span> query = queryFactory.from(<span class="predefined-type">Book</span>.class)
  .having(<span class="string"><span class="delimiter">&quot;</span><span class="content">author.name</span><span class="delimiter">&quot;</span></span>).eq(<span class="string"><span class="delimiter">&quot;</span><span class="content">Manik</span><span class="delimiter">&quot;</span></span>);
  .and(queryFactory.having(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).like(<span class="string"><span class="delimiter">&quot;</span><span class="content">%Infinispan%</span><span class="delimiter">&quot;</span></span>)
          .or().having(<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>).like(<span class="string"><span class="delimiter">&quot;</span><span class="content">%clustering%</span><span class="delimiter">&quot;</span></span>))
  .toBuilder().build();</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_projections"><a class="anchor" href="#_projections"></a>1.13. Projections</h3> <div class="paragraph"> <p>In some use cases returning the whole domain object is overkill if only a small subset of the attributes are actually used by the application, especially if the domain entity has embedded entities. The query language allows you to specify a subset of attributes (or attribute paths) to return - the projection. If projections are used then the <code>Query.list()</code> will not return the whole domain entity but will return a <em>List</em> of <em>Object[]</em>, each slot in the array corresponding to a projected attribute.</p> </div> <div class="paragraph"> <p>TODO document what needs to be configured for an attribute to be available for projection.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="comment">// match all books that have the word &quot;Infinispan&quot; in their title or description</span>
<span class="comment">// and return only their title and publication year</span>
<span class="predefined-type">Query</span> query = queryFactory.from(<span class="predefined-type">Book</span>.class)
  .setProjection(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">publicationYear</span><span class="delimiter">&quot;</span></span>)
  .having(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).like(<span class="string"><span class="delimiter">&quot;</span><span class="content">%Infinispan%</span><span class="delimiter">&quot;</span></span>)
  .or().having(<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>).like(<span class="string"><span class="delimiter">&quot;</span><span class="content">%Infinispan%</span><span class="delimiter">&quot;</span></span>))
  .toBuilder().build();</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_sorting"><a class="anchor" href="#_sorting"></a>1.14. Sorting</h3> <div class="paragraph"> <p>Ordering the results based on one or more attributes or attribute paths is done with the <code>QueryBuilder.orderBy( )</code> method which accepts an attribute path and a sorting direction. If multiple sorting criteria are specified, then the order of invocation of <code>orderBy</code> method will dictate their precedence. But you have to think of the multiple sorting criteria as acting together on the tuple of specified attributes rather than in a sequence of individual sorting operations on each attribute.</p> </div> <div class="paragraph"> <p>TODO document what needs to be configured for an attribute to be available for sorting.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="comment">// match all books that have the word &quot;Infinispan&quot; in their title or description</span>
<span class="comment">// and return them sorted by the publication year and title</span>
<span class="predefined-type">Query</span> query = queryFactory.from(<span class="predefined-type">Book</span>.class)
  .orderBy(<span class="string"><span class="delimiter">&quot;</span><span class="content">publicationYear</span><span class="delimiter">&quot;</span></span>, SortOrder.DESC)
  .orderBy(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>, SortOrder.ASC)
  .having(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).like(<span class="string"><span class="delimiter">&quot;</span><span class="content">%Infinispan%</span><span class="delimiter">&quot;</span></span>)
  .or().having(<span class="string"><span class="delimiter">&quot;</span><span class="content">description</span><span class="delimiter">&quot;</span></span>).like(<span class="string"><span class="delimiter">&quot;</span><span class="content">%Infinispan%</span><span class="delimiter">&quot;</span></span>))
  .toBuilder().build();</code></pre> </div> </div> </div> <div class="sect2"> <h3 id="_pagination"><a class="anchor" href="#_pagination"></a>1.15. Pagination</h3> <div class="paragraph"> <p>You can limit the number of returned results by setting the <em>maxResults</em> property of <em>QueryBuilder</em>. This can be used in conjunction with setting the <em>startOffset</em> in order to achieve pagination of the result set.</p> </div> <div class="listingblock"> <div class="content"> <pre class="CodeRay"><code class="java language-java"><span class="comment">// match all books that have the word &quot;clustering&quot; in their title</span>
<span class="comment">// sorted by publication year and title</span>
<span class="comment">// and return 3'rd page of 10 results</span>
<span class="predefined-type">Query</span> query = queryFactory.from(<span class="predefined-type">Book</span>.class)
  .orderBy(<span class="string"><span class="delimiter">&quot;</span><span class="content">publicationYear</span><span class="delimiter">&quot;</span></span>, SortOrder.DESC)
  .orderBy(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>, SortOrder.ASC)
  .setStartOffset(<span class="integer">20</span>)
  .maxResults(<span class="integer">10</span>)
  .having(<span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>).like(<span class="string"><span class="delimiter">&quot;</span><span class="content">%clustering%</span><span class="delimiter">&quot;</span></span>)
  .toBuilder().build();</code></pre> </div> </div> <div class="admonitionblock note"> <table> <tr> <td class="icon"> <i class="icon-note" title="Note"></i> </td> <td class="content"> Even if the results being fetched are limited to <em>maxResults</em> you can still find the total number of matching results by calling <code>Query.getResultSize()</code>. </td> </tr> </table> </div> <div class="paragraph"> <p>TODO Does pagination make sense if no stable sort criteria is defined? Luckily when running on Lucene and no sort criteria is specified we still have the order of relevance, but this has to be defined for other search engines.</p> </div> </div> <div class="sect2"> <h3 id="_usage_samples"><a class="anchor" href="#_usage_samples"></a>1.16. Usage samples</h3> <div class="paragraph"> <p>Probably the best way to explore using the new API is to look at our tests suite. <a href="https://github.com/infinispan/infinispan/blob/6.0.0.Final/query/src/test/java/org/infinispan/query/dsl/embedded/QueryDslConditionsTest.java">QueryDslConditionsTest</a> is a fine example.</p> </div> </div> </div> </div> </div> <div id="footer"> <div id="footer-text"> Last updated 2015-10-19 11:28:42 EDT </div> </div> </body> </html>